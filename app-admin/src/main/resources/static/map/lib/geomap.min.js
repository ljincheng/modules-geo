var geomap=geomap||{version:"1.0.0"};if(typeof exports!=="undefined"){exports.geomap=geomap}if(typeof document!=="undefined"&&typeof window!=="undefined"){if(document instanceof (typeof HTMLDocument!=="undefined"?HTMLDocument:Document)){geomap.document=document}else{geomap.document=document.implementation.createHTMLDocument("")}geomap.window=window;geomap.log=console.log;geomap.warn=console.warn;geomap.debug=console.log}else{var jsdom=require("jsdom");var virtualWindow=new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;geomap.document=virtualWindow.document;geomap.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper;geomap.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas;geomap.window=virtualWindow;geomap.log=console.log;geomap.warn=console.warn;geomap.debug=console.log;DOMParser=geomap.window.DOMParser}if(typeof document!=="undefined"&&typeof window!=="undefined"){window.geomap=geomap}if(typeof(eventjs)==="undefined"){var eventjs={}}(function(n){n.modifyEventListener=false;n.modifySelectors=false;n.configure=function(s){if(isFinite(s.modifyEventListener)){n.modifyEventListener=s.modifyEventListener}if(isFinite(s.modifySelectors)){n.modifySelectors=s.modifySelectors}if(e===false&&n.modifyEventListener){l()}if(f===false&&n.modifySelectors){o()}};n.add=function(v,t,u,s){return d(v,t,u,s,"add")};n.remove=function(v,t,u,s){return d(v,t,u,s,"remove")};n.returnFalse=function(s){return false};n.stop=function(s){if(!s){return}if(s.stopPropagation){s.stopPropagation()}s.cancelBubble=true;s.cancelBubbleCount=0};n.prevent=function(s){if(!s){return}if(s.preventDefault){s.preventDefault()}else{if(s.preventManipulation){s.preventManipulation()}else{s.returnValue=false}}};n.cancel=function(s){n.stop(s);n.prevent(s)};n.blur=function(){var s=document.activeElement;if(!s){return}var t=document.activeElement.nodeName;if(t==="INPUT"||t==="TEXTAREA"||s.contentEditable==="true"){if(s.blur){s.blur()}}};n.getEventSupport=function(u,t){if(typeof(u)==="string"){t=u;u=window}t="on"+t;if(t in u){return true}if(!u.setAttribute){u=document.createElement("div")}if(u.setAttribute&&u.removeAttribute){u.setAttribute(t,"");var s=typeof u[t]==="function";if(typeof u[t]!=="undefined"){u[t]=null}u.removeAttribute(t);return s}};var q=function(u){if(!u||typeof(u)!=="object"){return u}var s=new u.constructor();for(var t in u){if(!u[t]||typeof(u[t])!=="object"){s[t]=u[t]}else{s[t]=q(u[t])}}return s};var d=function(S,u,v,R,D,N){R=R||{};if(String(S)==="[object Object]"){var U=S;S=U.target;delete U.target;if(U.type&&U.listener){u=U.type;delete U.type;v=U.listener;delete U.listener;for(var V in U){R[V]=U[V]}}else{for(var w in U){var K=U[w];if(typeof(K)==="function"){continue}R[w]=K}var T={};for(var V in U){var w=V.split(",");var H=U[V];var B={};for(var L in R){B[L]=R[L]}if(typeof(H)==="function"){var v=H}else{if(typeof(H.listener)==="function"){var v=H.listener;for(var L in H){if(typeof(H[L])==="function"){continue}B[L]=H[L]}}else{continue}}for(var J=0;J<w.length;J++){T[V]=eventjs.add(S,w[J],v,B,D)}}return T}}if(!S||!u||!v){return}if(typeof(S)==="string"&&u==="ready"){if(window.eventjs_stallOnReady){u="load";S=window}else{var x=(new Date()).getTime();var A=R.timeout;var I=R.interval||1000/60;var O=window.setInterval(function(){if((new Date()).getTime()-x>A){window.clearInterval(O)}if(document.querySelector(S)){window.clearInterval(O);setTimeout(v,1)}},I);return}}if(typeof(S)==="string"){S=document.querySelectorAll(S);if(S.length===0){return b("Missing target on listener!",arguments)}if(S.length===1){S=S[0]}}var M;var s={};if(S.length>0&&S!==window){for(var z=0,G=S.length;z<G;z++){M=d(S[z],u,v,q(R),D);if(M){s[z]=M}}return i(s)}if(typeof(u)==="string"){u=u.toLowerCase();if(u.indexOf(" ")!==-1){u=u.split(" ")}else{if(u.indexOf(",")!==-1){u=u.split(",")}}}if(typeof(u)!=="string"){if(typeof(u.length)==="number"){for(var y=0,E=u.length;y<E;y++){M=d(S,u[y],v,q(R),D);if(M){s[u[y]]=M}}}else{for(var V in u){if(typeof(u[V])==="function"){M=d(S,V,u[V],q(R),D)}else{M=d(S,V,u[V].listener,q(u[V]),D)}if(M){s[V]=M}}}return i(s)}else{if(u.indexOf("on")===0){u=u.substr(2)}}if(typeof(S)!=="object"){return b("Target is not defined!",arguments)}if(typeof(v)!=="function"){return b("Listener is not a function!",arguments)}var Q=R.useCapture||false;var F=c(S)+"."+c(v)+"."+(Q?1:0);if(n.Gesture&&n.Gesture._gestureHandlers[u]){F=u+F;if(D==="remove"){if(!j[F]){return}j[F].remove();delete j[F]}else{if(D==="add"){if(j[F]){j[F].add();return j[F]}if(R.useCall&&!n.modifyEventListener){var P=v;v=function(Y,W){for(var X in W){Y[X]=W[X]}return P.call(S,Y)}}R.gesture=u;R.target=S;R.listener=v;R.fromOverwrite=N;j[F]=n.proxy[u](R)}}return j[F]}else{var t=g(u);for(var J=0,C;J<t.length;J++){u=t[J];C=u+"."+F;if(D==="remove"){if(!j[C]){continue}S[r](u,v,Q);delete j[C]}else{if(D==="add"){if(j[C]){return j[C]}S[m](u,v,Q);j[C]={id:C,type:u,target:S,listener:v,remove:function(){for(var W=0;W<t.length;W++){n.remove(S,t[W],v,R)}}}}}}return j[C]}};var i=function(s){return{remove:function(){for(var t in s){s[t].remove()}},add:function(){for(var t in s){s[t].add()}}}};var b=function(s,t){if(typeof(console)==="undefined"){return}if(typeof(console.error)==="undefined"){return}console.error(s,t)};var p={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]};var h={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2};var a=(function(){n.supports={};if(window.navigator.msPointerEnabled){n.supports.msPointer=true}if(n.getEventSupport("touchstart")){n.supports.touch=true}if(n.getEventSupport("mousedown")){n.supports.mouse=true}})();var g=(function(){return function(v){var w=document.addEventListener?"":"on";var s=h[v];if(isFinite(s)){var u=[];for(var t in n.supports){u.push(w+p[t][s])}return u}else{return[w+v]}}})();var j={};var k=0;var c=function(s){if(s===window){return"#window"}if(s===document){return"#document"}if(!s.uniqueID){s.uniqueID="e"+k++}return s.uniqueID};var m=document.addEventListener?"addEventListener":"attachEvent";var r=document.removeEventListener?"removeEventListener":"detachEvent";n.createPointerEvent=function(t,z,s){var w=z.gesture;var x=z.target;var A=t.changedTouches||n.proxy.getCoords(t);if(A.length){var B=A[0];z.pointers=s?[]:A;z.pageX=B.pageX;z.pageY=B.pageY;z.x=z.pageX;z.y=z.pageY}var v=document.createEvent("Event");v.initEvent(w,true,true);v.originalEvent=t;for(var u in z){if(u==="target"){continue}v[u]=z[u]}var y=v.type;if(n.Gesture&&n.Gesture._gestureHandlers[y]){z.oldListener.call(x,v,z,false)}};var e=false;var l=function(){if(!window.HTMLElement){return}var s=function(u){var t=function(v){var x=v+"EventListener";var w=u[x];u[x]=function(B,C,y){if(n.Gesture&&n.Gesture._gestureHandlers[B]){var z=y;if(typeof(y)==="object"){z.useCall=true}else{z={useCall:true,useCapture:y}}d(this,B,C,z,v,true)}else{var A=g(B);for(var D=0;D<A.length;D++){w.call(this,A[D],C,y)}}}};t("add");t("remove")};if(navigator.userAgent.match(/Firefox/)){s(HTMLDivElement.prototype);s(HTMLCanvasElement.prototype)}else{s(HTMLElement.prototype)}s(document);s(window)};var f=false;var o=function(){var s=NodeList.prototype;s.removeEventListener=function(u,w,t){for(var x=0,v=this.length;x<v;x++){this[x].removeEventListener(u,w,t)}};s.addEventListener=function(u,w,t){for(var x=0,v=this.length;x<v;x++){this[x].addEventListener(u,w,t)}}};return n})(eventjs);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.pointerSetup=function(f,e){f.target=f.target||window;f.doc=f.target.ownerDocument||f.target;f.minFingers=f.minFingers||f.fingers||1;f.maxFingers=f.maxFingers||f.fingers||Infinity;f.position=f.position||"relative";delete f.fingers;e=e||{};e.enabled=true;e.gesture=f.gesture;e.target=f.target;e.env=f.env;if(eventjs.modifyEventListener&&f.fromOverwrite){f.oldListener=f.listener;f.listener=eventjs.createPointerEvent}var d=0;var g=e.gesture.indexOf("pointer")===0&&eventjs.modifyEventListener?"pointer":"mouse";if(f.oldListener){e.oldListener=f.oldListener}e.listener=f.listener;e.proxy=function(h){e.defaultListener=f.listener;f.listener=h;h(f.event,e)};e.add=function(){if(e.enabled===true){return}if(f.onPointerDown){eventjs.add(f.target,g+"down",f.onPointerDown)}if(f.onPointerMove){eventjs.add(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp){eventjs.add(f.doc,g+"up",f.onPointerUp)}e.enabled=true};e.remove=function(){if(e.enabled===false){return}if(f.onPointerDown){eventjs.remove(f.target,g+"down",f.onPointerDown)}if(f.onPointerMove){eventjs.remove(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp){eventjs.remove(f.doc,g+"up",f.onPointerUp)}e.reset();e.enabled=false};e.pause=function(h){if(f.onPointerMove&&(!h||h.move)){eventjs.remove(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp&&(!h||h.up)){eventjs.remove(f.doc,g+"up",f.onPointerUp)}d=f.fingers;f.fingers=0};e.resume=function(h){if(f.onPointerMove&&(!h||h.move)){eventjs.add(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp&&(!h||h.up)){eventjs.add(f.doc,g+"up",f.onPointerUp)}f.fingers=d};e.reset=function(){f.tracker={};f.fingers=0};return e};var b=eventjs.supports;eventjs.isMouse=!!b.mouse;eventjs.isMSPointer=!!b.touch;eventjs.isTouch=!!b.msPointer;a.pointerStart=function(e,r,o){var p=(e.type||"mousedown").toUpperCase();if(p.indexOf("MOUSE")===0){eventjs.isMouse=true;eventjs.isTouch=false;eventjs.isMSPointer=false}else{if(p.indexOf("TOUCH")===0){eventjs.isMouse=false;eventjs.isTouch=true;eventjs.isMSPointer=false}else{if(p.indexOf("MSPOINTER")===0){eventjs.isMouse=false;eventjs.isTouch=false;eventjs.isMSPointer=true}}}var k=function(z,t){var v=o.bbox;var u=h[t]={};switch(o.position){case"absolute":u.offsetX=0;u.offsetY=0;break;case"differenceFromLast":u.offsetX=z.pageX;u.offsetY=z.pageY;break;case"difference":u.offsetX=z.pageX;u.offsetY=z.pageY;break;case"move":u.offsetX=z.pageX-v.x1;u.offsetY=z.pageY-v.y1;break;default:u.offsetX=v.x1-v.scrollLeft;u.offsetY=v.y1-v.scrollTop;break}var i=z.pageX-u.offsetX;var w=z.pageY-u.offsetY;u.rotation=0;u.scale=1;u.startTime=u.moveTime=(new Date()).getTime();u.move={x:i,y:w};u.start={x:i,y:w};o.fingers++};o.event=e;if(r.defaultListener){o.listener=r.defaultListener;delete r.defaultListener}var s=!o.fingers;var h=o.tracker;var n=e.changedTouches||a.getCoords(e);var g=n.length;for(var m=0;m<g;m++){var l=n[m];var f=l.identifier||Infinity;if(o.fingers){if(o.fingers>=o.maxFingers){var d=[];for(var f in o.tracker){d.push(f)}r.identifier=d.join(",");return s}var j=0;for(var q in h){if(h[q].up){delete h[q];k(l,f);o.cancel=true;break}j++}if(h[f]){continue}k(l,f)}else{h=o.tracker={};r.bbox=o.bbox=a.getBoundingBox(o.target);o.fingers=0;o.cancel=false;k(l,f)}}var d=[];for(var f in o.tracker){d.push(f)}r.identifier=d.join(",");return s};a.pointerEnd=function(e,p,n,j){var m=e.touches||[];var h=m.length;var o={};for(var l=0;l<h;l++){var k=m[l];var f=k.identifier;o[f||Infinity]=true}for(var f in n.tracker){var g=n.tracker[f];if(o[f]||g.up){continue}if(j){j({pageX:g.pageX,pageY:g.pageY,changedTouches:[{pageX:g.pageX,pageY:g.pageY,identifier:f==="Infinity"?Infinity:f}]},"up")}g.up=true;n.fingers--}if(n.fingers!==0){return false}var d=[];n.gestureFingers=0;for(var f in n.tracker){n.gestureFingers++;d.push(f)}p.identifier=d.join(",");return true};a.getCoords=function(d){if(typeof(d.pageX)!=="undefined"){a.getCoords=function(e){return Array({type:"mouse",x:e.pageX,y:e.pageY,pageX:e.pageX,pageY:e.pageY,identifier:e.pointerId||Infinity})}}else{a.getCoords=function(e){var f=document.documentElement;e=e||window.event;return Array({type:"mouse",x:e.clientX+f.scrollLeft,y:e.clientY+f.scrollTop,pageX:e.clientX+f.scrollLeft,pageY:e.clientY+f.scrollTop,identifier:Infinity})}}return a.getCoords(d)};a.getCoord=function(f){if("ontouchstart" in window){var e=0;var d=0;a.getCoord=function(g){var h=g.changedTouches;if(h&&h.length){return{x:e=h[0].pageX,y:d=h[0].pageY}}else{return{x:e,y:d}}}}else{if(typeof(f.pageX)!=="undefined"&&typeof(f.pageY)!=="undefined"){a.getCoord=function(g){return{x:g.pageX,y:g.pageY}}}else{a.getCoord=function(g){var h=document.documentElement;g=g||window.event;return{x:g.clientX+h.scrollLeft,y:g.clientY+h.scrollTop}}}}return a.getCoord(f)};var c=function(e,d){var f=parseFloat(e.getPropertyValue(d),10);return isFinite(f)?f:0};a.getBoundingBox=function(g){if(g===window||g===document){g=document.body}var n={};var m=g.getBoundingClientRect();n.width=m.width;n.height=m.height;n.x1=m.left;n.y1=m.top;n.scaleX=m.width/g.offsetWidth||1;n.scaleY=m.height/g.offsetHeight||1;n.scrollLeft=0;n.scrollTop=0;var f=window.getComputedStyle(g);var e=f.getPropertyValue("box-sizing")==="border-box";if(e===false){var h=c(f,"border-left-width");var l=c(f,"border-right-width");var d=c(f,"border-bottom-width");var k=c(f,"border-top-width");n.border=[h,l,k,d];n.x1+=h;n.y1+=k;n.width-=l+h;n.height-=d+k}n.x2=n.x1+n.width;n.y2=n.y1+n.height;var j=f.getPropertyValue("position");var i=j==="fixed"?g:g.parentNode;while(i!==null){if(i===document.body){break}if(i.scrollTop===undefined){break}var f=window.getComputedStyle(i);var j=f.getPropertyValue("position");if(j==="absolute"){}else{if(j==="fixed"){n.scrollTop-=i.parentNode.scrollTop;n.scrollLeft-=i.parentNode.scrollLeft;break}else{n.scrollLeft+=i.scrollLeft;n.scrollTop+=i.scrollTop}}i=i.parentNode}n.scrollBodyLeft=(window.pageXOffset!==undefined)?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;n.scrollBodyTop=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;n.scrollLeft-=n.scrollBodyLeft;n.scrollTop-=n.scrollBodyTop;return n};(function(){var e=navigator.userAgent.toLowerCase();var f=e.indexOf("macintosh")!==-1;var d;if(f&&e.indexOf("khtml")!==-1){d={91:true,93:true}}else{if(f&&e.indexOf("firefox")!==-1){d={224:true}}else{d={17:true}}}(a.metaTrackerReset=function(){eventjs.fnKey=a.fnKey=false;eventjs.metaKey=a.metaKey=false;eventjs.escKey=a.escKey=false;eventjs.ctrlKey=a.ctrlKey=false;eventjs.shiftKey=a.shiftKey=false;eventjs.altKey=a.altKey=false})();a.metaTracker=function(h){var g=h.type==="keydown";if(h.keyCode===27){eventjs.escKey=a.escKey=g}if(d[h.keyCode]){eventjs.metaKey=a.metaKey=g}eventjs.ctrlKey=a.ctrlKey=h.ctrlKey;eventjs.shiftKey=a.shiftKey=h.shiftKey;eventjs.altKey=a.altKey=h.altKey}})();return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}eventjs.MutationObserver=(function(){var b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var a=!b&&(function(){var e=document.createElement("p");var c=false;var d=function(){c=true};if(e.addEventListener){e.addEventListener("DOMAttrModified",d,false)}else{if(e.attachEvent){e.attachEvent("onDOMAttrModified",d)}else{return false}}e.setAttribute("id","target");return c})();return function(c,f){if(b){var e={subtree:false,attributes:true};var d=new b(function(g){g.forEach(function(h){f.call(h.target,h.attributeName)})});d.observe(c,e)}else{if(a){eventjs.add(c,"DOMAttrModified",function(g){f.call(c,g.attrName)})}else{if("onpropertychange" in document.body){eventjs.add(c,"propertychange",function(g){f.call(c,window.event.propertyName)})}}}}})();if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.click=function(c){c.gesture=c.gesture||"click";c.maxFingers=c.maxFingers||c.fingers||1;c.onPointerDown=function(d){if(a.pointerStart(d,b,c)){eventjs.add(c.target,"mouseup",c.onPointerUp)}};c.onPointerUp=function(e){if(a.pointerEnd(e,b,c)){eventjs.remove(c.target,"mouseup",c.onPointerUp);var k=e.changedTouches||a.getCoords(e);var d=k[0];var l=c.bbox;var f=a.getBoundingBox(c.target);var g=d.pageY-f.scrollBodyTop;var h=d.pageX-f.scrollBodyLeft;if(h>l.x1&&g>l.y1&&h<l.x2&&g<l.y2&&l.scrollTop===f.scrollTop){for(var j in c.tracker){break}var i=c.tracker[j];b.x=i.start.x;b.y=i.start.y;c.listener(e,b)}}};var b=a.pointerSetup(c);b.state="click";eventjs.add(c.target,"mousedown",c.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.click=a.click;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.dbltap=a.dblclick=function(f){f.gesture=f.gesture||"dbltap";f.maxFingers=f.maxFingers||f.fingers||1;var e=700;var i,h,g;var d,c;f.onPointerDown=function(k){var j=k.changedTouches||a.getCoords(k);if(i&&!h){c=j[0];h=(new Date()).getTime()-i}else{d=j[0];i=(new Date()).getTime();h=0;clearTimeout(g);g=setTimeout(function(){i=0},e)}if(a.pointerStart(k,b,f)){eventjs.add(f.target,"mousemove",f.onPointerMove).listener(k);eventjs.add(f.target,"mouseup",f.onPointerUp)}};f.onPointerMove=function(l){if(i&&!h){var j=l.changedTouches||a.getCoords(l);c=j[0]}var n=f.bbox;var m=(c.pageX-n.x1);var k=(c.pageY-n.y1);if(!(m>0&&m<n.width&&k>0&&k<n.height&&Math.abs(c.pageX-d.pageX)<=25&&Math.abs(c.pageY-d.pageY)<=25)){eventjs.remove(f.target,"mousemove",f.onPointerMove);clearTimeout(g);i=h=0}};f.onPointerUp=function(l){if(a.pointerEnd(l,b,f)){eventjs.remove(f.target,"mousemove",f.onPointerMove);eventjs.remove(f.target,"mouseup",f.onPointerUp)}if(i&&h){if(h<=e){b.state=f.gesture;for(var k in f.tracker){break}var j=f.tracker[k];b.x=j.start.x;b.y=j.start.y;f.listener(l,b)}clearTimeout(g);i=h=0}};var b=a.pointerSetup(f);b.state="dblclick";eventjs.add(f.target,"mousedown",f.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.dbltap=a.dbltap;eventjs.Gesture._gestureHandlers.dblclick=a.dblclick;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.dragElement=function(c,b){a.drag({event:b,target:c,position:"move",listener:function(e,d){c.style.left=d.x+"px";c.style.top=d.y+"px";eventjs.prevent(e)}})};a.drag=function(c){c.gesture="drag";c.onPointerDown=function(d){if(a.pointerStart(d,b,c)){if(!c.monitor){eventjs.add(c.doc,"mousemove",c.onPointerMove);eventjs.add(c.doc,"mouseup",c.onPointerUp)}}c.onPointerMove(d,"down")};c.onPointerMove=function(e,d){if(!c.tracker){return c.onPointerDown(e)}var l=c.bbox;var j=e.changedTouches||a.getCoords(e);var f=j.length;for(var h=0;h<f;h++){var g=j[h];var k=g.identifier||Infinity;var m=c.tracker[k];if(!m){continue}m.pageX=g.pageX;m.pageY=g.pageY;b.state=d||"move";b.identifier=k;b.start=m.start;b.fingers=c.fingers;if(c.position==="differenceFromLast"){b.x=(m.pageX-m.offsetX);b.y=(m.pageY-m.offsetY);m.offsetX=m.pageX;m.offsetY=m.pageY}else{b.x=(m.pageX-m.offsetX);b.y=(m.pageY-m.offsetY)}c.listener(e,b)}};c.onPointerUp=function(d){if(a.pointerEnd(d,b,c,c.onPointerMove)){if(!c.monitor){eventjs.remove(c.doc,"mousemove",c.onPointerMove);eventjs.remove(c.doc,"mouseup",c.onPointerUp)}}};var b=a.pointerSetup(c);if(c.event){c.onPointerDown(c.event)}else{eventjs.add(c.target,"mousedown",c.onPointerDown);if(c.monitor){eventjs.add(c.doc,"mousemove",c.onPointerMove);eventjs.add(c.doc,"mouseup",c.onPointerUp)}}return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.drag=a.drag;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(b){var c=Math.PI/180;var a=function(g,h){var f=0;var e=0;var i=0;for(var d in h){var j=h[d];if(j.up){continue}f+=j.move.x;e+=j.move.y;i++}g.x=f/=i;g.y=e/=i;return g};b.gesture=function(e){e.gesture=e.gesture||"gesture";e.minFingers=e.minFingers||e.fingers||2;e.onPointerDown=function(i){var g=e.fingers;if(b.pointerStart(i,d,e)){eventjs.add(e.doc,"mousemove",e.onPointerMove);eventjs.add(e.doc,"mouseup",e.onPointerUp)}if(e.fingers===e.minFingers&&g!==e.fingers){d.fingers=e.minFingers;d.scale=1;d.rotation=0;d.state="start";var f="";for(var h in e.tracker){f+=h}d.identifier=parseInt(f);a(d,e.tracker);e.listener(i,d)}};e.onPointerMove=function(s,l){var f=e.bbox;var u=e.tracker;var p=s.changedTouches||b.getCoords(s);var g=p.length;for(var v=0;v<g;v++){var m=p[v];var j=m.identifier||Infinity;var q=u[j];if(!q){continue}q.move.x=(m.pageX-f.x1);q.move.y=(m.pageY-f.y1)}if(e.fingers<e.minFingers){return}var p=[];var x=0;var r=0;a(d,u);for(var j in u){var m=u[j];if(m.up){continue}var k=m.start;if(!k.distance){var o=k.x-d.x;var n=k.y-d.y;k.distance=Math.sqrt(o*o+n*n);k.angle=Math.atan2(o,n)/c}var o=m.move.x-d.x;var n=m.move.y-d.y;var h=Math.sqrt(o*o+n*n);x+=h/k.distance;var w=Math.atan2(o,n)/c;var t=(k.angle-w+360)%360-180;m.DEG2=m.DEG1;m.DEG1=t>0?t:-t;if(typeof(m.DEG2)!=="undefined"){if(t>0){m.rotation+=m.DEG1-m.DEG2}else{m.rotation-=m.DEG1-m.DEG2}r+=m.rotation}p.push(m.move)}d.touches=p;d.fingers=e.fingers;d.scale=x/e.fingers;d.rotation=r/e.fingers;d.state="change";e.listener(s,d)};e.onPointerUp=function(g){var f=e.fingers;if(b.pointerEnd(g,d,e)){eventjs.remove(e.doc,"mousemove",e.onPointerMove);eventjs.remove(e.doc,"mouseup",e.onPointerUp)}if(f===e.minFingers&&e.fingers<e.minFingers){d.fingers=e.fingers;d.state="end";e.listener(g,d)}};var d=b.pointerSetup(e);eventjs.add(e.target,"mousedown",e.onPointerDown);return d};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.gesture=b.gesture;return b})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.pointerdown=a.pointermove=a.pointerup=function(d){d.gesture=d.gesture||"pointer";if(d.target.isPointerEmitter){return}var b=true;d.onPointerDown=function(e){b=false;c.gesture="pointerdown";d.listener(e,c)};d.onPointerMove=function(e){c.gesture="pointermove";d.listener(e,c,b)};d.onPointerUp=function(e){b=true;c.gesture="pointerup";d.listener(e,c,true)};var c=a.pointerSetup(d);eventjs.add(d.target,"mousedown",d.onPointerDown);eventjs.add(d.target,"mousemove",d.onPointerMove);eventjs.add(d.doc,"mouseup",d.onPointerUp);d.target.isPointerEmitter=true;return c};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.pointerdown=a.pointerdown;eventjs.Gesture._gestureHandlers.pointermove=a.pointermove;eventjs.Gesture._gestureHandlers.pointerup=a.pointerup;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.shake=function(f){var k={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:f.target,listener:f.listener,remove:function(){window.removeEventListener("devicemotion",e,false)}};var d=4;var g=1000;var h=200;var b=3;var c=(new Date()).getTime();var j={x:0,y:0,z:0};var i={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}};var e=function(w){var s=0.8;var m=w.accelerationIncludingGravity;j.x=s*j.x+(1-s)*m.x;j.y=s*j.y+(1-s)*m.y;j.z=s*j.z+(1-s)*m.z;k.accelerationIncludingGravity=j;k.acceleration.x=m.x-j.x;k.acceleration.y=m.y-j.y;k.acceleration.z=m.z-j.z;if(f.gesture==="devicemotion"){f.listener(w,k);return}var t="xyz";var l=(new Date()).getTime();for(var q=0,p=t.length;q<p;q++){var r=t[q];var v=k.acceleration[r];var u=i[r];var z=Math.abs(v);if(l-c<g){continue}if(z>d){var y=l*v/z;var x=Math.abs(y+u.value);if(u.value&&x<h){u.value=y;u.count++;if(u.count===b){f.listener(w,k);c=l;u.value=0;u.count=0}}else{u.value=y;u.count=1}}}};if(!window.addEventListener){return}window.addEventListener("devicemotion",e,false);return k};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.shake=a.shake;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){var b=Math.PI/180;a.swipe=function(d){d.snap=d.snap||90;d.threshold=d.threshold||1;d.gesture=d.gesture||"swipe";d.onPointerDown=function(e){if(a.pointerStart(e,c,d)){eventjs.add(d.doc,"mousemove",d.onPointerMove).listener(e);eventjs.add(d.doc,"mouseup",d.onPointerUp)}};d.onPointerMove=function(h){var j=h.changedTouches||a.getCoords(h);var g=j.length;for(var f=0;f<g;f++){var l=j[f];var e=l.identifier||Infinity;var k=d.tracker[e];if(!k){continue}k.move.x=l.pageX;k.move.y=l.pageY;k.moveTime=(new Date()).getTime()}};d.onPointerUp=function(g){if(a.pointerEnd(g,c,d)){eventjs.remove(d.doc,"mousemove",d.onPointerMove);eventjs.remove(d.doc,"mouseup",d.onPointerUp);var r;var q;var m;var j;var i={x:0,y:0};var t=0;var s=0;var l=0;for(var h in d.tracker){var p=d.tracker[h];var n=p.move.x-p.start.x;var k=p.move.y-p.start.y;t+=p.move.x;s+=p.move.y;i.x+=p.start.x;i.y+=p.start.y;l++;var f=Math.sqrt(n*n+k*k);var e=p.moveTime-p.startTime;var j=Math.atan2(n,k)/b+180;var q=e?f/e:0;if(typeof(m)==="undefined"){m=j;r=q}else{if(Math.abs(j-m)<=20){m=(m+j)/2;r=(r+q)/2}else{return}}}var o=d.gestureFingers;if(d.minFingers<=o&&d.maxFingers>=o){if(r>d.threshold){i.x/=l;i.y/=l;c.start=i;c.x=t/l;c.y=s/l;c.angle=-((((m/d.snap+0.5)>>0)*d.snap||360)-360);c.velocity=r;c.fingers=o;c.state="swipe";d.listener(g,c)}}}};var c=a.pointerSetup(d);eventjs.add(d.target,"mousedown",d.onPointerDown);return c};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.swipe=a.swipe;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.longpress=function(b){b.gesture="longpress";return a.tap(b)};a.tap=function(c){c.delay=c.delay||500;c.timeout=c.timeout||250;c.driftDeviance=c.driftDeviance||10;c.gesture=c.gesture||"tap";var e,d;c.onPointerDown=function(f){if(a.pointerStart(f,b,c)){e=(new Date()).getTime();eventjs.add(c.doc,"mousemove",c.onPointerMove).listener(f);eventjs.add(c.doc,"mouseup",c.onPointerUp);if(c.gesture!=="longpress"){return}d=setTimeout(function(){if(f.cancelBubble&&++f.cancelBubbleCount>1){return}var h=0;for(var i in c.tracker){var g=c.tracker[i];if(g.end===true){return}if(c.cancel){return}h++}if(c.minFingers<=h&&c.maxFingers>=h){b.state="start";b.fingers=h;b.x=g.start.x;b.y=g.start.y;c.listener(f,b)}},c.delay)}};c.onPointerMove=function(g){var p=c.bbox;var l=g.changedTouches||a.getCoords(g);var h=l.length;for(var k=0;k<h;k++){var j=l[k];var m=j.identifier||Infinity;var s=c.tracker[m];if(!s){continue}var o=(j.pageX-p.x1);var n=(j.pageY-p.y1);var r=o-s.start.x;var q=n-s.start.y;var f=Math.sqrt(r*r+q*q);if(!(o>0&&o<p.width&&n>0&&n<p.height&&f<=c.driftDeviance)){eventjs.remove(c.doc,"mousemove",c.onPointerMove);c.cancel=true;return}}};c.onPointerUp=function(g){if(a.pointerEnd(g,b,c)){clearTimeout(d);eventjs.remove(c.doc,"mousemove",c.onPointerMove);eventjs.remove(c.doc,"mouseup",c.onPointerUp);if(g.cancelBubble&&++g.cancelBubbleCount>1){return}if(c.gesture==="longpress"){if(b.state==="start"){b.state="end";c.listener(g,b)}return}if(c.cancel){return}if((new Date()).getTime()-e>c.timeout){return}var f=c.gestureFingers;if(c.minFingers<=f&&c.maxFingers>=f){b.state="tap";b.fingers=c.gestureFingers;c.listener(g,b)}}};var b=a.pointerSetup(c);eventjs.add(c.target,"mousedown",c.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.tap=a.tap;eventjs.Gesture._gestureHandlers.longpress=a.longpress;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.wheelPreventElasticBounce=function(b){if(!b){return}if(typeof(b)==="string"){b=document.querySelector(b)}eventjs.add(b,"wheel",function(d,c){c.preventElasticBounce();eventjs.stop(d)})};a.wheel=function(f){var c;var h=f.timeout||150;var e=0;var j={gesture:"wheel",state:"start",wheelDelta:0,target:f.target,listener:f.listener,preventElasticBounce:function(l){var o=this.target;var n=o.scrollTop;var m=n+o.offsetHeight;var k=o.scrollHeight;if(m===k&&this.wheelDelta<=0){eventjs.cancel(l)}else{if(n===0&&this.wheelDelta>=0){eventjs.cancel(l)}}eventjs.stop(l)},add:function(){f.target[i](g,b,false)},remove:function(){f.target[d](g,b,false)}};var b=function(k){k=k||window.event;j.state=e++?"change":"start";j.wheelDelta=k.detail?k.detail*-20:k.wheelDelta;f.listener(k,j);clearTimeout(c);c=setTimeout(function(){e=0;j.state="end";j.wheelDelta=0;f.listener(k,j)},h)};var i=document.addEventListener?"addEventListener":"attachEvent";var d=document.removeEventListener?"removeEventListener":"detachEvent";var g=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";f.target[i](g,b,false);return j};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.wheel=a.wheel;return a})(eventjs.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.orientation=function(c){var b={gesture:"orientationchange",previous:null,current:window.orientation,target:c.target,listener:c.listener,remove:function(){window.removeEventListener("orientationchange",d,false)}};var d=function(f){b.previous=b.current;b.current=window.orientation;if(b.previous!==null&&b.previous!=b.current){c.listener(f,b);return}};if(window.DeviceOrientationEvent){window.addEventListener("orientationchange",d,false)}return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=a.orientation;return a})(Event.proxy);(function(){function d(f,g){if(!this.__eventListeners[f]){return}var e=this.__eventListeners[f];if(g){e[e.indexOf(g)]=false}else{fabric.util.array.fill(e,false)}}function a(e,f){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var g in e){this.on(g,e[g])}}else{if(!this.__eventListeners[e]){this.__eventListeners[e]=[]}this.__eventListeners[e].push(f)}return this}function c(e,f){if(!this.__eventListeners){return this}if(arguments.length===0){for(e in this.__eventListeners){d.call(this,e)}}else{if(arguments.length===1&&typeof arguments[0]==="object"){for(var g in e){d.call(this,g,e[g])}}else{d.call(this,e,f)}}return this}function b(g,h){if(!this.__eventListeners){return this}var f=this.__eventListeners[g];if(!f){return this}for(var j=0,e=f.length;j<e;j++){f[j]&&f[j].call(this,h||{})}this.__eventListeners[g]=f.filter(function(i){return i!==false});return this}geomap.Observable={fire:b,on:a,off:c,}})();(function(b){var m=Math.sqrt,n=Math.atan2,f=Math.pow,d=Math.PI/180,k=Math.PI/2;var o=/\{ *([\w_ -]+) *\}/g;var a=0;function e(p){return window["webkit"+p]||window["moz"+p]||window["ms"+p]}function g(q,r){var s=Array.prototype.slice;if(q.bind){return q.bind.apply(q,s.call(arguments,1))}var p=s.call(arguments,2);return function(){return q.apply(r,p.length?p.concat(s.call(arguments)):arguments)}}function j(p){var r=+new Date(),q=Math.max(0,16-(r-a));a=r+q;return window.setTimeout(p,q)}var i=window.requestAnimationFrame||e("RequestAnimationFrame")||j;var l=window.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(p){window.clearTimeout(p)};function h(r,q,p){if(p&&i===j){r.call(q)}else{return i.call(window,g(r,q))}}function c(p){if(p){l.call(window,p)}}geomap.util={formatNum:function(p,r){var q=Math.pow(10,(r===undefined?6:r));return Math.round(p*q)/q},isArray:Array.isArray||function(p){return(Object.prototype.toString.call(p)==="[object Array]")},template:function(q,p){return q.replace(o,function(t,r){var s=p[r];if(s===undefined){s="{"+r+"}"}else{if(typeof s==="function"){s=s(p)}}return s})},requestAnimFrame:h,cancelAnimFrame:c}})(typeof exports!=="undefined"?exports:this);geomap.CommonMethods={_setOptions:function(a){for(var b in a){this.set(b,a[b])}},_setObject:function(a){for(var b in a){this._set(b,a[b])}},set:function(a,b){if(typeof a==="object"){this._setObject(a)}else{this._set(a,b)}return this},_set:function(a,b){this[a]=b},toggle:function(b){var a=this.get(b);if(typeof a==="boolean"){this.set(b,!a)}return this},get:function(a){return this[a]},getOptions:function(){return this}};(function(){function b(d,h,e){if(e){if(!geomap.isLikelyNode&&h instanceof Element){d=h}else{if(h instanceof Array){d=[];for(var f=0,c=h.length;f<c;f++){d[f]=b({},h[f],e)}}else{if(h&&typeof h==="object"){for(var g in h){if(g==="canvas"||g==="group"){d[g]=null}else{if(h.hasOwnProperty(g)){d[g]=b({},h[g],e)}}}}else{d=h}}}}else{for(var g in h){d[g]=h[g]}}return d}function a(d,c){return b({},d,c)}geomap.util.object={extend:b,clone:a};geomap.util.object.extend(geomap.util,geomap.Observable)})();(function(){function b(j,k,m){k||(k={});m||(m={});var l=geomap.document.createElement(j);e(l,k);c(l,m);return l}function c(k,j){for(var l in j){k.style[l]=j[l]}}function e(k,j){for(var l in j){k[l]=j[l]}}function g(k,j,n,m){var l=(function(){var r=document.createElement("canvas"),o=r.getContext("2d"),p=window.devicePixelRatio||1,q=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;return p/q})();if(!m){m=l}k.width=j*m;k.height=n*m;k.style.width=j+"px";k.style.height=n+"px";k.getContext("2d").setTransform(m,0,0,m,0,0);return k}function a(k,j){j=j||"";if(j.replace(/\s/g,"").length==0){return false}return new RegExp(" "+j+" ").test(" "+k.className+" ")}function d(k,j){if(!a(k,j)){k.className+=" "+j}}function h(k,j){if(a(k,j)){var l=" "+k.className.replace(/[\t\r\n]/g,"")+" ";while(l.indexOf(" "+j+" ")>=0){l=l.replace(" "+j+" "," ")}k.className=l.replace(/^\s+|\s+$/g,"")}}function i(j){var s=new Object();var n=j.getElementsByTagName("input");for(var o=0;o<n.length;o++){var m=n[o];var r=m.name;var q="";if(m.type==="radio"){if(s[r]===undefined){s[r]=""}if(m.checked){q=m.value;s[r]=q}}else{if(m.type==="checkbox"){if(s[r]===undefined){s[r]=[]}if(m.checked){q=m.value;s[r].push(q)}}else{if(m.type!="button"&&m.type!="submit"){q=m.value;s[r]=q}}}}var k=j.getElementsByTagName("select");for(var o=0;o<k.length;o++){var m=k[o];var r=m.name;var l=m.selectedIndex;q=m.options[l].value;s[r]=q}var p=j.getElementsByTagName("textarea");for(var o=0;o<p.length;o++){var m=p[o];s[m.name]=m.value}return s}function f(t,o){var s="",v={};for(var q=0,n=t.length;q<n;q++){var l=t[q];if(l.name===o){v.form=l;for(var p=0,m=l.properties.length;p<m;p++){var u=l.properties[p];if(u.type==="text"){s+="<br><span style='min-width:100px;display: inline-block;text-align: right;padding: 4px;'>"+u.title+"</span><input type='text' name='"+u.id+"' value='"+u.value+"' />"}else{if(u.type==="hidden"){s+="<input type='hidden' name='"+u.id+"' value='"+u.value+"' />"}else{if(u.type==="radio"){s+="<br><span style='min-width:100px;display: inline-block;text-align: right;padding: 4px;' >"+u.title+"</span>";for(var r in u.option){if(u.value===u.option[r]){s+="<label><input type='radio' checked='checked' name='"+u.id+"' value='"+r+"' >"+u.option[r]+"</label>"}else{s+="<label><input type='radio' name='"+u.id+"' value='"+r+"' >"+u.option[r]+"</label>"}}}else{if(u.type==="checkbox"){s+="<br><span style='min-width:100px;display: inline-block;text-align: right;padding: 4px;' >"+u.title+"</span>";for(var r in u.option){if(u.value===u.option[r]){s+="<label><input type='checkbox' checked='checked' name='"+u.id+"' value='"+r+"' >"+u.option[r]+"</label>"}else{s+="<label><input type='checkbox' name='"+u.id+"' value='"+r+"' >"+u.option[r]+"</label>"}}}else{if(u.type==="select"){s+="<br><span style='min-width:100px;display: inline-block;text-align: right;padding: 4px;' >"+u.title+"</span>";s+="<select name='"+u.id+"'>";if(u.hasEmptyOption){s+="<option value='' >请选择</option>"}for(var r in u.option){if(u.value===u.option[r]){s+="<option selected='selected' value='"+r+"' >"+u.option[r]+"</option>"}else{s+="<option value='"+r+"' >"+u.option[r]+"</option>"}}s+="</select>"}}}}}}}}v.html=s;return v}geomap.util.element={create:b,setStyle:c,setOptions:e,hasClass:a,addClass:d,removeClass:h,formToJson:i,tplToFormHtml:f,createHiDPICanvas:g}})();(function(){geomap.util.event={_ev_xy_now:[0,0],_ev_xy_last:[0,0],_ev_smooth:[[0,0]],_ev_speed:[0,0],_ev_inertance:-1,_ev_speed_down:0.9,speedStart:function(a,c){this._ev_inertance=1;this._ev_speed=[0,0];this._ev_xy_last=[a,c];var b=[0,0];this._ev_smooth=[b,b,b,b,b,b,b,b,b,b,b,b]},speedEnd:function(){this._ev_inertance=-1},moving:function(a,b){this._ev_xy_now=[a,b]},speeding:function(){if(this._ev_inertance==1){var f=geomap.util.matrixSubtract(this._ev_xy_now,this._ev_xy_last);this._ev_smooth.push(f);this._ev_smooth.shift();var c=[0,0];var e=this._ev_smooth;var b=e.length;for(var d=0;d<b;d++){c=geomap.util.matrixAdd(c,e[d])}c[0]=c[0]/b;c[1]=c[1]/b;this._ev_speed=[Math.round(c[0]),Math.round(c[1])];this._ev_xy_last=this._ev_xy_now}else{var e=this._ev_speed,a=this._ev_speed_down;e=geomap.util.matrixMultiply(e,[a,a]);this._ev_speed=geomap.util.posFloor(e)}return this._ev_speed}}})();(function(){var g=Array.prototype.slice,f=function(){},d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})(),c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=null,k=this;while(k.constructor.superclass){var j=k.constructor.superclass.prototype[h];if(k[h]!==j){i=j;break}k=k.constructor.superclass.prototype}if(!i){return console.log("tried to callSuper "+h+", method not found in prototype chain",this)}return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}geomap.Class=e})();(function(){geomap.PosAnimation=geomap.Class(geomap.CommonMethods,geomap.Observable,{easeLinearity:0.5,initialize:function(a){a||(a={});this.fnContext=this;this._setOptions(a)},run:function(c,e,d,b,a){this.stop();this._callback=e;this._callbackContext=a||this;this._inProgress=true;this._duration=b||0.25;this._easeOutPower=1/Math.max(this.easeLinearity,0.2);this._pos=d;this._startPos=d[0];this._offset=d[1].subtract(this._startPos);this._startTime=+new Date();this.fire("start");this._animate();this.loopTarget=c;this._timerId=this._animate.bind(this);this.loopTarget.on("looptime",this._timerId)},stop:function(){if(!this._inProgress){return}this._step(true);this._complete()},_animate:function(){console.log("[Animation.js]_animate=========");this._step()},_step:function(b){var a=(+new Date())-this._startTime,c=this._duration*1000;console.log("[Animation.js]_step=========");if(a<c){this._runFrame(this._easeOut(a/c),b)}else{this._runFrame(1);this._complete()}},_runFrame:function(c,b){var a=this._offset.multiplyBy(c);var f=this._startPos.add(a);if(b){f._round()}var d={animationTarget:this,step:a,offset:this._offset,progress:c,pos:this._pos};console.log("[Animation.js]_runFrame=========");this._callback.call(this._callbackContext,f,d);this.fire("step")},_complete:function(){this.loopTarget.off("looptime",this._timerId);this._inProgress=false;this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}})})();(function(b){var c=geomap.util.object.extend;if(!b.geomap){b.geomap={}}if(b.geomap.Image){geomap.warn("geomap.Image is already defined.");return}var a={cacheImage:function(d){if(!this.__cache_imgs){this.__cache_imgs={}}var e=d.src;this.__cache_imgs[e]=d;return d},getCache:function(d){if(!this.__cache_imgs){return null}if(this.__cache_imgs[d]){return this.__cache_imgs[d]}return null},hasKey:function(d){if(!this.__load_img_key){this.__load_img_key={};this.__load_img_key[d]=1;return false}if(this.__load_img_key[d]){this.__load_img_key[d]=this.__load_img_key[d]+1;return true}else{this.__load_img_key[d]=1;return false}}};geomap.Image=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"image",x:0,y:0,lockKey:1,tileKey:null,tableKey:null,initialize:function(e,d){d||(d={});this._setOptions(d);this.setElement(e)},setElement:function(d){this._element=d;this._onloadHandle=this.onLoad.bind(this);this._element.onload=this._onloadHandle},getElement:function(){if(!this._element){var d=geomap.window.document.createElement("img");this.setElement(d)}return this._element},draw:function(d){d.drawImage(this._element,this.x,this.y)},onLoad:function(f,d){var g={img:f,target:this};this.fire("onload",g)},setSrc:function(d){this.getElement().src=d},fromURL:function(d){if(this.getElement().src==d){this.onLoad(this._element)}else{this.setSrc(d)}}})})(typeof exports!=="undefined"?exports:this);(function(){function c(d,e){return d+(/\?/.test(d)?"&":"?")+e}function a(){}function b(f,e){e||(e={});var j=e.method?e.method.toUpperCase():"GET",h=e.onComplete||function(){},i=new geomap.window.XMLHttpRequest(),d=e.body||e.parameters;headers=e.header||{};i.onreadystatechange=function(){if(i.readyState===4){h(i);i.onreadystatechange=a}};if(j==="GET"){d=null;if(typeof e.parameters==="string"){f=c(f,e.parameters)}}if(j==="JSON"){i.open("POST",f,true)}else{i.open(j,f,true)}for(var g in headers){i.setRequestHeader(g,headers[g])}if(j==="JSON"){i.setRequestHeader("Content-Type","application/json;charset=UTF-8")}else{if(j==="POST"||j==="PUT"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}}if(d!=undefined&&j==="JSON"&&d!=null){i.send(JSON.stringify(d))}else{i.send(d)}return i}geomap.request=b})();(function(){function f(g,h){if(typeof g=="string"){g=Number(g)}if(typeof h=="string"){h=Number(h)}this.x=g;this.y=h}var e=Math.trunc||function(g){return g>0?Math.floor(g):Math.ceil(g)};f.prototype={clone:function(){return new f(this.x,this.y)},zero:function(){this.x=0;this.y=0;return this},add:function(g){return this.clone()._add(g)},_add:function(g){this.x+=g.x;this.y+=g.y;return this},subtract:function(g){return this.clone()._subtract(g)},_subtract:function(g){this.x-=g.x;this.y-=g.y;return this},divideBy:function(g){return this.clone()._divideBy(g)},_divideBy:function(g){this.x/=g;this.y/=g;return this},multiplyBy:function(g){return this.clone()._multiplyBy(g)},_multiplyBy:function(g){this.x*=g;this.y*=g;return this},scaleBy:function(g){return this.clone()._scaleBy(g)},_scaleBy:function(g){this.x*=g.x;this.y*=g.y;return this},unscaleBy:function(g){return this.clone()._unscaleBy(g)},_unscaleBy:function(g){this.x=this.x/g.x;this.y=this.y/g.y;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){return this.clone()._ceil()},_ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},trunc:function(){return this.clone()._trunc()},_trunc:function(){this.x=e(this.x);this.y=e(this.y);return this},distanceTo:function(h){var g=h.x-this.x,i=h.y-this.y;return Math.sqrt(g*g+i*i)},equals:function(g){g=d(g);return g.x===this.x&&g.y===this.y},toString:function(){return"POINT("+this.x+" "+this.y+")"}};function d(g,h){if(g instanceof f){return g}if(geomap.util.isArray(g)){return new f(g[0],g[1])}if(typeof g==="object"&&"x" in g&&"y" in g){return new f(g.x,g.y)}return new f(g,h)}function b(g){if(g instanceof f){return true}return false}function a(g){return(g.x==0&&g.y==0)}function c(g){if(!g){return false}if(b(g)){return true}if(typeof g==="object"&&"x" in g&&"y" in g){return true}return false}geomap.Point=f;geomap.util.toPoint=d;geomap.util.isPoint=b;geomap.util.hasXY=c;geomap.util.isZeroPoint=a})();(function(){var b=geomap.Point;function a(f,e,h,g){this._a=f;this._b=e;this._c=h;this._d=g}a.prototype={setOrigin:function(c,e){this._b=c;this._d=e;return this},transform:function(c,d){return this._transform(c,d)},_transform:function(c,d){d=d||1;c.x=d*(this._a*c.x+this._b);c.y=d*(this._c*c.y+this._d);return c},untransform:function(c,d){d=d||1;return new b((c.x/d-this._b)/this._a,(c.y/d-this._d)/this._c)}};geomap.Transformtion=a})();(function(){var d=geomap.Point;function b(f){this._map=f}b.prototype={addEvent:function(f){eventjs.add(f,"gesture",this.handle.bind(this))},handle:function(g,f){eventjs.cancel(g);if(f.state=="start"){this._zooming=true;this._moved=false;this._zoom=this._map.zoom;return}else{if(f.state=="end"){this._map._touchZoomStatus=false;if(!this._moved||!this._zooming){this._zooming=false;return this}this._zooming=false;this._map.touchZoomEnd(g,this._centerPos,f.scale);return}else{if(!this._zooming){this._zooming=false;return this}if(!this._moved){var j=new d(f.touches[0].x,f.touches[0].y);var h=new d(f.touches[1].x,f.touches[1].y);var i=j.add(h)._divideBy(2);this._centerPos=i;this._map.touchZoomStart(g,this._centerPos);this._moved=true;return}this._map.touchZoom(g,this._centerPos,f.scale);return}}}};function a(f){this._map=f;this._inertia=false}a.prototype={addEvent:function(f){eventjs.add(f,"drag",this.handle.bind(this))},handle:function(g,f){if(!f.fingers||f.fingers==1){eventjs.cancel(g);if(f.state=="down"){this._draging=true;this._moved=false;if(this._inertia){this._times=[];this._positions=[]}return}else{if(f.state=="up"){if(!this._moved||!this._draging){this._draging=false;this._moved=false;return this}this._traging=false;this._map.dragEnd(g,new d(f.x,f.y));return this}else{if(!this._draging||this._map._touchZoomStatus){this._draging=false;return this}if(!this._moved){this._map.dragStart(g,new d(f.x,f.y));this._moved=true;return}if(this._inertia){}var h=new d(f.x,f.y);this._map.dragChange(g,h)}}}}};function e(f){this._map=f;this.wheelDebounceTime=40;this.wheelPxPerZoomLevel=60}function c(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}e.prototype={addEvent:function(f){eventjs.add(f,"wheel",this.handle.bind(this))},getWheelDelta:function(q){var g="ActiveXObject" in window;var k=g&&!document.addEventListener;var r=c("webkit");var l=c("android");var o=c("android 2")||c("android 3");var m=!!window.opera;var h=!n&&c("safari");var f=typeof orientation!=="undefined"||c("mobile");var j="msLaunchUri" in navigator&&!("documentMode" in document);var n=!j&&c("chrome");var p=navigator.platform.indexOf("Win")===0;var i=c("gecko")&&!r&&!m&&!g;var s=(p&&n)?2*window.devicePixelRatio:i?window.devicePixelRatio:1;return j?q.wheelDeltaY/2:(q.deltaY&&q.deltaMode===0)?-q.deltaY/s:(q.deltaY&&q.deltaMode===1)?-q.deltaY*20:(q.deltaY&&q.deltaMode===2)?-q.deltaY*60:(q.deltaX||q.deltaZ)?0:q.wheelDelta?(q.wheelDeltaY||q.wheelDelta)/2:(q.detail&&Math.abs(q.detail)<32765)?-q.detail*20:q.detail?q.detail/-32765*60:0},handle:function(h,g){eventjs.cancel(h);var i=g.wheelDelta;if(g.state=="start"){this._zooming=true;this._zooming_start=false}else{if(g.state=="end"){if(!this._zooming){this._zooming_start=false;this._zooming=false;return this}if(this._timer){clearTimeout(this._timer);this._timer=null}this._map.wheelZoomEnd(h,new d(h.offsetX,h.offsetY),i)}else{if(!this._zooming){return this}if(!this._zooming_start){this._zooming_start=true;this._map.wheelZoomStart(h,new d(h.offsetX,h.offsetY));return}var f=new d(h.offsetX,h.offsetY);this._map.wheelZoom(h,f,i)}}},_preformWheelZoom:function(g,f,h){this._map.wheelZoom(g,f,h)}};geomap.Event={TouchZoom:b,Drag:a,ScrollWheelZoom:e}})();(function(){var b=geomap.Point;function a(e,d){this.min=e;this.max=d}a.prototype={clone:function(){return new a(this.min.clone(),this.max.clone())},getCenter:function(){return new b((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2)},getBottomLeft:function(){return new b(this.min.x,this.max.y)},getTopRigth:function(){return new b(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var e,d;f=geomap.util.toPoint(f);e=f.min;d=f.max;return(e.x>=this.min.x)&&(d.x<=this.max.x)&&(e.y>=this.min.y)&&(d.y<=this.max.y)},intersects:function(i){var g=this.min,d=this.max,h=i.min,e=i.max,f=(e.x>=g.x)&&(h.x<=d.y),j=(e.y>=g.y)&&(h.y<=d.y);return f&&j},overlaps:function(j){var g=this.min,d=this.max,i=j.min,e=j.max,h=(e.x>g.x)&&(i.x<d.y),f=(e.y>g.y)&&(i.y<d.y);return h&&f},toString:function(){return"Bounds("+this.min.x+","+this.min.y+","+this.max.x+","+this.max.y+")"}};function c(e,d,i,h){var f=geomap.util.isPoint,g=geomap.util.hasXY;if(!e||e instanceof a){return e}if(d&&f(e)&&f(d)){return new a(e,d)}if(g(e)&&g(d)){return new a(toPoint(e),toPoint(d))}return new a(toPoint(e,d),toPoint(i,h))}geomap.Bounds=a;geomap.util.toBounds=c})();(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;geomap.Model={origin:new c(-180,90),tileSize:256,res:undefined,bounds:undefined,center:new c(0,0),viewSize:undefined,zoom:0,map:undefined,transformtion:new geomap.Transformtion(1,0,-1,0),transformtion2:new geomap.Transformtion(1,0,1,0),resolution:function(e){var d=(360/(Math.pow(2,e))/this.tileSize);var f=(180/(Math.pow(2,e))/this.tileSize);return new c(d,f)},getScale:function(d){return this.tileSize*Math.pow(2,d)},getZoomScale:function(d,e){e=e===undefined?this.zoom:e;return this.getScale(d)/this.getScale(e)},getBounds:function(){return this._getBounds().clone()},_getBounds:function(){if(!this._bounds||this._boundsChanged){var e,g,i,h,f,d;h=this.center;e=this.resolution(this.zoom);g=this.getSize().divideBy(2);i=e._scaleBy(g);f=h.subtract(this.modelCoord(i));d=h.add(this.modelCoord(i));this._bounds=new a(f,d);this._boundsChanged=false}return this._bounds},setZoom:function(d){if(this.zoom!=d){this._boundsChanged=true}this.zoom=d;return this},setZoomCoord:function(h,f){if(this.zoom==f){return this}var g=this.coordToScreen(h);var d=this.resolution(f);var e=h.subtract(this.modelCoord(g._scaleBy(d)));this.center=this.getSize().divideBy(2)._scaleBy(d).add(e);this.zoom=f;this._boundsChanged=true;return this},setZoomScreen:function(d,e){var f=d;r1=this.resolution(e),coord=this.screenToCoord(f),viewHalf=this.getSize().divideBy(2),centerOffset=viewHalf.subtract(f);this.center=coord._add(this.modelCoord(centerOffset._scaleBy(r1)));this.zoom=e;this._boundsChanged=true;return this},panScreen:function(f){var g=b(f);var e=this.zoom;var d=this.resolution(e);this.center._subtract(this.modelCoord(g.scaleBy(d)));this._boundsChanged=true},screenToCoord:function(g){var e=this.getBounds();var d=this.resolution(this.zoom);var f=this.modelCoord(d._scaleBy(g));return e.min._add(f)},coordToScreen:function(g){var e=this.getBounds();var d=this.resolution(this.zoom);var f=this.modelCoord(g.subtract(e.min));return f._unscaleBy(d)},toTransform:function(e,d){return this.transformtion.transform(e,d)},modelCoord:function(d){return this.toTransform(d,1)},toTransformScreen:function(d,e){return this.transformtion2.transform(d,e)}}})();(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;geomap.Caliper={capliperPos:[5,5],capliperHeight:150,capliperWidth:3,caliperDraw:function(t){var u=this.maxZoom;var e=this.minZoom;var m=this.zoom,j=u-e+1;var q=this.capliperPos[0],o=this.capliperPos[1],s=this.capliperHeight,g=Math.ceil(s/j),l=this.capliperWidth;s=g*(j-1);var f=m-e,k=o+f*g;t.fillStyle="#009688";t.strokeStyle="#009688";this.drawTriangle(t,q,k,l,q,o,g,l,f);if((f+1)==j){t.strokeStyle="#009688"}else{var r=(k-o+1)/s;r=r>1?1:r;var d=t.createLinearGradient(q,o,q,o+s);d.addColorStop(0,"#009688");d.addColorStop(r,"#009688");d.addColorStop(r,"#000000");d.addColorStop(1,"#000000");t.strokeStyle=d}t.beginPath();t.moveTo(q,o);t.lineTo(q,o+s);for(var h=0;h<j;h++){var n=h*g;var p=(h%2)*l+l;t.moveTo(q,o+n);t.lineTo(q+p,o+n)}t.stroke()},drawTriangle:function(q,p,o,e,n,m,g,k,j){q.fillStyle="#009688";q.strokeStyle="#009688";q.beginPath();q.moveTo(n,m);q.lineTo(n,o);for(var h=0;h<j;h++){var l=h*g;var f=(h%2)*k+k;q.moveTo(n,m+l);q.lineTo(n+f,m+l)}var d=j%2*k+k;q.moveTo(p,o);q.lineTo(p+d,o);q.stroke();q.moveTo(p,p);q.arc(p,o,e,0,Math.PI*2,true);q.fill()}}})();(function(){var a=geomap.Point;geomap.MapEvent={wheelDebounceTime:40,wheelPxPerZoomLevel:60,_preformWheelZoom:function(d,g){var h=this._wheel_delta,i=this.zoom,k=this.zoom,f=0,b=h/(this.wheelPxPerZoomLevel*4),l=4*Math.log(2/(1+Math.exp(-Math.abs(b))))/Math.LN2,j=f?Math.ceil(l/f)*f:l,c=this._limitZoom(k+(this._wheel_delta>0?j:-j))-k;if(this._wheel_delta>0){if(this._wheel_d0>=0){if(this._wheel_d0<this._wheel_delta){this._wheel_d0=this._wheel_delta;this._wheel_d1=0}else{if(this._wheel_d1==0){this._wheel_d1=1;var i=this.zoom;var k=this._limitZoom(i+1);this.setZoomScreen(g,k);this.fire("zoom",{event:d,point:g,delta:this._wheel_delta});this.fire("wheelzoom",{event:d,point:g,delta:this._wheel_delta,startZoom:i,endZoom:k})}else{this._wheel_d0=this._wheel_delta}}}}else{if(this._wheel_d2<=0){if(this._wheel_d2<=this._wheel_delta){this._wheel_d2=this._wheel_delta;this._wheel_d1=0}else{if(this._wheel_d1==0){this._wheel_d1=1;var i=this.zoom;var k=this._limitZoom(i-1);this.setZoomScreen(g,k);this.fire("zoom",{event:d,point:g,delta:this._wheel_delta});this.fire("wheelzoom",{event:d,point:g,delta:this._wheel_delta,startZoom:i,endZoom:k})}else{this._wheel_d2=this._wheel_delta}}}}this.__wheel_startTime=null;if(!c){return}var e=Math.ceil(k+c)},wheelZoomStart:function(c,b,d){this._wheel_delta=0;this._wheel_d0=0;this._wheel_d1=0;this._wheel_d2=0;this.fire("zoomstart",{event:c,point:b,delta:d,zoom:this.zoom})},wheelZoom:function(d,c,f){this._wheel_delta=f;if(!this.__wheel_startTime){this.__wheel_startTime=+new Date()}var b=Math.max(this.wheelDebounceTime-(+new Date()-this.__wheel_startTime),0);if(this.__wheeltimer){clearTimeout(this.__wheeltimer);this.__wheeltimer=null}this.__wheeltimer=setTimeout(this._preformWheelZoom.bind(this,d,c),b)},wheelZoomEnd:function(c,b,d){this._wheel_d0=0;this._wheel_d1=0;this._wheel_d2=0;this.fire("zoomend",{event:c,point:b,delta:d})},dragStart:function(c,b){this.__startPos=b;this.__bounds_changed=(!c.ctrlKey&&!c.altKey);this.fire("dragstart",{event:c,point:b,boundsChanged:this.__bounds_changed})},dragChange:function(c,b){if(this.__bounds_changed){this.panScreen(b.subtract(this.__startPos))}this.fire("drag",{event:c,point:b,boundsChanged:this.__bounds_changed});this.__startPos=b},dragEnd:function(c,b){this.fire("dragend",{event:c,point:b,boundsChanged:this.__bounds_changed});this.__bounds_changed=true},touchZoomStart:function(c,b){this.__touch_point=b;this.__touch_zoom=this.zoom;this.fire("touchzoomstart",{event:c,point:this.__touch_point})},touchZoom:function(g,f,i){var b=this.getScale(this.__touch_zoom);var d=b*i;var c=Math.round(Math.log(d/256)/Math.LN2);var h=this._limitZoom(c);this.setZoomScreen(this.__touch_point,h);this.zoom=h;this.fire("touchzoom",{event:g,scale:i,point:f})},touchZoomEnd:function(g,f,i){var b=this.getScale(this.__touch_zoom);var d=b*i;var c=Math.round(Math.log(d/256)/Math.LN2);var h=c;this.setZoomScreen(this.__touch_point,h);this.zoom=h;this.fire("touchzoomend",{event:g,scale:i,point:this.__touch_point})}}})();(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;geomap.MapRectSelect={_rectPoints:[],_movingPos:[0,0],RectSelectBindEvent:function(d){if(!this._RectSelectDrawDownID){this._RectSelectDrawDownID=this.RectSelectDrawDown.bind(this);this._RectSelectDrawUpID=this.RectSelectDrawUp.bind(this);this._RectSelectDrawMovingID=this.RectSelectDrawMoving.bind(this);this._RectSelectDrawID=this.RectSelectDraw.bind(this);d.on("mousedown",this._RectSelectDrawDownID);d.on("mouseup",this._RectSelectDrawUpID);d.on("mousemove",this._RectSelectDrawMovingID);d.on("drawingCanvas",this._RectSelectDrawID)}},RectSelectDrawDown:function(d){if(d.event.altKey){this.__status_draw=true;this.__status_draw_p0=d.point;this._movingPos=d.point;this.fire("drawCanvas")}},RectSelectDrawMoving:function(d){this._movingPos=d.point},RectSelectDrawUp:function(h){if(this.__status_draw&&this.__status_draw_p0){if(this.__status_draw_p0.equals(h.point)){var i=this.screenToCoord(h.point);var d={event:h,coord:i};this.fire("pointcoord",d);this.__status_draw=false;return}else{this.__status_draw_p1=h.point;var g=this.screenToCoord(this.__status_draw_p0);var f=this.screenToCoord(this.__status_draw_p1);var d={event:h,minx:Math.min(g.x,f.x),miny:Math.min(g.y,f.y),maxx:Math.max(g.x,f.x),maxy:Math.max(g.y,f.y)};this.fire("rectcoord",d);this.__status_draw=false}}},RectSelectDraw:function(d){if(this.__status_draw&&this._movingPos){var f=this.__status_draw_p0,e=this._movingPos;d.setLineDash([]);d.fillStyle="rgba(255, 255, 255, 0.4)";d.strokeStyle="#fff";d.beginPath();d.moveTo(f.x,f.y);d.lineTo(f.x,e.y);d.lineTo(e.x,e.y);d.lineTo(e.x,f.y);d.closePath();d.closePath();d.fill();d.stroke();this.fire("drawCanvas")}}}})();(function(){var b=geomap.util.object.extend;var a=geomap.Point;geomap.closeFrame=function(c){if(geomap.util.element.hasClass(c.target,"closeIcon")){c.target.parentNode.parentNode.parentNode.removeChild(c.target.parentNode.parentNode)}};geomap.FrameLayer=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"FrameLayer",paths:[],drawType:0,fill:true,loopRender:false,_enabled:true,container:null,headHeight:20,map:null,initialize:function(c,d){d||(d={});this._setOptions(d);this.container=c},addMap:function(c){this.map=c},createElement:function(c,h,d,g){var e=document.createElement(c);for(var f in h){e.style[f]=h[f]}if(d!=undefined){for(var f in d){e[f]=d[f]}}if(g!=undefined){e.innerHTML=g}return e},open:function(f){var k=this.map.getSize();var d=b({type:1,title:"",closeBtn:true,area:[400,200],offset:"center",body:"",borderRadius:"8px",background:"rgba(255,255,255,0.9)",headBorderBottom:"1px solid #e4e4e4",closeCallback:function(p,h){},okBtn:false,okCallback:function(p,h){}},f);var r=4,o=d.area[0],v=d.area[1],e=this.headHeight,x=o-2*r,t=v-e-2*r;var i=0,q=0,c=k.divideBy(2);if(d.offset==="center"){i=c.x-o/2;q=c.y-v/2}else{if(d.offset==="rb"){i=k.x-o;q=k.y-v}else{if(d.offset==="rt"){i=k.x-o}else{if(d.offset==="lb"){i=0;q=k.y-v}}}}var m={position:"absolute",width:o+"px",height:v+"px",border:"0px solid #989898",top:q+"px",left:i+"px",background:d.background,borderRadius:d.borderRadius,boxShadow:"2px 2px 4px #888888"};var l=this.createElement("div",m,{className:"frameLayer"});eventjs.add(l,"contextmenu",function(h){eventjs.stop(h)});m={position:"absolute",width:x+"px",height:e+"px",top:"0px",left:"0px",borderBottom:d.headBorderBottom,padding:r+"px"};var y=this.createElement("div",m);y.innerHTML='<b style="float:left">'+d.title+"</b>";l.appendChild(y);b(l,geomap.Observable);var j=function(w,h){this.outerHTML="";var p={target:l};d.closeCallback(w,p)}.bind(l);var u=this.createElement("span",{"float":"right",cursor:"pointer"},{className:"closeIcon"},"&nbsp; X &nbsp;");y.appendChild(u);m={position:"absolute",width:o+"px",height:t+"px",top:(v-t)+"px",left:"0px"};var s=this.createElement("div",m);s.innerHTML=d.body;if(d.okBtn){var n=this.createElement("input",{marginLeft:"100px"},{className:"btn",type:"button",value:"确定"});var g=function(w,h){var p={target:l,closeFn:j};d.okCallback(w,p)};eventjs.add(n,"click touch",g);s.appendChild(n)}l.appendChild(s);this.container.appendChild(l);eventjs.add(u,"click touch",j);l.on("close",j);return l}})})();(function(c){var d=geomap.util;var e=d.object.extend;var b=geomap.Point;var a=geomap.util.toPoint;if(!c.geomap){c.geomap={}}if(c.geomap.Map){geomap.warn("geomap.Map is already defined.");return}geomap.Map=geomap.Class(geomap.CommonMethods,geomap.Observable,geomap.Model,geomap.MapEvent,geomap.Caliper,geomap.MapRectSelect,{type:"object",width:100,height:1000,viewOrigin:{x:0,y:0},center:undefined,canvas:undefined,canvasCtx:undefined,bgCanvas:undefined,bgCanvasCtx:undefined,zoom:2,maxZoom:11,minZoom:0,layers:[],_global_interval:null,_canrender:true,_container:undefined,_geometrys:[],model:undefined,loopTime:40,canvasRatio:1,frameLayer:null,initialize:function(f,g){g||(g={});this._setOptions(g);this._sizeChanged=true;if(g.debug){geomap.debug=g.debug}if(this.center===undefined){this.center=new b(0,0)}else{this.center=a(this.center)}this._container=f;this._initElement();this.InitFrameLayer();this.on("drawmap",this.OnDrawMap.bind(this));this.on("drawCanvas",this.RedrawingCanvasTag.bind(this));this.on("clear_geometry",this.clearGeometry.bind(this));this.LoopTime()},_dispose:function(){geomap.util.cancelAnimFrame(this._global_interval);this._global_interval=null},_initElement:function(){this._container.style.position="absolute";this._container.style.overflow="hidden";var i=this.getSize();var j=i.x,f=i.y;var k=geomap.util.element.create("canvas",{id:"_map_canvas",width:j,height:f},{zIndex:2,border:"0px solid red",backgroundColor:"#e4e4e4",position:"absolute",width:j+"px",height:f+"px"});geomap.util.element.createHiDPICanvas(k,j,f,this.canvasRatio);var h=geomap.util.element.create("canvas",{width:j,height:f},{backgroundColor:"#e4e4e4",position:"absolute",width:j+"px",height:f+"px"});this.bgCanvas=h;this.bgCanvasCtx=h.getContext("2d");this._container.appendChild(k);this.canvas=k;const g=k.getContext("2d");this.canvasCtx=g;this._eventDrag=new geomap.Event.Drag(this);this._eventTouchZoom=new geomap.Event.TouchZoom(this);this._eventWheelZoom=new geomap.Event.ScrollWheelZoom(this);this._eventDrag.addEvent(this.canvas);this._eventTouchZoom.addEvent(this.canvas);this._eventWheelZoom.addEvent(this.canvas);this.RectSelectBindEvent(this);eventjs.add(this.canvas,"contextmenu",eventjs.cancel);eventjs.add(this.canvas,"click touch",function(n,m){var l=new b(n.offsetX||m.x,n.offsetY||m.y);var p=this.screenToCoord(l);var o=e({},{target:this,coord:p,point:l,event:n});this.fire("click",o)}.bind(this));eventjs.add(this.canvas,"mousedown",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mousedown",l)}.bind(this));eventjs.add(this.canvas,"mousemove",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mousemove",{event:o,point:m})}.bind(this));eventjs.add(this.canvas,"mouseup",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mouseup",l)}.bind(this))},InitFrameLayer:function(){var i=document.createElement("div");var f=this.getSize();var h={position:"absolute",zIndex:1000,left:"0px",top:"0px"};for(var g in h){i.style[g]=h[g]}this.frameLayer=new geomap.FrameLayer(i,{map:this});this._container.appendChild(i)},_limitZoom:function(f){if(this.maxZoom<f){return this.maxZoom}else{if(this.minZoom>f){return this.minZoom}}return f},LoopTime:function(){this.fire("looptime");for(var h=0,f=this.layers.length;h<f;h++){var g=this.layers[h];g.OnLoopTime()}this._redrawingCanvas.call(this);geomap.util.requestAnimFrame(this.LoopTime,this)},_redrawingCanvas:function(){if(this._redrawing==true||this._move_type==1){this._redrawing=false;const g=this.canvasCtx;var m=this.getSize();g.clearRect(0,0,m.x,m.y);for(var l=0,h=this.layers.length;l<h;l++){var j=this.layers[l];j.drawingCanvas(g)}var f=this._geometrys.length;if(f>0){for(var l=0;l<f;l++){var n=this._geometrys[l];n.render(g);if(n.loopRender){this._redrawing=true}}}this.caliperDraw(g);this.fire("drawingCanvas",g)}},OnDrawMap:function(){this.fire("viewreset");this._redrawing=true},RedrawingCanvasTag:function(){this._redrawing=true},_loadLayer:function(f){f.on("drawCanvas",this.RedrawingCanvasTag.bind(this));f.initLayer(this.canvas,this)},addLayer:function(f){this._loadLayer(f);this.layers.push(f);this.fire("drawmap")},setCenter:function(g,f){g=a(g);this.center=g;this._boundsChanged=true;if(f!=undefined&&typeof f=="number"){this.setZoom(f)}},animMove:function(h){h=a(h);var k,o=this.getSize(),j=this.coordToScreen(h).round();var m=o.divideBy(2).round();var i=Math.round(j.distanceTo(m));var g=Math.round(Math.sqrt(o.x*o.x+o.y*o.y));if(i>g){var f=i/g;var n,l;n=j.x-(j.x-m.x)*f;l=j.y+(m.y-j.y)*f;j=this.modelCoord(new b(n,l).round());k=this.screenToCoord(j)}else{k=this.center}if(!h.equals(this.center)){if(this._animMoveFn){this._animMoveFn.stop()}else{this._animMoveFn=new geomap.PosAnimation()}this._animMoveFn.run(this,function(p){this.setCenter(p);this.fire("drawmap")},[k,h],1,this)}},moveTo:function(h,f,g){this.setCenter(a(h));if(f===undefined){}else{if(typeof f=="string"){f=Number(f)}this.setZoom(f)}this.fire("drawmap")},getSize:function(){if(!this._size||this._sizeChanged){this._size=new b(this._container.clientWidth||this.width,this._container.clientHeight||this.height);this._sizeChanged=false}return this._size.clone()},resize:function(){this._sizeChanged=true;var f=this.getSize();geomap.util.element.createHiDPICanvas(this.canvas,f.x,f.y,this.canvasRatio);geomap.util.element.createHiDPICanvas(this.bgCanvas,f.x,f.y,this.canvasRatio);this._boundsChanged=true;this._redrawing=true;this.fire("resize");this.fire("drawmap")},getCoord:function(f){return this.model.screenToCoord(d.toPoint(f))},addGeometry:function(f){this._geometrys.push(f);this._redrawing=true},clearGeometry:function(){this._geometrys=[];this._redrawing=true}})})(typeof exports!=="undefined"?exports:this);(function(){geomap.Geometry=geomap.Class(geomap.CommonMethods,geomap.Observable,{_coordinates:[],_map:null,_start:true,_fill:false,_pointWeight:6,_type:0,style:{fillStyle:"rgba(0, 0, 0, 0.4)",strokeStyle:"rgba(0,255,255,0.9)",lineWidth:2},lineDashOffset:0,lineDash:[],loopRender:false,initialize:function(b,a){a||(a={});this._setOptions(a);this._map=b;this._type=0},setMap:function(a){this._map=a},s2c:function(a){return this._map.screenToCoord(a)},c2s:function(a){return this._map.coordToScreen(a).round()},addCoord:function(b){var a=this._coordinates.length;if(a>0){if(!this._coordinates[a-1].equals(b)){this._coordinates.push(b)}}else{this._coordinates.push(b)}},setType:function(a,b){this.clear();this._fill=b||false;if(typeof a=="string"){if(a=="Polygon"){this._type=0}else{if(a=="Point"){this._type=1}else{if(a=="Line"){this._type=2}else{if(a=="Rect"){this._type=3}else{if(a=="Circle"){this._type=4}}}}}}else{this._type=a}},getType:function(){var a="Polygon";switch(this._type){case 1:a="Point";break;case 2:a="Line";break;case 3:a="Rect";break;case 4:a="Circle";break}return a},push:function(a){var b=this.s2c(a);this.addCoord(b)},clear:function(){var c=this._coordinates;this._coordinates=[];var a=c.length;for(var b=0;b<a;b++){c[b]=null}},moveTo:function(a){if(this._start){this._movePoint=a}},end:function(){this._movePoint=null;this._start=false;var a=this._coordinates.length;switch(this._type){case 0:if(a>2){this._coordinates.push(this._coordinates[0])}else{this.clear()}break;case 2:if(a<2){this.clear()}break;case 3:case 4:if(a!=2){this.clear()}break}},isEnd:function(){switch(this._type){case 1:return this._coordinates.length==1;case 3:case 4:return this._coordinates.length==2}return false},setStyle:function(a){var b=this.style;for(var c in b){a[c]=b[c]}},getText:function(){var a=this.getJson();return JSON.stringify(a)},getJson:function(){var e=this._coordinates,b=e.length;var a={type:"",coordinates:[]};if(b<1){return a}switch(this._type){case 1:a.type="Point";a.coordinates=[e[0].x,e[0].y];break;case 2:a.type="Line";for(var c=0;c<b;c++){a.coordinates.push([e[c].x,e[c].y])}break;case 3:a.type="Polygon";if(b>1){var g=e[0],f=e[1],d=[];d.push([g.x,g.y]);d.push([g.x,f.y]);d.push([f.x,f.y]);d.push([f.x,g.y]);d.push([g.x,g.y]);a.coordinates.push(d)}break;default:a.type="Polygon";if(b>1){var g=e[0],f=e[1],d=[];for(var c=0;c<b;c++){d.push([e[c].x,e[c].y])}a.coordinates.push(d)}}return a},render:function(b){var a=this._coordinates.length;b.setLineDash([]);if(this.lineDash&&this.lineDash.length>1){b.setLineDash(this.lineDash);b.lineDashOffset=this.lineDashOffset;this.lineDashOffset+=1;this.loopRender=true}else{this.loopRender=false}if(a>0){this.setStyle(b);switch(this._type){case 0:b.beginPath();var h=this.c2s(this._coordinates[0]);b.moveTo(h.x,h.y);for(var c=1;c<a;c++){var g=this._coordinates[c];var e=this.c2s(g);b.lineTo(e.x,e.y)}if(this._start&&this._movePoint&&this._movePoint!=null){b.lineTo(this._movePoint.x,this._movePoint.y)}b.closePath();b.stroke();if(this._fill){b.fill()}break;case 1:var e=this.c2s(this._coordinates[0]),d=this._point_weight;b.fillRect(e.x-d/2,e.y-d/2,d,d);b.strokeRect(e.x-d/2,e.y-d/2,d,d);break;case 2:b.beginPath();var h=this.c2s(this._coordinates[0]);b.moveTo(h.x,h.y);for(var c=1;c<a;c++){var g=this._coordinates[c];var e=this.c2s(g);b.lineTo(e.x,e.y)}if(this._start&&this._movePoint&&this._movePoint!=null){b.lineTo(this._movePoint.x,this._movePoint.y)}b.stroke();break;case 3:var h=this.c2s(this._coordinates[0]),f;if(a==2){f=this.c2s(this._coordinates[1]).subtract(h);this._fill?b.fillRect(h.x,h.y,f.x,f.y):b.strokeRect(h.x,h.y,f.x,f.y)}else{if(this._start&&this._movePoint&&this._movePoint!=null){f=this._movePoint.subtract(h);this._fill?b.fillRect(h.x,h.y,f.x,f.y):b.strokeRect(h.x,h.y,f.x,f.y)}}}}}})})();(function(){var a=geomap.Point;geomap.Path=geomap.Class(geomap.Geometry,{lineDash:null,initialize:function(c,b){b||(b={});this.callSuper("initialize",c,b)},setData:function(e){var b=e.coordinates;this._type=0;this._coordinates=[];if(b.length>0){var f=b[0];if(f.length>0){for(var d=0,c=f.length;d<c;d++){this._coordinates.push(new a(f[d][0],f[d][1]))}}}this._map.fire("drawmap")}})})();(function(){var b=geomap.Point;var a=geomap.util.object.clone;geomap.Polygon=geomap.Class(geomap.Geometry,{initialize:function(d,c){c||(c={});this.callSuper("initialize",d,c);this._type=0},setData:function(f){var c=f.coordinates;this._type=0;this._coordinates=[];if(c.length>0){var g=c[0];if(g.length>0){for(var e=0,d=g.length;e<d;e++){this._coordinates.push(new b(g[e][0],g[e][1]))}}}this._map.fire("drawmap")}})})();(function(){var a=geomap.Point;geomap.Marker=geomap.Class(geomap.CommonMethods,geomap.Observable,geomap.Geometry,{type:"Marker",canvas:null,ctx:null,point:null,width:400,height:200,ratio:3,radius:10,lineV:20,padding:10,textRows:[],style:{fillStyle:"rgba(0, 0, 0, 0.9)"},fontStyle:{font:"bold 14px serif",fillStyle:"white"},initialize:function(e,d){this._map=e;d||(d={});if(d.style){d.style=geomap.util.object.extend(this.style,d.style)}this._setOptions(d);this._type=0;var c=geomap.util.element.create("canvas");var b=c.getContext("2d");geomap.util.element.createHiDPICanvas(c,this.width,this.height,this.ratio);this.canvas=c;this.ctx=b;this.point=new a(100,100)},setData:function(f){var g=f.geometry;var d=f.properties;this.textRows=[];if(d!=undefined){var b=this.ctx;var e=this.getRectTextSize();for(var c in d){this.drawText(b,c+":"+d[c],e[0])}}this.draw();this._map.fire("drawmap")},draw:function(){var k=this.ctx,d=this.width,j=this.height;k.clearRect(0,0,d,j);this.roundedRect(k,0,0,d,j,this.radius);var e=this.fontStyle;for(var c in e){k[c]=e[c]}var h=this.textRows.length,g=this.padding+this.lineV,i=this.padding;for(var f=0;f<h;f++){k.fillText(this.textRows[f],i,g);g+=this.lineV}},getRectTextSize:function(){var b=this.width-(this.padding*2),c=this.height-(this.padding*2);return[b,c]},drawText:function(d,f,c){var g=f.split("");var e="";for(var b=0;b<g.length;b++){if(d.measureText(e).width<c&&d.measureText(e+(g[b])).width<=c){e+=g[b]}else{this.textRows.push(e);e=g[b]}}this.textRows.push(e)},render:function(c){var b=this.width,d=this.height;c.drawImage(this.canvas,this.point.x,this.point.y,b,d)},roundedRect:function(e,d,g,f,c,b){this.setStyle(e);e.beginPath();e.moveTo(d,g+b);e.lineTo(d,g+c-b);e.quadraticCurveTo(d,g+c,d+b,g+c);e.lineTo(d+f-b,g+c);e.quadraticCurveTo(d+f,g+c,d+f,g+c-b);e.lineTo(d+f,g+b);e.quadraticCurveTo(d+f,g,d+f-b,g);e.lineTo(d+b,g);e.quadraticCurveTo(d,g,d,g+b);e.fill()}})})();(function(b){var d=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.Layer){geomap.warn("geomap.Map is already defined.");return}var c={type:"Layer",width:100,height:100,_canvas:null,_map:undefined,transformtion:null,wheelZoomChanage:false,canvas:null,canvasCtx:null,cacheTime:0,initLayer:function(e,g){this.transformtion=new geomap.Transformtion(-1,0,-1,0);this._canvas=e;this._drawLock=1;this._map=g;this.cacheTime=+new Date();var e=geomap.util.element.create("canvas",{},{zIndex:2,border:"1px solid blue",backgroundColor:"#e4e4e4",position:"absolute",top:"0px"});const f=e.getContext("2d");this.canvas=e;this.canvasCtx=f;this.OnResize();g.on("resize",this.OnResize.bind(this));g.on("viewreset",this.ViewReset.bind(this));g.on("dragstart",this.OnDragStart.bind(this));g.on("drag",this.OnDrag.bind(this));g.on("dragend",this.OnDragEnd.bind(this));g.on("touchzoomstart",this.OnTouchZoomStart.bind(this));g.on("touchzoom",this.OnTouchZoom.bind(this));g.on("touchzoomend",this.OnTouchZoomEnd.bind(this));g.on("wheelzoom",this.OnScrollZoom.bind(this));this.fire("initLayer");this.ViewReset()},OnResize:function(){var e=this._map.getSize();this.width=e.x;this.height=e.y;this.canvas.width=e.x;this.canvas.height=e.y;this.canvas.style.width=e.x+"px";this.canvas.style.height=e.y+"px"},OnTouchZoomStart:function(e){var f=e.event,g=e.point;this._touchZoomStart=g},OnTouchZoom:function(e){var f=e.event,g=e.scale;this._canvasScale=geomap.util.formatNum(g,4);this.fire("drawCanvas")},OnTouchZoomEnd:function(e){this._touchZoomStart=null;this.ViewReset()},scrollZoomEnd:function(e){this._canvasScale=1;this.ViewReset()},OnScrollZoom:function(e){if(e.startZoom==e.endZoom){return}if(this._animMoveFn){this._animMoveFn.stop()}else{this._animMoveFn=new geomap.PosAnimation({easeLinearity:0.1});this._animMoveFn.on("end",function(){this._touchZoomStart=null;this._canvasScale=1;this.wheelZoomChanage=false;this.ViewReset()}.bind(this))}this._touchZoomStart=e.point;this._animMoveFn.run(this._map,function(j,h){var g=this._map.getScale(h.pos[0].x)/256;var f=this._map.getScale(j.x)/256;var i=f/g;this._canvasScale=i;this.wheelZoomChanage=true;this.fire("drawCanvas")},[new a(e.startZoom,0),new a(e.endZoom,0)],0.4,this)},OnDragStart:function(e){this._dragStartPos=e.point},OnDrag:function(e){if(e.boundsChanged){this._dragOffset=e.point.subtract(this._dragStartPos);this.fire("drawCanvas")}},OnDragEnd:function(e){this._dragOffset=null;this.ViewReset()},ViewReset:function(){this.fire("drawCanvas")},getCanavsSize:function(){return this._map.getSize()},OnLoopTime:function(){},refreshCache:function(){this.cacheTime=+new Date();this.ViewReset()}};geomap.Layer=geomap.Class(geomap.CommonMethods,geomap.Observable,c,{initialize:function(e){e||(e={});this._setOptions(e)},drawingCanvas:function(l){var e=this._map,j=new a(0,0),m=this.getCanavsSize(),h=this._dragOffset||j,k=(this._touchZoomStart||j),f=(this._canvasScale||1),g=m.multiplyBy(f).round();var i=this.transformtion.transform(k.clone(),f)._add(k).add(h).round();l.drawImage(this.canvas,i.x,i.y,g.x,g.y)}})})(typeof exports!=="undefined"?exports:this);(function(b){var c=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.TileLayer){geomap.warn("geomap.Map is already defined.");return}geomap.TileLayer=geomap.Class(geomap.Layer,{url:null,_drawLock:1,cache:true,_canvas_map_size:new a(0,0),_mapSize:null,initialize:function(d){this.callSuper("initialize",d);this.on("initLayer",this.OnInitLayer.bind(this))},OnInitLayer:function(){this.getCanavsSize()},getCanavsSize:function(){var e=this._map,d=e.getSize();if(!this._canvas_copy_size||!this._mapSize||!d.equals(this._mapSize)){this._mapSize=d.clone();this._canvas_copy_size=d.multiplyBy(3);this.canvas.width=this._canvas_copy_size.x;this.canvas.height=this._canvas_copy_size.y;this.canvas.style.width=this._canvas_copy_size.x+"px";this.canvas.style.height=this._canvas_copy_size.y+"px";this._canvas_map_size=d;this.transformtion.setOrigin(-d.x,-d.y)}return this._canvas_copy_size},ViewReset:function(){this._canvasScale=1;var F=this._map,o=F.zoom,f=F.tileSize,m=F.getBounds(),G=F.resolution(o),e=this.getCanavsSize(),C=this._canvas_map_size,E=this._drawLock+1;var g=Math.round(C.x/f)+2;var s=Math.round(C.y/f)+2;var i=this.OriginTileInfo(G,m.min);var d=i.cell;var j=i.row;var h=i.left;var w=i.top;this._drawLock=E;this.canvasCtx.clearRect(0,0,e.x,e.y);for(var D=-0,B=g;D<B;D++){for(var v=-0,n=s;v<n;v++){var q=1*d+D;var p=1*j+v;var A=Math.floor(h+f*D)+C.x;var u=Math.floor(w+f*v)+C.y;if(q>=0&&p>=0){this.loadTile(D,v,A,u,o,q,p)}}}this.fire("drawCanvas")},getTileImage:function(k,n,h,j,i){if(!this._tileImageMap){this._tileImageMap={}}var o=k+"-"+n;var f=h+"-"+j+"-"+i;var l=this._tileImageMap[o];if(!l){l=new geomap.Image(geomap.window.document.createElement("img"));l.tileKey=f;l.tableKey=o;l.on("onload",this._imageLoad.bind(this));this._tileImageMap[o]=l}else{for(var g in this._tileImageMap){var m=this._tileImageMap[g];var d=m.tableKey;var e=m.tileKey;if(e===f){m.tableKey=o;l.tableKey=d;this._tileImageMap[o]=m;this._tileImageMap[d]=l;return m}}}return l},loadTile:function(j,l,d,h,f,i,g){var e=this.getTileImage(j,l,f,i,g);e.tileKey=f+"-"+i+"-"+g;e.x=d,e.y=h;var k=geomap.util.template(this.url+(/\?/.test(this.url)?"&":"?")+"cacheTime={cacheTime}",{z:f,x:i,y:g,cacheTime:this.cacheTime});e.fromURL(k)},_imageLoad:function(d){d.target.draw(this.canvasCtx);this.fire("drawCanvas")},OriginTileInfo:function(h,g){var d=this._map,e=d.origin,m=d.tileSize;var k=g.x,j=g.y;var l=Math.floor((g.x-e.x)/h.x/m);var n=Math.floor((e.y-g.y)/h.y/m);var f=-(g.x-e.x)/h.x+m*l;var i=-(e.y-g.y)/h.y+m*n;return{cell:l,row:n,left:f,top:i,res:h,tsize:m}}})})(typeof exports!=="undefined"?exports:this);(function(b){var c=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.Palette){geomap.warn("geomap.Map is already defined.");return}geomap.VectorLayer=geomap.Class(geomap.Layer,{type:"VectorLayer",paths:[],drawType:0,fill:true,loopRender:false,_enabled:true,initialize:function(d){this.callSuper("initialize",d);this.on("initLayer",this.OnInitLayer.bind(this))},OnInitLayer:function(){this.transformtion.setOrigin(0,0)},setType:function(d,e){this.drawType=d;if(e!=undefined){this.fill=e}if(this._pathing){this._pathing.setType(this.drawType,this.fill)}},addData:function(g,e){if(g.type=="FeatureCollection"){var d=g.features.length;for(var f=0;f<d;f++){var j=g.features[f].geometry;var h=new geomap.Path(this._map,e);h.setData(j);this.paths.push(h)}}else{if(g.type=="Feature"){var j=g.geometry;var h=new geomap.Path(this._map,e);h.setData(j);this.paths.push(h)}else{this.paths.push(g)}}this.ViewReset()},clearData:function(){this.paths=[];this.ViewReset()},OnLoopTime:function(){if(this.loopRender&&(this._canvasScale==1||this._canvasScale==undefined)){this._dragOffset=null;this.ViewReset()}},ViewReset:function(){if(!this.wheelZoomChanage&&(this._canvasScale==1||this._canvasScale==undefined)){this.canvasCtx.clearRect(0,0,this.width,this.height);this._canvasScale=1;var j=this._map.zoom,g=this._map.getBounds(),f=this._map.resolution(j);this.loopRender=false;if(this.paths.length>0){for(var e=0,d=this.paths.length;e<d;e++){var h=this.paths[e];this.canvasCtx.setLineDash([]);h.render(this.canvasCtx);if(h.loopRender){this.loopRender=true}}}if(this._pathing&&this._pathing!=null){this._pathing.render(this.canvasCtx)}this.fire("drawCanvas")}}})})(typeof exports!=="undefined"?exports:this);(function(b){var c=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.Palette){geomap.warn("geomap.Map is already defined.");return}geomap.PaletteLayer=geomap.Class(geomap.Layer,{type:"PaltteLayer",paths:[],drawType:0,fill:true,loopRender:false,_enabled:true,referenceLine:false,initialize:function(d){this.callSuper("initialize",d);this.on("initLayer",this.OnInitLayer.bind(this))},OnInitLayer:function(){this._map.on("mousedown",this.OnMouseDown.bind(this));this._map.on("mousemove",this.OnMouseMove.bind(this));this._map.on("mouseup",this.OnMouseUp.bind(this));this.transformtion.setOrigin(0,0)},setType:function(d,e){this.drawType=d;if(e!=undefined){this.fill=e}if(this._pathing){this._pathing.setType(this.drawType,this.fill)}},OnMouseDown:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(d.ctrlKey){eventjs.cancel(d);this._opendraw=true;if(this._palette_drawing){this.fire("draw_point",g)}else{this._palette_drawing=true;this.fire("draw_start",g)}if(!this._pathing||this._pathing===null){this._pathing=new geomap.Path(this._map,{lineDash:[]});this._pathing.setType(this.drawType,this.fill)}}else{this._opendraw=false}},OnMouseMove:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(this._opendraw){if(!d.ctrlKey){if(this._palette_drawing){this._palette_drawing=false;this.fire("draw_end",g)}}else{if(this._palette_drawing){this.fire("draw_moving",g)}}if(this._pathing){if(!d.ctrlKey){this.PathEnd(g,f)}else{this._pathing.moveTo(f);this.ViewReset()}}}},OnMouseUp:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(!this._opendraw){this.PathEnd(g,f)}else{if(this._opendraw&&this._pathing){var f=g.point;this._pathing.push(f);this.ViewReset();if(this._pathing.isEnd()){this.PathEnd(g,f)}}}},addGeometry:function(d){this.paths.push(d);this.ViewReset()},clearGeometry:function(){this.paths=[];this.ViewReset()},PathEnd:function(f,d){if(this._pathing&&this._pathing!=null){this._pathing.end();this.fire("geometry_change",this._pathing);this.paths.push(this._pathing);this._pathing=null;this.ViewReset()}},OnLoopTime:function(){if(this.loopRender&&(this._canvasScale==1||this._canvasScale==undefined)){this._dragOffset=null;this.ViewReset()}},drawingCanvas:function(d){this.callSuper("drawingCanvas",d);this.drawReferenceLine(d)},ViewReset:function(){var d=this.canvasCtx;if(!this.wheelZoomChanage&&(this._canvasScale==1||this._canvasScale==undefined)){d.clearRect(0,0,this.width,this.height);d.setLineDash([]);this._canvasScale=1;var l=this._map.zoom,h=this._map.getBounds(),g=this._map.resolution(l);this.loopRender=false;if(this.paths.length>0){for(var f=0,e=this.paths.length;f<e;f++){var j=this.paths[f];j.render(d);if(j.loopRender){this.loopRender=true}}}if(this._pathing&&this._pathing!=null){this._pathing.render(d)}this.fire("drawCanvas")}},toggleReferenceLine:function(){this.toggle("referenceLine");this.fire("drawCanvas")},drawReferenceLine:function(f){if(!this.referenceLine){return}var e=this.width,j=this.height,l=20;f.strokeStyle="rgba(66, 66, 66, 0.3)";f.beginPath();for(var g=0;g<e;g++){var d=g*l,k=0;f.moveTo(d,k);f.lineTo(d,j)}for(var g=0;g<j;g++){var k=g*l,d=0;f.moveTo(d,k);f.lineTo(e,k)}f.stroke();l=10;f.strokeStyle="rgba(224, 224, 224, 0.3)";f.beginPath();for(var g=0;g<e;g++){var d=g*l,k=0;f.moveTo(d,k);f.lineTo(d,j)}for(var g=0;g<j;g++){var k=g*l,d=0;f.moveTo(d,k);f.lineTo(e,k)}f.stroke()}})})(typeof exports!=="undefined"?exports:this);