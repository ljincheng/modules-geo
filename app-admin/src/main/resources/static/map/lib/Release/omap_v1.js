var MapGISConfig={source:((typeof MapGISConfig=="object"&&MapGISConfig.registerSourcePath)?MapGISConfig.registerSourcePath:"lib/source/")};(function(){window.MapGIS=new Hash({version:"3.0.0",path:{source:MapGISConfig.source,themes:"themes/",plugins:"plugins/"},files:new Hash(),lastSeqID:0,createUniqueID:function(A){if(A==null){A="id_"}MapGIS.lastSeqID+=1;return A+MapGIS.lastSeqID},getElement:function(){var D=[];for(var C=0,A=arguments.length;C<A;C++){var B=arguments[C];if(typeof B=="string"){B=document.getElementById(B)}if(arguments.length==1){return B}D.push(B)}return D},False:function(){return false},True:function(){return true},Tween:function(A){return(A/=1)*A},correctPNG:function(){if(Browser.Engine.trident4){var H=document.getElementsByName("PngImgs");for(var F=0;F<H.length;){var D=H[F];var B;var A=(D.id)?"id='"+D.id+"' ":"";var E=(D.className)?"class='"+D.className+"' ":"";var G=(D.title)?"title='"+D.title+"' ":"title='"+D.alt+"' ";var C="display:inline-block;"+D.style.cssText;if(D.align=="left"){C="float:left;"+C}if(D.align=="right"){C="float:right;"+C}if(D.parentElement.href){C="cursor:hand;"+C}B="<span unselectable ='on' "+A+E+G+' style="width:'+D.width+"px; height:"+D.height+"px;"+C+";text-decoration:none;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+D.src+"', sizingMethod='scale');\"></span>";if(item.morph){item.morph=null}D.outerHTML=B;if(D.destroy){D.destroy()}D=null}}},getSize:function(C){var D=(typeof(C)=="object")?C:document.getElementById(C);var B=[D.offsetWidth,D.offsetHeight];if(D==document.body&&!document.all){B[1]=D.clientHeight}if(!B[0]){B[0]=D.clientWidth}if(!B[0]){B[0]=parseInt(D.style.width)}if(!B[1]){B[1]=D.clientHeight}if(!B[1]){B[1]=parseInt(D.style.height)}if(!B[0]||!B[1]){var A=D.parentElement;while(A){if(!B[0]&&A.offsetWidth){B[0]=A.offsetWidth}if(!B[1]&&A.offsetHeight){B[1]=A.offsetHeight}if(B[0]&&B[1]){break}A=A.parentElement}}return B},getClientXY:function(A,E){if(typeof(A.client)!="undefined"){var B=$(E.id).getPosition();return[A.client.x-B.x,A.client.y-B.y]}else{if(typeof A.offsetX!="undefined"){var C=A.target||A.srcElement;var D=[A.offsetX,A.offsetY];while(C&&C!=E){if(C.tagName=="AREA"){C=C.offsetParent||C.parentElement;continue}D[0]+=C.offsetLeft;D[1]+=C.offsetTop;C=C.offsetParent||C.parentElement}return[D[0],D[1]]}else{if(typeof A.pageX!="undefined"){var D=MapGIS.getAbsolutePos(E);return[A.clientX-D[0],A.clientY-D[1]]}else{return[0,0]}}}},getAbsolutePos:function(C){var A=[0,0];var B=C;while(B&&B.offsetParent){A[0]+=B.offsetLeft;A[1]+=B.offsetTop;B=B.offsetParent}return A},getExtentCenter:function(B){var A=(B[2]+[0])/2;var C=(B[3]+[1])/2;return[A,C]},closeTabWindow:function(C,A){var B=(A)?A:window.event;if(window.event){B.cancelBubble=true}else{B.stopPropagation()}if($(C)){$(C).fade("out")}},stopPropagation:function(A){var A=(event)?event:window.event;if(window.event){A.cancelBubble=true}else{A.stopPropagation()}}})})();
(function(){MapGIS.extend({Geometry:new Class({Implements:[Events,Options],options:{width:3000,height:3000,resolution:1,extent:{xmin:0,ymin:0,xmax:0,ymax:0}},container:null,root:null,vectorRoot:null,toMap:function(B){var E=this.options.extent.xmin;var A=this.options.extent.ymax;var D=this.options.resolution;var C=B[0]*D+E;var F=A-B[1]*D;return[C,F]},toScreen:function(B){var D=this.options.extent.xmin;var A=this.options.extent.ymax;var C=this.options.resolution;return[Math.round((B[0]-D)/C),Math.round((A-B[1])/C)]},initialize:function(A,B){this.setOptions(B);if(A!=null){this.container=MapGIS.getElement(A);this.root=new ART(this.options.width,this.options.height);this.setStyle(this.root,null,{hasStyle:true});this.root.inject(this.container)}},setResolution:function(A,B){this.options.extent=B;this.options.resolution=A},creatGroup:function(){var A=this.groupFactory();A.inject(this.root);return A},getGroup:function(B){var C=this.root.children;var A=C.length;if(A>B){return C[B]}return null},groupFactory:function(){var A=new ART.Group();this.setStyle(A,null,{hasStyle:true});return A},nodeFactory:function(A){if(A==null){return new ART.Shape()}else{switch(A.toLowerCase()){case"wedge":return new ART.Wedge();break;default:return new ART.Shape();break}}},clear:function(){var D=this.root.children;var A=D.length;if(A>0){for(var C=0,B=A;C<B;C++){if(D[C].data){D[C].data=null}if(D[C].resetResolution){D[C].resetResolution=null}if(D[C]._geotype){D[C]._geotype=null}if(D[C]._style){D[C]._style=null}if(D[C]._options){D[C]._options=null}this.eject(D[C])}}},eject:function(C){var E;var B=C.children;if(B&&B.length>0){E=B[0];if(B[0].data){B[0].data=null}if(B[0].resetResolution){B[0].resetResolution=null}if(B[0]._geotype){B[0]._geotype=null}if(B[0]._style){B[0]._style=null}if(B[0]._options){B[0]._options=null}this.eject(E)}if(C){if(C.data){C.data=null}if(C.resetResolution){C.resetResolution=null}if(C._geotype){C._geotype=null}if(C._style){C._style=null}if(C._options){C._options=null}if(C.eject){C.eject()}else{var A=C.toElement?C.toElement():C.element?C.element:C;var D=A.parentNode;if(D){D.removeChild(A)}}C=null}},destroy:function(){this.eject(this.root)},addEvents:function(B,A){if(A!=null){for(var C in A){B.listen(C,A[C].bind(B))}}},drawLineString:function(D,H,J,B){var G=[];var A=this.options.extent.xmin;var C=this.options.extent.ymax;var I=this.options.resolution;for(var F=0,E=H.length;F<E;F++){G.push(this.toMap(H[F]))}D.data=G;if(!D.resetResolution){D.resetResolution=function(R,U){var N=this.data;var P=[];var K=U.xmin;var L=U.ymax;for(var O=0,M=N.length;O<M;O++){P.push([Math.round((N[O][0]-K)/R),Math.round((L-N[O][1])/R)])}var V=new ART.Path();var Q=P.length;if(Q>0){var T=P[0][0];var S=P[0][1];if(!isNaN(T)&&!isNaN(S)){V.moveTo(T,S)}}for(var O=1,M=P.length;O<M;O++){var T=P[O][0];var S=P[O][1];if(!isNaN(T)&&!isNaN(S)){V.lineTo(T,S)}}if(this._geotype=="linearring"||this._geotype=="polygon"){V.close()}this.draw(V)}.bind(D)}if(J){D._geotype="linearring"}else{D._geotype="linestring"}D.resetResolution(this.options.resolution,this.options.extent);this.setStyle(D,B,{hasStroke:true});return D},drawCircle:function(F,E,D,B){var H=this.options.extent.xmin;var A=this.options.extent.ymax;var C=this.options.resolution;var G={x:E.x*C+H,y:A-E.y*C,r:E.r*C};F.data=G;if(!F.resetResolution){F.resetResolution=function(N,Q){var L=this.data;var J=Q.xmin;var K=Q.ymax;var M={x:Math.round((L.x-J)/N),y:Math.round((K-L.y)/N),r:Math.round(L.r/N)};var P=M.x;var O=M.y;var I=M.r;if(!isNaN(P)&&!isNaN(O)&&!isNaN(I)){var R=new ART.Path();R.moveTo(P-I,O).arc(2*I,0,I,I).arc(-2*I,0,I,I);this.draw(R)}}.bind(F)}F.resetResolution(this.options.resolution,this.options.extent);F._geotype="circle";this.setStyle(F,D,{hasStroke:true,hasFill:B});return F},drawPolygon:function(C,B,A){this.drawLineString(C,B,true);this.setStyle(C,A,{hasStroke:true,hasFill:true});C._geotype="polygon";return C},drawRectangle:function(D,H,B){var F=[];var A=this.options.extent.xmin;var C=this.options.extent.ymax;var I=this.options.resolution;for(var G=0,E=H.length;G<E;G++){F.push(this.toMap(H[G]))}D.data=F;if(!D.resetResolution){D.resetResolution=function(R,U){var M=this.data;var O=[];var J=U.xmin;var K=U.ymax;for(var N=0,L=M.length;N<L;N++){O.push([Math.round((M[N][0]-J)/R),Math.round((K-M[N][1])/R)])}var T=O[0][0];var S=O[0][1];var Q=O[1][0];var P=O[1][1];if(!isNaN(T)&&!isNaN(S)&&!isNaN(Q)&&!isNaN(P)){var V=new ART.Path();V.moveTo(T,S).lineTo(T,P).lineTo(Q,P).lineTo(Q,S).close();this.draw(V)}}.bind(D)}D._geotype="rectangle";D.resetResolution(this.options.resolution,this.options.extent);this.setStyle(D,B,{hasStroke:true,hasFill:true});return D},setStyle:function(E,D,B){var A=null;D=D||E._style;B=B||E._options;if(D){A=new Hash(D);A.combine(this.defaultStyle);A=A.getClean()}else{A=this.defaultStyle}E._style=A;if(B){if(B.hasStyle){var C=E.toElement?E.toElement():E.element?E.element:E;var G=A.styles;for(var F in G){C.style[F]=G[F]}}if(B.hasFill){if($type(A.fillColor)=="array"){if($type(A.fillColor)=="array"){if(A.fillColor.length>1&&$type(A.fillColor[0])=="array"){E.fill.run(A.fillColor,E)}else{E.fill(A.fillColor,A.fillColor)}}}else{E.fill(A.fillColor)}}if(B.hasStroke){E.stroke(A.stroke.color,A.stroke.width,A.stroke.cap,A.stroke.join)}}E._options=B;return E},defaultStyle:{styles:{left:"0px",top:"0px",position:"absolute"},stroke:{color:"#47bfe1",width:1,cap:"round",join:"miter"},fillColor:[32,202,172,0.4],opacity:0.7}})})})();
(function(){MapGIS.extend({EditGeometry:new Class({Implements:[Events,Options],options:{offsetLeft:0,offsetTop:0,extent:{xmin:0,ymin:0,xmax:0,ymax:0},resolution:1},container:null,root:null,canEdit:false,currentNode:null,geometry:null,fromNode:null,eventNode:null,editNodeList:[],keydownfn:null,initialize:function(a,b,c){this.setOptions(b);this.container=a;this.root=a;this.eventNode=c||document;this.geometry=new MapGIS.Geometry(null,{extent:this.options.extent,resolution:this.options.resolution});this.keydownfn=this.keydownEvent.bind(this);this.eventNode.addEvent("keydown",this.keydownfn)},keydownEvent:function(a){a=a||window.event;a=new Event(a);if(this.canEdit){if(a.key=="delete"){if(this.fromNode!=null){if(this.fromNode.eject){this.fromNode.eject();this.fromNode=null;this.fireEvent("change",{event:a});this.clear()}}}}},editNode:function(a){if(a!=null){this.fromNode=a;this.initDragNode()}},setResolution:function(a,b){this.options.resolution=a;this.options.extent=b;this.geometry.setResolution(a,b)},resetResolution:function(c,d){this.setResolution(c,d);for(var b=0,a=this.editNodeList.length;b<a;b++){if(this.editNodeList[b]!=null){this.editNodeList[b].resetResolution(c,d)}}},getPointList:function(){var a=[];if(this.fromNode){a=this.fromNode.data}return a},initDragNode:function(){var a=this.getPointList();this.clear();if(a!=null){if(this.fromNode._geotype=="circle"){var b=this.creatDragNode([a.x,a.y],0);this.editNodeList.push(b);var l=this.creatDragNode([a.x+a.r,a.y],1);this.editNodeList.push(l)}else{if(this.fromNode._geotype=="rectangle"){var b=this.creatDragNode(a[0],0);this.editNodeList.push(b);var l=this.creatDragNode(a[1],1);this.editNodeList.push(l)}else{for(var d=0,c=a.length;d<c;d++){var b=this.creatDragNode(a[d],d);this.editNodeList.push(b);var f=d+1;if(f<c){var g=(a[f][0]+a[d][0])/2;var e=(a[f][1]+a[d][1])/2;var j=this.creatDragNode([g,e],-f);this.editNodeList.push(j)}else{if(f==c&&f>0){if(this.fromNode._geotype!="linestring"){var g=(a[0][0]+a[d][0])/2;var e=(a[0][1]+a[d][1])/2;var h=this.creatDragNode([g,e],-f);this.editNodeList.push(h)}}}}}}}},creatDragNode:function(e,b){var a=e[0];var f=e[1];var d=6;var e=this.geometry.toScreen([a,f]);if(!isNaN(a)&&!isNaN(f)){var c=this.geometry.nodeFactory("circle");this.geometry.drawCircle(c,{x:e[0],y:e[1],r:d},{stroke:{color:"#fefefe",width:1}},true);c.fill("#1a85e8","#3c70a0");c._index=b;c.listen("mousedown",this._mouseDown.bindWithEvent(this,c));c.listen("dblclick",this._dblclick.bindWithEvent(this,c));c.inject(this.root);return c}return null},MoveDragNode:function(f,e){var c=this.geometry.toMap(f);if(e._index>=0){if(this.fromNode._geotype=="circle"){if(e._index==0){this.fromNode.data.x=c[0];this.fromNode.data.y=c[1];var b=this.editNodeList[1].data.x+c[0]-e.data.x;var g=this.editNodeList[1].data.y+c[1]-e.data.y;this.editNodeList[1].data.x=b;this.editNodeList[1].data.y=g;this.editNodeList[1].resetResolution(this.options.resolution,this.options.extent)}else{this.fromNode.data.r=Math.sqrt(Math.pow((c[0]-this.fromNode.data.x),2)+Math.pow((c[1]-this.fromNode.data.y),2))}}else{this.fromNode.data[e._index]=c;if(this.fromNode._geotype!="rectangle"){var d=e._index;var a=this.getPointList().length;if(d>0&&d<a-1){this.editNodeList[2*d+1].data.x=(c[0]+this.getPointList()[d+1][0])/2;this.editNodeList[2*d+1].data.y=(c[1]+this.getPointList()[d+1][1])/2;this.editNodeList[2*d+1].resetResolution(this.options.resolution,this.options.extent);this.editNodeList[2*d-1].data.x=(c[0]+this.getPointList()[d-1][0])/2;this.editNodeList[2*d-1].data.y=(c[1]+this.getPointList()[d-1][1])/2;this.editNodeList[2*d-1].resetResolution(this.options.resolution,this.options.extent)}else{if(d==0){this.editNodeList[1].data.x=(c[0]+this.getPointList()[1][0])/2;this.editNodeList[1].data.y=(c[1]+this.getPointList()[1][1])/2;this.editNodeList[1].resetResolution(this.options.resolution,this.options.extent);if(this.fromNode._geotype!="linestring"){this.editNodeList[2*a-1].data.x=(c[0]+this.getPointList()[a-1][0])/2;this.editNodeList[2*a-1].data.y=(c[1]+this.getPointList()[a-1][1])/2;this.editNodeList[2*a-1].resetResolution(this.options.resolution,this.options.extent)}}else{if(d==(a-1)){if(this.fromNode._geotype!="linestring"){this.editNodeList[2*d+1].data.x=(c[0]+this.getPointList()[0][0])/2;this.editNodeList[2*d+1].data.y=(c[1]+this.getPointList()[0][1])/2;this.editNodeList[2*d+1].resetResolution(this.options.resolution,this.options.extent)}this.editNodeList[2*d-1].data.x=(c[0]+this.getPointList()[d-1][0])/2;this.editNodeList[2*d-1].data.y=(c[1]+this.getPointList()[d-1][1])/2;this.editNodeList[2*d-1].resetResolution(this.options.resolution,this.options.extent)}}}}}}this.fromNode.resetResolution(this.options.resolution,this.options.extent);e.data.x=c[0];e.data.y=c[1];e.resetResolution(this.options.resolution,this.options.extent);return e},clear:function(){for(var b=0,a=this.editNodeList.length;b<a;b++){if(this.editNodeList[b]!=null){this.editNodeList[b].ignore("mousedown",null);this.editNodeList[b].ignore("dblclick",null);this.editNodeList[b].onmouseup=null;this.editNodeList[b].onmouseup=null;this.editNodeList[b].onmousemove=null;this.editNodeList[b].eject();this.editNodeList[b]=null}}this.editNodeList=null;this.editNodeList=[]},draw:function(a){if(this.currentNode!=null){this.MoveDragNode(a,this.currentNode)}},_mousePoint:function(d){var b=this.options.offsetLeft;var c=this.options.offsetTop;var a=0,e=0;if(d.client){a=d.client.x-b;e=d.client.y-c}else{a=d.clientX-b;e=d.clientY-c}return[a,e]},_mouseMove:function(a){a=a||window.event;if(!this.canEdit){return false}this.draw(this._mousePoint(a));return false},_mouseDown:function(c,b){this.currentNode=b;if(!this.canEdit){return false}if(b._index<0){var a=b._index;this.fromNode.data.splice(-a,0,[b.data.x,b.data.y]);this.editNode(this.fromNode);this.currentNode=this.editNodeList[-a*2]}this.eventNode.onmouseup=this.eventNode.onmousemove=null;this.eventNode.onmousemove=this._mouseMove.bind(this);this.eventNode.onmouseup=this._mouseUp.bind(this);return false},_mouseUp:function(a){a=a||window.event;this.currentNode=null;this.eventNode.onmouseup=this.eventNode.onmousemove=null;return false},_dblclick:function(a){a=a||window.event;this.clear();this.fireEvent("change",{event:a});this.eventNode.onmousedown=this.eventNode.onmouseup=this.eventNode.onmousemove=this.eventNode.ondblclick=null},start:function(){this.canEdit=true},stop:function(){this.canEdit=false;this.clear()},destroy:function(){this.eventNode.removeEvent("keydown",this.keydownfn);this.clear();this.eventNode=null;this.editNodeList=null}})})})();
(function(){MapGIS.extend({MapContentMenu:new Class({Implements:[Events,Options],options:{left:0,top:0,width:300,height:80,zIndex:10,showline:true,contentMenuList:[],baseMenuList:[{title:"放大",fn:function(){this.map.setActiveTool("+")}.bind(this)},{title:"缩小",fn:function(){this.map.setActiveTool("-")}.bind(this)},{title:"拖曳",fn:function(){this.map.setActiveTool("$")}.bind(this)},{title:"还原",fn:function(){this.map.reposition()}.bind(this)}]},div:null,map:null,objList:null,latLng:null,initialize:function(B,A){this.setOptions(A);this.map=B;this.div=new Element("div",{styles:{width:"150px",height:"98px",display:"none",left:0,top:0,position:"absolute",margin:"0px",padding:"0px",zIndex:9999,visibility:"visible"}});this.div.addEvent("mousedown",function(C){C.stopPropagation()});this.div.addEvent("mouseup",function(C){C.stopPropagation()});this.div.addEvent("click",this.hide.bindWithEvent(this));this.draw()},setData:function(A,B){this.options.contentMenuList=A;if(B){this.options.baseMenuList=null;this.options.baseMenuList=[]}this.draw()},draw:function(){this.clear();if((this.options.contentMenuList==null||this.options.contentMenuList.length==0)&&(this.options.baseMenuList==null||this.options.baseMenuList.length==0)){return}var H={listStyle:"none",margin:"0px",marginTop:"4px",marginLeft:"0px",border:"1px solid  #999999",background:"white",padding:"0px",fontSize:"13px"};var B={listStyle:"none",marginTop:"4px",marginLeft:"0px",padding:"0px",textAlign:"center"};var J={listStyle:"none",marginTop:"1px",marginLeft:"0px",padding:"0px",textAlign:"center"};var A={listStyle:"none",marginTop:"0px",marginLeft:"0px",padding:"0px",textAlign:"center",borderCollapse:"collapse",lineHeight:"1px",height:"1px"};var N={listStyle:"none",margin:"2px",lineHeight:"20px",padding:"0px",cursor:"pointer"};var G=new Element("ul",{styles:H});var K=new Element("li");G.appendChild(K);var D=new Element("ul",{styles:B});K.appendChild(D);if(this.objList==null){this.objList=[]}var M=this.options.baseMenuList;for(var F=0,E=M.length;F<E;F++){var I=new Element("li",{styles:N,events:{mouseover:function(){this.style.backgroundColor="#e8ecf9"},mouseout:function(){this.style.backgroundColor="white"}}});I.set("html",M[F].title);if(M[F].fn!=null){I.addEvent("click",M[F].fn.pass({latlng:this.latLng}))}D.appendChild(I);this.objList[this.objList.length]=I}var L=this.options.contentMenuList;if(L.length>0){if(this.options.showline){var C=new Element("li",{styles:A});C.set("html","<hr/>");D.appendChild(C)}for(var F=0,E=L.length;F<E;F++){var I=new Element("li",{styles:N,events:{mouseover:function(){this.style.backgroundColor="#e8ecf9"},mouseout:function(){this.style.backgroundColor="white"}}});I.set("html",L[F].title);if(L[F].fn!=null){I.addEvent("click",L[F].fn.pass({latlng:this.latLng}))}D.appendChild(I);this.objList[this.objList.length]=I}}this.div.appendChild(G)},toggle:function(A){this.draw();this.div.setStyles({left:A.x,top:A.y});this.show()},show:function(){this.div.setStyle("display","block")},hide:function(){this.div.setStyle("display","none")},clear:function(){if(this.objList!=null){for(var B=0,A=this.objList.length;B<A;B++){this.objList[B].removeEvents("click");this.objList[B].removeEvents("mouseover");this.objList[B].removeEvents("mouseout");this.objList[B].destroy();this.objList[B]=null}this.objList=null}this.div.empty()},dispose:function(){this.clear();this.div.removeEvents("click");this.div.removeEvents("mouseup");this.div.removeEvents("mousedown")}})})})();
(function(){MapGIS.extend({MapNavigation:new Class({Implements:[Events,Options],options:{isInitStep:false,slideObj:null,scrollbar:null,left:0,top:0,width:300,height:80,levelFormMap:false,source:MapGIS.path.source,zIndex:10},map:null,div:null,initialize:function(C,B){this.setOptions(B);this.map=C;var A=new Element("div",{styles:{zIndex:this.options.zIndex,backgourndColor:"red"}});A.setStyles({position:"absolute",left:this.options.left,top:this.options.top,width:this.options.width,height:this.options.height});this.div=A;A.addEvent("mousedown",function(D){D.stopPropagation()});this.map.addEvent("zoom",this.mapZoom.bind(this));window.mapnavigationinterval=window.setInterval(function(){if(this.div.getParent()==null){return}else{window.clearInterval(window.mapnavigationinterval);this.init()}}.bind(this),1000)},show:function(){this.div.setStyle("display","block")},hide:function(){this.div.setStyle("display","none")},init:function(){var F=this.map.options.levelMin;var W=this.map.options.levelMax-F;var A=this.map.getLevel()-F;var D=this.map.width/8;var S=(W)*10;var P=this.options.source;this.div.setStyle("width","60px");if(!Browser.Engine.trident){this.div.setStyle("-webkit-user-select","none")}var O=new Element("div",{unselectable:"on",styles:{width:"60px",height:(S+120)+"px",position:"absolute",left:"20px",top:"40px"}});var U=new Element("img",{name:"PngImgs",src:P+"images/tool/mapcontrols.png",styles:{left:"0px",top:"0px",position:"absolute",width:"59px",height:"492px"}});var I=new Element("div",{styles:{width:"60px",height:"60px",position:"absolute",left:"0px",top:"0px",overflow:"hidden"}});var M=new Element("div",{title:"向上平移",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"20px",top:"0px"}});var K=new Element("div",{title:"向左平移",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"0px",top:"20px"}});var G=new Element("div",{title:"还原初始状态",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"20px",top:"20px"}});var L=new Element("div",{title:"向右平移",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"40px",top:"20px"}});var T=new Element("div",{title:"向下平移",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"20px",top:"40px"}});if(Browser.Engine.trident){M.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1});K.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1});G.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1});L.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1});T.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1})}var B=new Element("div",{styles:{width:"20px",height:(S+44)+"px",position:"absolute",left:"20px",top:"60px",overflow:"hidden"}});var X=new Element("div",{title:"放大["+W+"]",styles:{width:"20px",height:"22px",position:"absolute",left:"0px",top:"0px",overflow:"hidden"}});var V=new Element("div",{title:"缩小",styles:{width:"20px",height:"22px",position:"absolute",left:"0px",top:(S+21)+"px",overflow:"hidden"}});var C=new Element("div",{styles:{width:"20px",height:(S)+"px",position:"absolute",left:"0px",top:"22px",overflow:"hidden"}});var N=new Element("div",{title:"拖动缩放",styles:{width:"20px",height:"10px",overflow:"hidden"}});this.options.scrollbar=N;var J=U.clone();J.setStyles({left:"-19px",top:"-65px"});X.appendChild(J);var E=U.clone();E.setStyles({left:"-19px",top:"-360px"});V.appendChild(E);var H=U.clone();H.setStyles({left:"-19px",top:"-87px"});C.appendChild(H);var Q=U.clone();Q.setStyles({left:"0px",top:"-384px"});N.appendChild(Q);B.appendChild(X);B.appendChild(V);B.appendChild(C);I.appendChild(U);I.appendChild(M);I.appendChild(K);I.appendChild(L);I.appendChild(T);I.appendChild(G);C.appendChild(N);O.appendChild(I);O.appendChild(B);this.div.appendChild(O);MapGIS.correctPNG();O.addEvent("contextmenu",function(){return false});X.addEvent("click",this.setNavSeries.bindWithEvent(this,true));V.addEvent("click",this.setNavSeries.bindWithEvent(this,false));M.addEvent("click",this.setNavDirection.bindWithEvent(this,[0,D]));K.addEvent("click",this.setNavDirection.bindWithEvent(this,[D,0]));L.addEvent("click",this.setNavDirection.bindWithEvent(this,[-D,0]));T.addEvent("click",this.setNavDirection.bindWithEvent(this,[0,-D]));G.addEvent("click",this.setNavDirection.bindWithEvent(this,[0,0]));this.options.slideObj=new Slider(C,N,{steps:W,snap:true,offset:0,mode:"vertical",initialStep:(W-A),onComplete:this.navigationChange.bindWithEvent(this)})},noFristLoad:false,navigationChange:function(C){var B=this.map.options.levelMax;var A=B-C;if(this.noFristLoad){this.map.setLevel(A,!this.options.levelFormMap)}this.noFristLoad=true;this.options.levelFormMap=false;this.options.scrollbar.set("title","拖动缩放["+A+"]")},setNavDirection:function(C,B,A){if(B==0&&A==0){this.map.reposition()}else{if(B>0){this.map.panMove(256,0)}else{if(B<0){this.map.panMove(-256,0)}else{if(A>0){this.map.panMove(0,256)}else{if(A<0){this.map.panMove(0,-256)}}}}}},setNavSeries:function(C,B){if(this.options.slideObj==null){return}if(B){this.map.upLevel();var A=this.map.getLevel();if(A>this.map.options.levelMax){return}else{this.options.isInitStep=true;var D=(this.map.options.levelMax-A);this.options.slideObj.set(D)}}else{this.map.downLevel();var A=this.map.getLevel();if(A<0){return}else{this.options.isInitStep=true;var D=(this.map.options.levelMax-A);this.options.slideObj.set(D)}}},mapZoom:function(A){if(this.options.slideObj!=null){this.options.scrollbar.set("title","拖动缩放["+A.level+"]");this.options.levelFormMap=true;this.options.slideObj.set(this.map.options.levelMax-A.level)}}})})})();
(function(){MapGIS.extend({Model:new Class({Implements:[Events,Options],options:{xmin:0,ymin:0,xmax:0,ymax:0,level:0,preLevel:0,maxLevel:0,minLevel:0,size:[0,0],clientPos:[0,0],wheelPos:[0,0],mousePos:[0,0],speed:[0,0],canOver:true,origin:{x:0,y:0},fullExtent:[0,0,0,0],tileSize:256,ismoving:true},resolution:$empty,originPoint:null,restoration:{level:0,preLevel:0,clientPos:[0,0],wheelPos:[0,0],opoint:null},initialize:function(A){this.setOptions(A)},getMousePos:function(){return this.options.mousePos},setMousePos:function(A){this.options.mousePos=A},getMousePoint:function(){var B=this.getMousePos();var A=this.toMap(B[0],B[1]);return A},setRestore:function(){var D=this.getLevel();var C=this.getPreLevel();var E=this.getPos();var B=this.getWheelPos();var A=this.getOriginPoint();this.restoration={level:D,preLevel:C,clientPos:E,wheelPos:B,opoint:A}},restore:function(){this.setOptions(this.restoration);this.originPoint=this.restoration.opoint;this.lastpos=this.getPos()},getMapOptions:function(){return this},setZoom:function(A){var B=this.getLevel();if(A){if(B<this.options.maxLevel){this.options.preLevel=this.options.level;this.options.level++;this.lastTile=null;return true}}else{if(B>this.options.minLevel){this.options.preLevel=this.options.level;this.options.level--;this.lastTile=null;return true}}return false},setWheelPos:function(J,I){this.options.wheelPos=[J,I];if(this.getLevel()!=this.getPreLevel()){var G=this.getPreLevel();var F=this.resolution(G);var E=this.getPos();var L=this.originPoint;var B=(E[0]-J);var H=(E[1]-I);var M=L[0]-B*F.x;var K=L[1]+H*F.y;var A=this.resolution(this.getLevel());var D=M+B*A.x;var C=K-H*A.y;this.originPoint=[D,C]}},getWheelPos:function(){return this.options.wheelPos},getPreLevel:function(){return this.options.preLevel},getLevel:function(){return this.options.level},setLevel:function(B){if(B==this.getLevel()){return}this.options.preLevel=this.options.level;var A=this.getViewSize();if(B>this.options.maxLevel){this.options.level=this.options.maxLevel}else{if(B<this.options.minLevel){this.options.level=this.options.minLevel}else{this.options.level=B}}if(B!=this.options.preLevel){this.setWheelPos(A[0]/2,A[1]/2)}this.lastTile=null},getSpeed:function(){return this.options.speed},getViewSize:function(){return this.options.size},setViewSize:function(A){this.options.size=A},setMapOptions:function(A){if(this.options.canOver){if(A.options){this.setOptions(A.options)}if(A.resolution){this.resolution=A.resolution}if(A.toMap){this.toMap=A.toMap}if(A.toScreen){this.toScreen=A.toScreen}}},setPos:function(A){this.options.clientPos=A},getPos:function(){return this.options.clientPos},setSpeed:function(A){this.options.speed=A},getRes:function(){return this.resolution(this.getLevel())},getOrigin:function(){return this.options.origin},getExtent:function(){var C=this.getOriginPoint();var H=this.getPos();var F=this.getRes();var E=this.getViewSize();var G=C[0]-H[0]*F.x;var A=C[1]+H[1]*F.y;var B=G+E[0]*F.x;var D=A-E[1]*F.y;return{xmin:G,ymin:D,xmax:B,ymax:A}},getOriginPoint:function(){if(this.originPoint==null){var B=this.options.fullExtent;var D=[(B[0]+B[2])/2,(B[1]+B[3])/2];var E=this.getLevel();var A=this.getRes();var C=this.getViewSize();var F=[(D[0]-A.x*(C[0]/2)),(D[1]+A.y*(C[1]/2))];this.originPoint=F;return F}else{return this.originPoint}},getLeftTopPoint:function(){var B=this.getOriginPoint();var E=this.getPos();var C=this.getRes();var D=B[0]-E[0]*C.x;var A=B[1]+E[1]*C.y;return[D,A]},getCenterPoint:function(){var G=this.getLeftTopPoint();var C=this.getRes();var B=this.getViewSize();var A=B[0];var F=B[1];var E=G[0]+A*C.x;var D=G[1]-F*C.y;return[E,D]},getCenterPos:function(){var A=this.getViewSize();return[A[0]/2,A[1]/2]},toMap:function(A,F){var E=this.getLeftTopPoint();var B=this.getRes();var D=E[0]+A*B.x;var C=E[1]-F*B.y;return[D,C]},toScreen:function(A,F){var E=this.getLeftTopPoint();var B=this.getRes();var D=Math.floor((A-E[0])/B.x);var C=Math.floor((E[1]-F)/B.y);return[D,C]},toLayerScreen:function(A,F){var E=this.getOriginPoint();var B=this.getRes();var D=Math.floor((A-E[0])/B.x);var C=Math.floor((E[1]-F)/B.y);return[D,C]},lastpos:[0,0],moveNo:1,setRunStatus:function(A){this.options.ismoving=A},isMoving:function(){var A=this.options.ismoving;if(A){var B=this.getPos();if(B[0]==this.lastpos[0]&&B[1]==this.lastpos[1]){if(this.moveNo>0){return(this.options.ismoving||false)}else{this.moveNo++}}else{this.moveNo=0;this.lastpos=[B[0],B[1]]}}return A},movDistance:function(){var E=this.getPos();var B=this.lastpos;var A=E[0]-B[0];var D=E[1]-B[1];var C=Math.pow(A,2)+Math.pow(D,2);return Math.sqrt(C)},posTag:function(){var A=this.lastpos;var B=this.getLevel();return(B+"a"+A[0]+"a"+A[1])},getTileSize:function(){return this.options.tileSize},lastTile:null,lastTiles:[],layers:{noNewTilelayer:[],newtiles:[],deltiles:[],alltiles:[]},currentTileNo:function(){var A=this.getTileNo(this.getRes(),this.getLeftTopPoint());return A},getTiles:function(){var b=this.getTileNo(this.getRes(),this.getLeftTopPoint());if(this.lastTile==null||Math.abs(this.lastTile.row-b.row)>0||Math.abs(this.lastTile.cell-b.cell)>0){try{var N=b.left;var V=b.top;var Y=b.row;var R=b.cell;var G=this.getPos();var P=this.getViewSize();var D=this.getTileSize();var J=Math.ceil(P[1]/D)+1;var E=Math.ceil(P[0]/D)+1;var I=this.getLevel();var W=this.lastTiles;var F=W.length;var C=[];var a=[];for(var O=0;O<J;O++){var M=V+D*O-G[1];var H=Y+O;for(var Z=0;Z<E;Z++){var S=N+D*Z-G[0];var B=R+Z;var Q=I+"-"+H+"-"+B;var L=false;for(var U=0;U<F;U++){var K=W[U];if(K.id==Q){W[U].v=1;L=true;break}}if(!L){a.push({z:I,r:H,c:B,l:S,t:M,id:Q,v:0})}C.push({z:I,r:H,c:B,l:S,t:M,id:Q,v:0})}}this.lastTile=b;this.layers.newtiles=a;var A=[];for(var U=0,T=W.length;U<T;U++){if(W[U].v==0){A.push(W[U])}}this.layers.deltiles=A;this.layers.hasNewTile=true;this.layers.noNewTilelayer.empty();this.layers.alltiles=C;this.lastTiles=C}catch(X){}}return this.layers},hasNewTile:function(D){var A=this.layers.noNewTilelayer;for(var C=0,B=A.length;C<B;C++){if(A[C]==D){return false}}this.layers.noNewTilelayer.push(D);return true},getTileNo:function(B,D){var H=this.options.tileSize;var G=this.options.origin;var F=D[0];var E=D[1];var J=Math.floor((F-G.x)/B.x/H);var I=Math.floor((G.y-E)/B.y/H);var A=-(F-G.x)/B.x+H*J;var C=-(G.y-E)/B.y+H*I;return{cell:J,row:I,left:A,top:C}}})})})();
(function(){MapGIS.extend({OMapModel:new Class({Extends:MapGIS.Model,Implements:[Events,Options],options:{maxLevel:5,minLevel:0,origin:{x:0,y:0},fullExtent:[1082959,-1117551,1082961,-1117553],tileSize:256},resolution:function(c){var a=(Math.pow(2,(6-c)-1));var b=(Math.pow(2,(6-c)-1));return{x:a,y:b}}})})})();
(function(){MapGIS.extend({Map:new Class({Implements:[Events,Options],extent:null,loader:false,options:{level:0,levelMax:9,levelMin:0,size:[0,0],zIndex:1,xmin:null,ymin:null,xmax:null,ymax:null,activeTool:"$",contentMenu:{visible:true,obj:null},navigation:{show:true,obj:null},queryHandler:null,center:null},container:null,root:null,toolsdiv:null,layersdiv:null,defaultPos:[0,0],bgPos:[0,0],speed:[0,0],isBacking:false,isDragging:false,mousePosLast:[0,0],mousePosNow:[0,0],mouseSpeed:[0,0],smooth:[[0,0],[0,0],[0,0],[0,0]],handles:{timeout:null,interval:null},checkLoadTimer:null,layers:[],baseLayer:null,model:null,width:0,height:0,fxtype:0,setModel:function(a){this.model=a;var c=this.options.level;if(this.options.xmin!=null){var b=[this.options.xmin,this.options.ymin,this.options.xmax,this.options.ymax];this.model.setOptions({fullExtent:b})}this.model.setOptions({canOver:false,size:this.options.size,level:c,preLevel:c,minLevel:this.options.levelMin,maxLevel:this.options.levelMax});this.model.setRestore()},setReposition:function(){this.model.setRestore()},initialize:function(a,e,b){this.container=((typeof(a)==="object")?a:$(a));this.setOptions(e);this.initMap();if(this.options.center!=null){var f=this.options.center;this.options.xmin=f[0]-1;this.options.xmax=f[0]+1;this.options.ymin=f[1]-1;this.options.ymax=f[1]+1}this.setModel(b==null?new MapGIS.Model():b);if(window.map_opinterval!=null){window.clearInterval(window.map_opinterval);window.map_opinterval=null}this.loader=true;window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10);this.checkLoadTimer=this.checkLoadMap.periodical(1000,this)},checkLoadMap:function(){if(this.loader){this.fireEvent("load",true);if(this.checkLoadTimer){$clear(this.checkLoadTimer)}}},addLayer:function(a){this.layers.push(a);a.loadLayer(this.model);this.layersdiv.appendChild(a.div);if(!a.div.hasClass("layerContainer")){a.div.addClass("layerContainer")}},addLayers:function(c){if(c!=null&&c.length>0){for(var b=0,a=c.length;b<a;b++){this.addLayer(c[b])}}},addTools:function(a){this.toolsdiv.appendChild(a)},dragingLayer:function(){var c=this.layers;if(c!=null){for(var b=0,a=c.length;b<a;b++){c[b].dragingLayer(this.model)}}},layerEventByMouseOver:function(c){var e=this.layers;var f=this.getPos(c);this.model.setMousePos(f);if(e!=null){for(var b=0,a=e.length;b<a;b++){e[b].eventByMouseOver(c,this.model)}}},layerEventByClick:function(c){var e=this.layers;var f=this.getPos(c);this.model.setMousePos(f);if(e!=null){for(var b=0,a=e.length;b<a;b++){e[b].eventByClick(c,this.model)}}},layerEventByDblclick:function(c){var e=this.layers;var f=this.getPos(c);this.model.setMousePos(f);if(e!=null){for(var b=0,a=e.length;b<a;b++){e[b].eventByDblclick(c,this.model)}}},FireExtentchangeEvent:function(){var b=this.model.getLevel();var a=this.model.getExtent();var e=this.model.getCenterPoint();this.fireEvent("extentchange",{level:b,point:e,extent:a})},moveno:2,lastpos:[0,0],setPos:function(){var b=this.bgPos[0];var a=this.bgPos[1];var c=this.speed;if(c[0]==0&&c[1]==0){if(this.moveno>0||this.isDragging){return}else{this.moveno++;this.model.setPos([b.toInt(),a.toInt()]);this.model.setSpeed([c[0],c[1]]);this.layersdiv.setStyles({left:b,top:a});this.model.setRunStatus(false);this.dragingLayer();this.FireExtentchangeEvent()}}else{this.moveno=0;this.model.setPos([b.toInt(),a.toInt()]);this.model.setSpeed([c[0],c[1]]);this.layersdiv.setStyles({left:b,top:a});this.model.setRunStatus(true);this.dragingLayer();this.lastpos=[b,a]}},getPos:function(c){var b=this.container.getScroll();var f=this.root.getPosition();var a=c.page.x-f.x;var e=c.page.y-f.y;return[a,e]},dragAndDragFn:function(){if(this.isBacking){var e=this.bgPos;var j=this.defaultPos;if(Math.abs(e[0]-j[0])<5&&Math.abs(e[1]-j[1])<5){this.isBacking=false;this.speed[0]=0;this.speed[1]=0;this.FXFn(j);return}var l=this.speed;l[0]=(j[0]-e[0])*0.0485;l[1]=(j[1]-e[1])*0.0485;this.bgPos[0]+=l[0];this.bgPos[1]+=l[1];this.setPos();return}if(this.isDragging){var a=this.mousePosNow;var h=this.mousePosLast;var b=[a[0]-h[0],a[1]-h[1]];this.smooth.push(b);this.smooth.shift();var c=[0,0];var l=this.smooth;var f=l.length;for(var g=0;g<f;g++){c[0]+=l[g][0];c[1]+=l[g][1]}c[0]=c[0]/f;c[1]=c[1]/f;this.speed[0]=c[0]*1;this.speed[1]=c[1]*1;this.bgPos[0]+=this.speed[0];this.bgPos[1]+=this.speed[1];this.setPos();this.mousePosLast[0]=a[0];this.mousePosLast[1]=a[1];return}var l=this.speed;if(Math.abs(l[0])<0.004){this.speed[0]=0}if(Math.abs(l[1])<0.004){this.speed[1]=0}this.speed[0]=l[0]*0.97;this.speed[1]=l[1]*0.97;this.bgPos[0]+=this.speed[0];this.bgPos[1]+=this.speed[1];this.setPos()},initMap:function(){var j=this.options;this.container.setStyles({position:"absolute",zIndex:j.zIndex});var b=j.size[0];var f=j.size[1];if(b==0||f==0){var c=this.container.getSize();var g=Element.getComputedStyle(this.container,"border-left-width").toInt()||0;var a=Element.getComputedStyle(this.container,"border-right-width").toInt()||0;var i=Element.getComputedStyle(this.container,"border-top-width").toInt()||0;var e=Element.getComputedStyle(this.container,"border-bottom-width").toInt()||0;b=c.x-g-a;f=c.y-i-e;this.options.size=[b,f]}this.width=b;this.height=f;this.root=new Element("div",{unselectable:"on",styles:{width:b,height:f,left:0,top:0,position:"absolute",margin:"0px",padding:"0px",zIndex:3,visibility:"visible",overflow:"hidden",border:"0px solid blue"}});this.root.inject(this.container);this.toolsdiv=new Element("div",{unselectable:"on",styles:{left:0,top:0,position:"absolute",margin:"0px",padding:"0px",zIndex:2,visibility:"visible",border:"0px"}});this.toolsdiv.inject(this.root);this.container.addEvent("contextmenu",function(){return false});this.layersdiv=new Element("div",{unselectable:"on",styles:{left:0,top:0,position:"absolute",margin:"0px",padding:"0px",zIndex:1,visibility:"visible",border:"0px"}});this.layersdiv.inject(this.root);this.root.addEvent("mousedown",this.mouseDownEvent.bindWithEvent(this));this.root.addEvent("mousemove",this.mouseMoveEvent.bindWithEvent(this));this.root.addEvent("mouseup",this.mouseUpEvent.bindWithEvent(this));this.root.addEvent("mouseleave",this.mouseLeaveEvent.bindWithEvent(this));this.root.addEvent("mousewheel",this.mapEventWheel.bindWithEvent(this));this.root.addEvent("dblclick",this.mouseEventDblclick.bindWithEvent(this));this.root.addEvent("click",this.mouseEventClick.bindWithEvent(this));this.root.addEvent("touchend",this.touchendEvent.bindWithEvent(this));this.root.addEvent("touchmove",this.touchmoveEvent.bindWithEvent(this));this.root.addEvent("touchstart",this.touchstartEvent.bindWithEvent(this));this.root.addEvent("gesturechange",this.ongesturechangeEvent.bindWithEvent(this));this.root.addEvent("gestureend",this.ongestureendEvent.bindWithEvent(this));if(this.options.contentMenu.obj==null){this.options.contentMenu.obj=new MapGIS.MapContentMenu(this);this.options.contentMenu.obj.div.inject(this.toolsdiv)}if(this.options.navigation.obj==null){this.options.navigation.obj=new MapGIS.MapNavigation(this);this.options.navigation.obj.div.inject(this.toolsdiv);this.options.navigation.show?this.options.navigation.obj.show():this.options.navigation.obj.hide()}},resize:function(){var c=this.container.getSize();var g=Element.getComputedStyle(this.container,"border-left-width").toInt()||0;var a=Element.getComputedStyle(this.container,"border-right-width").toInt()||0;var i=Element.getComputedStyle(this.container,"border-top-width").toInt()||0;var f=Element.getComputedStyle(this.container,"border-bottom-width").toInt()||0;var b=c.x-g-a;var e=c.y-i-f;this.options.size=[b,e];this.model.setViewSize([b,e]);this.width=b;this.height=e;this.root.setStyles({width:b,height:e})},zoomEffect:function(j,c){window.clearInterval(window.zoomflashtimeout);var k=this.model.getViewSize();this.geometryObj.init(this.toolsdiv,k);var b=this;var i=j[0];var h=j[1];var a=(c==1?15:26);var f=5,e=7;function g(w,s,l,o,n,m){var v={x:w-l,y:s-l};var t={x:w+l,y:s-l};var q={x:w-l,y:s+l};var p={x:w+l,y:s+l};var B=[],A=[],z=[],u=[];if(m){B=[[v.x,(v.y+o)],[v.x,v.y],[(v.x+n),v.y]];A=[[(t.x-n),t.y],[t.x,t.y],[t.x,(t.y+o)]];z=[[q.x,(q.y-o)],[q.x,q.y],[(q.x+n),q.y]];u=[[(p.x-n),p.y],[p.x,p.y],[p.x,(p.y-o)]]}else{B=[[(v.x-o),v.y],[v.x,v.y],[v.x,(v.y-n)]];A=[[(t.x+o),t.y],[t.x,t.y],[t.x,(t.y-n)]];z=[[q.x,(q.y+n)],[q.x,q.y],[(q.x-o),q.y]];u=[[(p.x+o),p.y],[p.x,p.y],[p.x,(p.y+n)]]}b.geometryObj.obj.drawLineString(b.geometryObj.node0,B,false,{stroke:{color:"#ff0000",width:2}});b.geometryObj.obj.drawLineString(b.geometryObj.node1,A,false,{stroke:{color:"#ff0000",width:2}});b.geometryObj.obj.drawLineString(b.geometryObj.node2,z,false,{stroke:{color:"#ff0000",width:2}});b.geometryObj.obj.drawLineString(b.geometryObj.node3,u,false,{stroke:{color:"#ff0000",width:2}})}window.zoomflashtimeout=window.setInterval(function(){if(a<31&&c==1){g(i,h,a,f,e,c);a+=15}else{if(a>0&&c==0){g(i,h,a,f,e,c);a-=15}else{window.clearInterval(window.zoomflashtimeout);b.geometryObj.clear()}}},220)},geometryObj:{obj:null,node:null,node0:null,node1:null,node2:null,node3:null,node4:null,node5:null,clear:function(){this.node0.draw("M0,0");this.node1.draw("M0,0");this.node2.draw("M0,0");this.node3.draw("M0,0");this.node4.draw("M0,0");this.node5.draw("M0,0");this.node.draw("M0,0");this.obj.root.resize(1,1)},init:function(b,a){if(this.obj==null){this.obj=new MapGIS.Geometry(b,{width:a[0],height:a[1]})}this.obj.root.resize(a[0],a[1]);if(this.node==null){this.node=this.obj.nodeFactory("shape");this.node.inject(this.obj.root)}if(this.node0==null){this.node0=this.obj.nodeFactory("shape");this.node0.inject(this.obj.root)}if(this.node1==null){this.node1=this.obj.nodeFactory("shape");this.node1.inject(this.obj.root)}if(this.node2==null){this.node2=this.obj.nodeFactory("shape");this.node2.inject(this.obj.root)}if(this.node3==null){this.node3=this.obj.nodeFactory("shape");this.node3.inject(this.obj.root)}if(this.node4==null){this.node4=this.obj.nodeFactory("shape");this.node4.inject(this.obj.root)}if(this.node5==null){this.node5=this.obj.nodeFactory("shape");this.node5.inject(this.obj.root)}}},referenceLine:function(g){var b=g.options.size;var a=b[0];var e=b[1];var c=new Element("div",{unselectable:"on",styles:{position:"absolute",left:0,top:e/2,zIndex:999,borderTop:"1px solid blue",width:a,height:1}});var f=new Element("div",{unselectable:"on",styles:{position:"absolute",left:a/2,top:0,zIndex:999,borderLeft:"1px solid blue",width:1,height:e}});c.inject(this.root);f.inject(this.root)},zoomLayer:function(){if(window.map_opinterval!=null){window.clearInterval(window.map_opinterval);window.map_opinterval=null}var h=this.layers;if(h!=null){for(var e=0,c=h.length;e<c;e++){h[e].zoomLayer(this.model)}}var g=this.model.getWheelPos();var b={x:g[0],y:g[1]};var f=this.getExtent();var a={event:window.event,level:this.getLevel(),point:b,extent:f};this.fireEvent("zoom",a);this.fireEvent("mousewheel",a);this.fireEvent("zoomend",a);this.FireExtentchangeEvent()},wheelTimer_:null,mapEventWheel:function(h){if(this.loader!==true){return false}if(this.wheelTimer_===null){this.wheelTimer_=window.setTimeout(function(){window.clearTimeout(this.wheelTimer_);$clear(this.wheelTimer_);this.wheelTimer_=null}.bind(this),450)}else{return false}h=h||window.event;var g=h.wheel||0;var e=h.wheelDelta||0;var k=h.detail||0;d=g?g:(!e?(!k?0:-k):e);var j=(d>0?true:false);var f=this.model.setZoom(j);if(f){var i=this.getPos(h);this.zoomEffect(i,j);this.model.setWheelPos(i[0],i[1]);this.zoomLayer()}},mouseEvent:{eventtype:0,startpoint:[0,0],endpoint:[0,0],getPointList:function(){return[this.startpoint,this.endpoint]},getdx:function(){return this.endpoint[0]-this.startpoint[0]},getdy:function(){return this.endpoint[1]-this.startpoint[1]},getCenter:function(){return[(this.endpoint[0]+this.startpoint[0])/2,(this.endpoint[1]+this.startpoint[1])/2]}},mouseDownEvent:function(b){b=b||window.event;b.stop();var c=this.getPos(b);this.mouseEvent.startpoint=c;if(this.loader){switch(this.mouseEvent.eventtype){case 0:if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}this.isDragging=true;this.mousePosLast[0]=this.mousePosNow[0];this.mousePosLast[1]=this.mousePosNow[1];this.speed=[0,0];var f=[0,0];this.smooth=[f,f,f,f];this.mouseEvent.eventtype=1;break;case 2:var e=this.model;var a=e.getViewSize();this.geometryObj.init(this.toolsdiv,a);this.mouseEvent.eventtype=3;this.mouseEvent.endpoint=c;this.geometryObj.obj.drawRectangle(this.geometryObj.node,this.mouseEvent.getPointList());break;case 4:var e=this.model;var a=e.getViewSize();this.geometryObj.init(this.toolsdiv,a);this.mouseEvent.eventtype=5;this.mouseEvent.endpoint=c;this.geometryObj.obj.drawRectangle(this.geometryObj.node,this.mouseEvent.getPointList());break;default:break}if(this.options.contentMenu.obj!=null&&this.options.contentMenu.visible){this.options.contentMenu.obj.hide()}}this.fireEvent("mousedown",{event:b});b.stopPropagation()},mouseMoveEvent:function(a){a=a||window.event;a.stop();this.mousePosNow[0]=a.client.x;this.mousePosNow[1]=a.client.y;var b=this.getPos(a);var c=this.mouseEvent.endpoint;if(Math.abs(b[0]-c[0])<1&&Math.abs(b[1]-c[1])<1){return}this.mouseEvent.endpoint=b;if(this.loader){switch(this.mouseEvent.eventtype){case 1:this.root.setStyle("cursor","move");break;case 3:case 5:this.geometryObj.obj.drawRectangle(this.geometryObj.node,this.mouseEvent.getPointList());break;default:break}}this.layerEventByMouseOver(a);this.fireEvent("mousemove",{event:a});a.stopPropagation()},mouseUpEvent:function(b){b=b||window.event;b.stop();if(this.loader){switch(this.mouseEvent.eventtype){case 1:this.root.setStyle("cursor","");this.isDragging=false;this.mouseEvent.eventtype=0;break;case 3:if(this.mouseEvent.getdx()>5||this.mouseEvent.getdy()>5){var g=this.model.setZoom((this.options.activeTool=="+")?true:false);if(g){var c=this.mouseEvent.getCenter();this.model.setWheelPos(c[0],c[1]);this.zoomLayer()}}this.geometryObj.clear();this.mouseEvent.eventtype=2;break;case 5:if(this.mouseEvent.getdx()>5||this.mouseEvent.getdy()>5){var j=this.mouseEvent.startpoint;var f=this.mouseEvent.endpoint;var o=this.model.toMap(j[0],j[1]);var m=this.model.toMap(f[0],f[1]);var a=Math.min(o[0],m[0]);var i=Math.max(o[0],m[0]);var l=Math.min(o[1],m[1]);var e=Math.max(o[1],m[1]);var h={event:b,min:[a,l],max:[i,e]};this.mouseEvent.eventtype=4;if(this.options.queryHandler!=null){this.options.queryHandler(h)}this.fireEvent("areaselect",h)}else{this.mouseEvent.eventtype=4}this.geometryObj.clear();break;default:this.root.setStyle("cursor","");this.isDragging=false;break}if(this.mouseEvent.getdx()<5&&this.mouseEvent.getdy()<5){if(((b.event.which)&&(b.event.which==3))||((b.event.button)&&(b.event.button==2))){if(this.options.contentMenu.obj!=null&&this.options.contentMenu.visible){var c=this.getPos(b);var k={x:c[0],y:c[1]};var n=this.model.toMap(c[0],c[1]);this.options.contentMenu.obj.latLng={x:n[0],y:n[1]};this.options.contentMenu.obj.toggle(k)}}this.fireEvent("mouseup",{event:b})}}this.fireEvent("mouseup",{event:b});b.stopPropagation()},mouseLeaveEvent:function(b){b=b||window.event;b.stop();if(this.loader){switch(this.mouseEvent.eventtype){case 1:this.root.setStyle("cursor","");this.isDragging=false;this.mouseEvent.eventtype=0;break;case 3:var a=this.model.setZoom((this.options.activeTool=="+")?true:false);if(a){var c=this.mouseEvent.getCenter();this.model.setWheelPos(c[0],c[1]);this.zoomLayer()}this.geometryObj.clear();this.mouseEvent.eventtype=2;break;default:this.root.setStyle("cursor","");this.isDragging=false;break}}},touchmoveEvent:function(b){var f=b.touches[0];b.preventDefault();var a=f.pageX;var c=f.pageY;this.mousePosNow[0]=a;this.mousePosNow[1]=c},touchPos:[],touchstartEvent:function(f){f.preventDefault();if(this.loader){if(f.touches.length<2){if(this.mouseEvent.eventtype==0){if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}this.isDragging=true;var j=f.touches[0];var a=j.pageX;var h=j.pageY;this.mousePosNow[0]=a;this.mousePosNow[1]=h;this.mousePosLast[0]=this.mousePosNow[0];this.mousePosLast[1]=this.mousePosNow[1];this.speed=[0,0];var g=[0,0];this.smooth=[g,g,g,g];this.mouseEvent.eventtype=1}}else{if(f.touches.length>1){if(this.mouseEvent.eventtype==1){this.isDragging=false;this.mouseEvent.eventtype=0}this.touchPos=[];for(var c=0,b=f.touches.length;c<b;c++){this.touchPos.push([f.touches[c].pageX,f.touches[c].pageY])}}}}},touchendEvent:function(a){a.preventDefault();if(this.loader){if(this.mouseEvent.eventtype==1){this.isDragging=false;this.mouseEvent.eventtype=0}}},ongestureendEvent:function(a){a.preventDefault();if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}},ongesturechangeEvent:function(f){f.preventDefault();if(this.loader!=true){return false}if(this.wheelTimer_==null){this.wheelTimer_=window.setTimeout(function(){window.clearTimeout(this.wheelTimer_);$clear(this.wheelTimer_);this.wheelTimer_=null}.bind(this),450)}else{return false}var h=(f.scale>1?true:false);if(this.touchPos.length>1){var a=this.model.setZoom(h);if(a){var g=this.touchPos;var b=(g[0][0]+g[1][0])/2;var c=(g[0][1]+g[1][1])/2;this.model.setWheelPos(b,c);this.zoomLayer()}}},mouseEventDblclick:function(b){b=b||window.event;if(window.TIMERCLICK_){clearTimeout(window.TIMERCLICK_)}if(this.mouseEvent.getdx()==0||this.mouseEvent.getdy()==0){var c=this.getPos(b);var a=this.model.toMap(c[0],c[1]);this.fireEvent("dblclick",[b,{x:a[0],y:a[1]}]);this.layerEventByDblclick(b)}b.stopPropagation()},mouseEventClick:function(b){b=b||window.event;if(this.mouseEvent.getdx()==0||this.mouseEvent.getdy()==0){var c=this.getPos(b);var a=this.model.toMap(c[0],c[1]);if(window.TIMERCLICK_){clearTimeout(window.TIMERCLICK_)}window.TIMERCLICK_=setTimeout(this.FireMapClickEvent.bind({classObj:this,arg:[b,{x:a[0],y:a[1]}]}),220)}b.stopPropagation()},FireMapClickEvent:function(){this.classObj.fireEvent("click",this.arg);this.classObj.layerEventByClick(this.arg[0])},stopEvent:function(){this.root.removeEvents("mousewheel");this.root.removeEvents("mousedown");this.root.removeEvents("mousemove");this.root.removeEvents("mouseup");this.root.removeEvents("mouseleave");this.root.removeEvents("dblclick");this.root.removeEvents("click")},startEvent:function(){this.stopEvent();this.root.addEvent("mousedown",this.mouseDownEvent.bindWithEvent(this));this.root.addEvent("mousemove",this.mouseMoveEvent.bindWithEvent(this));this.root.addEvent("mouseup",this.mouseUpEvent.bindWithEvent(this));this.root.addEvent("mouseleave",this.mouseLeaveEvent.bindWithEvent(this));this.root.addEvent("mousewheel",this.mapEventWheel.bindWithEvent(this));this.root.addEvent("dblclick",this.mouseEventDblclick.bindWithEvent(this));this.root.addEvent("click",this.mouseEventClick.bindWithEvent(this))},refresh:function(){var c=this.layers;if(c!=null){for(var b=0,a=c.length;b<a;b++){c[b].refresh(this.model)}}},getCurrentExtent:function(){var e=this.model;var c=e.toMap(0,0);var a=e.getViewSize();var b=e.toMap(a[0],a[1]);return{xmin:c[0],ymin:b[1],xmax:b[0],ymax:c[1]}},setActiveTool:function(a){this.options.activeTool=a;if(this.options.activeTool=="$"){this.mouseEvent.eventtype=0}else{if(this.options.activeTool=="+"||this.options.activeTool=="-"){this.mouseEvent.eventtype=2}else{if(this.options.activeTool=="*"){this.mouseEvent.eventtype=4}}}},reposition:function(){this.model.restore();this.layersdiv.setStyles({left:0,top:0});this.mousePosLast=[0,0];this.mousePosNow=[0,0];this.bgPos=[0,0];this.zoomLayer()},getLevel:function(){return this.model.getLevel()},getExtent:function(){return this.model.getExtent()},getResolution:function(){return this.model.getRes()},setLevel:function(g,c){this.model.setLevel(g);if(c){this.zoomLayer()}else{var f=this.model.getWheelPos();var b={x:f[0],y:f[1]};var e=this.getExtent();var a={event:window.event,level:this.getLevel(),point:b,extent:e};this.fireEvent("zoom",a);this.fireEvent("mousewheel",a);this.fireEvent("zoomend",a)}},upLevel:function(){var a=this.model.setZoom(true);if(a){var b=this.model.getCenterPos();this.model.setWheelPos(b[0],b[1]);this.zoomLayer()}},downLevel:function(){var a=this.model.setZoom(false);if(a){var b=this.model.getCenterPos();this.model.setWheelPos(b[0],b[1]);this.zoomLayer()}},setCenter:function(q,a){var m=0,l=0;if(q==null){return}else{var k=$type(q);if(k=="object"){m=q.x.toFloat();l=q.y.toFloat()}else{m=q[0].toFloat();l=q[1].toFloat()}if(isNaN(m)||isNaN(l)){return}}if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}if(a!=null){this.setLevel(a)}var n=this.model.getViewSize();var o=this.model.toScreen(m,l);var i=o[0]-n[0]/2;var g=o[1]-n[1]/2;var e=this.model.getPos();var z=e[0]-i;var c=e[1]-g;this.defaultPos=[z,c];var b=this.bgPos;var j=this.width;var u=this.height;var s=this.bgPos[0];var r=this.bgPos[1];if(Math.abs(b[0]-z)>j){var v=(b[0]-z)>0?1:-1;s=z+v*j}if(Math.abs(b[1]-c)>u){var v=(b[1]-c)>0?1:-1;r=c+v*u}this.bgPos=[s,r];this.isBacking=true;this.fxtype=1;this.locatePos=[m,l]},getCenter:function(){var a=this.model.getCenterPoint();return{x:a[0],y:a[1]}},panMove:function(a,c){if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}var b=this.model.getPos();this.defaultPos=[b[0]+a,b[1]+c];this.isBacking=true},locatePos:[0,0],FXFn:function(b){if(this.fxtype==1){var f=this.model;var a=f.getViewSize();var e=this.locatePos;var c=f.toScreen(e[0],e[1]);this.zoomEffect2(c,0)}this.fxtype=0},zoomEffect2:function(j,c){window.clearInterval(window.zoomflashtimeout);var k=this.model.getViewSize();this.geometryObj.init(this.toolsdiv,k);var b=this;var i=j[0];var h=j[1];var a=(c==1?15:56);var f=5,e=7;function g(z,t,l,p,o,n){var w={x:z-l,y:t-l};var u={x:z+l,y:t-l};var s={x:z-l,y:t+l};var q={x:z+l,y:t+l};var D=[],B=[],A=[],v=[];if(!n){D=[[w.x,(w.y+p)],[w.x,w.y],[(w.x+o),w.y]];B=[[(u.x-o),u.y],[u.x,u.y],[u.x,(u.y+p)]];A=[[s.x,(s.y-p)],[s.x,s.y],[(s.x+o),s.y]];v=[[(q.x-o),q.y],[q.x,q.y],[q.x,(q.y-p)]]}else{D=[[(w.x-p),w.y],[w.x,w.y],[w.x,(w.y-o)]];B=[[(u.x+p),u.y],[u.x,u.y],[u.x,(u.y-o)]];A=[[s.x,(s.y+o)],[s.x,s.y],[(s.x-p),s.y]];v=[[(q.x+p),q.y],[q.x,q.y],[q.x,(q.y+o)]]}var m=2*l;var E=[[z,t-m],[z,t+m]];var C=[[z-m,t],[z+m,t]];b.geometryObj.obj.drawLineString(b.geometryObj.node4,E,false,{stroke:{color:"#511E03",width:2}});b.geometryObj.obj.drawLineString(b.geometryObj.node5,C,false,{stroke:{color:"#511E03",width:2}});b.geometryObj.obj.drawLineString(b.geometryObj.node0,D,false,{stroke:{color:"#62211E",width:2}});b.geometryObj.obj.drawLineString(b.geometryObj.node1,B,false,{stroke:{color:"#62211E",width:2}});b.geometryObj.obj.drawLineString(b.geometryObj.node2,A,false,{stroke:{color:"#62211E",width:2}});b.geometryObj.obj.drawLineString(b.geometryObj.node3,v,false,{stroke:{color:"#62211E",width:2}})}window.zoomflashtimeout=window.setInterval(function(){if(a<31&&c==1){g(i,h,a,f,e,c);a+=15}else{if(a>0&&c==0){g(i,h,a,f,e,c);a-=15}else{window.clearInterval(window.zoomflashtimeout);b.geometryObj.clear()}}},220)}})})})();
(function(){MapGIS.extend({Layers:new Hash({BaseLayer:new Class({Implements:[Events,Options],div:null,isIe6:false,source:MapGIS.path.source,divLatLng:[0,0],id:null,options:{id:MapGIS.createUniqueID("layer"),allowRefresh:false,zIndex:1,startShowLevel:0},mapoptions:null,visible:true,isvisible:true,initialize:function(A){this.isIe6=Browser.Engine.trident4;this.setOptions(A);this.id=this.options.id;this.initDiv();this.initLayer()},initDiv:function(){this.div=new Element("div",{unselectable:"on",styles:{position:"absolute",left:0,top:0,zIndex:this.options.zIndex}});this.div.setStyle("-webkit-user-select","none")},dragingLayer:function(D,A){this.mapoptions=D;var C=D.getLevel();var B=this.options.startShowLevel;if(C<B){return false}return this.visible},zoomLayer:function(C){this.mapoptions=C;var B=C.getLevel();var A=this.options.startShowLevel;if(B<A){return false}return this.visible},reloadLayer:function(A){},initLayer:function(){},loadLayer:function(C){this.mapoptions=C;var B=C.getLevel();var A=this.options.startShowLevel;if(B<A){return false}this.dragingLayer(C,true);return this.visible},eventByMouseOver:function(A,B){},eventByClick:function(A,B){},eventByDblclick:function(A){},clear:function(){this.div.empty()},destory:function(){this.clear()},refresh:function(){if(!this.options.allowRefresh){return false}return true},show:function(){this.visible=true;this.div.setStyle("display","block");this.reloadLayer(this.mapoptions)},hide:function(){this.visible=false;this.div.setStyle("display","none")},isContinue:function(){if(this.mapoptions==null){return false}var B=this.mapoptions.getLevel();var A=this.options.startShowLevel;if(B<A){return false}return(this.visible&&this.isvisible)},setVisibility:function(A){this.isvisible=A}})})})})();
(function(){MapGIS.Layers.extend({TileLayer:new Class({Extends:MapGIS.Layers.BaseLayer,Implements:[Events,Options],options:{initialExtent:null,startShowLevel:0,level:0,tileSize:256,url:null},initLayer:function(){this.zoomObj.div=this.div},posLast:[0,0,0,0,0,0],Point0:{cell:0,row:0,left:0,top:0},isFullDraw:true,dragingLayer:function(A){if(this.parent(A)){this.drawTile(A)}else{this.div.empty()}},reloadLayer:function(A){this.reloadTile()},getTileNo:function(B,D){var H=this.options.tileSize;var G=this.mapoptions.options.origin;var F=D[0];var E=D[1];var J=Math.floor((F-G.x)/B.x/H);var I=Math.floor((G.y-E)/B.y/H);var A=-(F-G.x)/B.x+H*J;var C=-(G.y-E)/B.y+H*I;return{cell:J,row:I,left:A,top:C}},getTagName:function(B){var A=this.options.id+"_";return A+"z_"+B},drawTile:function(H){if(!H.isMoving()){return}var F=H.getTiles();if(!H.hasNewTile(this.id)){return}var N=this.options.id+"_";var K=H.getLevel();var L=this.options.url;var B=this.getTagName(K);var M=H.getTileSize();var J=F.newtiles;for(var E=0,C=J.length;E<C;E++){var I=J[E];var A=N+I.id;this.loadImage(L,K,I.c,I.r,I.l,I.t,M,B,A,false)}var G=F.deltiles;this.zoomObj.clear();for(var E=0,C=G.length;E<C;E++){var I=G[E];var D=this.div.getElementById(N+I.id);if(D){D.destroy()}}},redrawTile:function(H){var F=H.getTiles();var N=this.options.id+"_";var K=H.getLevel();var L=this.options.url;var B=this.getTagName(K);var M=H.getTileSize();var J=F.alltiles;for(var E=0,C=J.length;E<C;E++){var I=J[E];var A=N+I.id;this.loadImage(L,K,I.c,I.r,I.l,I.t,M,B,A,false)}var G=F.deltiles;this.zoomObj.clear();for(var E=0,C=G.length;E<C;E++){var I=G[E];var D=this.div.getElementById(N+I.id);if(D){D.destroy()}}},zoomLayer:function(E){if(this.parent(E)){this.zoomImgsToLayer(E);var A=E.getPreLevel();var D=E.getLevel();var C=this.getTagName(A);this.zoomObj.clclass=this.getTagName(D);if(this.loadZoomImgsHandle!=null){window.clearTimeout(this.loadZoomImgsHandle)}if(this.clearImgsHandle!=null){window.clearInterval(this.clearImgsHandle)}this.loadZoomImgsHandle=window.setTimeout(function(){this.reloadTile();this.clearImgsHandle=window.setInterval(this.loadedImgsEvent.bind(this),10,this.getTagName(D))}.bind(this),200);if(C!=this.zoomObj.imgclass){var B=this.div.getElements("img."+C);if(B.length>0){B.each(function(F){F.destroy()})}}}else{this.div.empty()}},clearImgsHandle:null,loadZoomImgsHandle:null,loadImage:function(H,G,J,L,C,I,K,M,B,F){var E={z:G,y:J,x:L};var A=H.substitute(E);var D=this.div.getElementById(B);if(D){D.src=A}else{D=new Element("img",{src:A,id:B,"class":M,loaded:"false",styles:{position:"absolute",left:C,top:I,width:K,height:K,border:"0px",margin:"0px",padding:"0px","z-index":2}});D.inject(this.div);D.onload=function(){this.set("loaded","true")}}},loadedImgsEvent:function(D){var E=this.div.getElements("img."+D);var C=true;if(E.length>0){for(var B=0,A=E.length;B<A;B++){if(E[B].get("loaded")!="true"){C=false;break}}}if(C){this.zoomObj.clear();window.clearInterval(this.clearImgsHandle)}return C},zoomObj:{imgclass:null,clclass:null,res:null,imgSize:null,div:null,clear:function(){if(this.clclass!=this.imgclass){var A=this.div.getElements("img."+this.imgclass);if(A.length>0){A.each(function(B){B.destroy()})}this.imgclass=null;this.res=null;this.imgSize=null}}},effects:[],zoomImgsToLayer:function(H){if(this.effects!=null&&this.effects.length>0){var G=this.effects;for(var F=0,E=G.length;F<E;F++){G[F].cancel()}this.effects=[]}var I=H.getPreLevel();if(this.zoomObj.imgclass==null){var D=this.getTagName(I);this.zoomObj.imgclass=D}if(this.zoomObj.res==null){this.zoomObj.res=H.resolution(I)}if(this.zoomObj.imgSize==null){this.zoomObj.imgSize=H.getTileSize()}var K=this.div.getElements("img."+this.zoomObj.imgclass);var J=H.getPos();var L=H.getWheelPos();var O=[-J[0]+L[0],-J[1]+L[1]];var C=H.getRes();var B=this.zoomObj.res;var M=this.zoomObj.imgSize;var A=B.x/C.x;var N=M*B.x/C.x;if(K!=null&&K.length>0){K.each(function(R){var V=R.getStyle("left").toInt();var U=R.getStyle("top").toInt();var Q=R.getStyle("width").toInt();var T=R.getStyle("height").toInt();var P=(O[0]-(O[0]-V)*A);var S=(O[1]-(O[1]-U)*A);R.setStyles({left:P,top:S,width:N,height:N,"z-index":1})}.bind(this))}else{}this.zoomObj.imgSize=N;this.zoomObj.res=C},reloadTile:function(){var E=this.mapoptions;var K=this.options.id+"_";var G=E.getLevel();var I=E.getTiles().alltiles;var B=this.getTagName(G);var J=E.getTileSize();var H=this.options.url;var G=E.getLevel();for(var D=0,C=I.length;D<C;D++){var F=I[D];var A=K+F.id;this.loadImage(H,G,F.c,F.r,F.l,F.t,J,B,A,true)}},refresh:function(){var D=this.parent();if(D){var B=this.options.url;var A=new Date().getTime();var C=B.match(/\?[^\?]*/);if(C!=null){if(C!="?"){if(B.match(/(DT=T)\d{13}(T)/g)!=null){B=B.replace(/(DT=T)\d{13}(T)/g,"DT=T"+A+"T")}else{B=B+"&DT=T"+A+"T"}}else{B=B+"DT=T"+A+"T"}}else{B=B+"?DT=T"+A+"T"}this.options.url=B;this.reloadTile()}}})})})();
(function(){MapGIS.Layers.extend({MarkerLayer:new Class({Extends:MapGIS.Layers.BaseLayer,Implements:[Events,Options],options:{isLigature:false,rebuildPoint:true,combosWindow:true,paletteObj:null,mapLayer:null,tabWindow:null,imgDeflectX:10,imgDeflectY:34,imgWidth:20,imgHeight:34,imgClass:"marker",strokecolor:"#0c68c5",strokeweight:2,imgSrc:"",visibleWindow:false,defaultMarker:null,pointClickFn:null,simpleDisplay:false,effects:false,selectedPointID:null,graphicsData:[]},geometry:null,lineRoot:null,graphicsRoot:null,geomDIV:null,pointList:[],showLines:false,pointObjLayer:null,selectedItem:{index:-1,marker:null},loadZoomImgsHandle:null,loadLayer:function(b){var a=b.getViewSize();this.options.width=a[0];this.options.height=a[1];this.div.setStyle("-webkit-user-select","auto");this.div.unselectable="";this.pointObjLayer=new Element("div",{unselectable:"off",styles:{position:"absolute",left:0,top:0,zIndex:2}});this.div.appendChild(this.pointObjLayer);this.geomDIV=new Element("div",{styles:{display:"none",pointerEvents:"none",position:"absolute",left:0,top:0,zIndex:1}});this.geomDIV.inject(this.div);this.geometry=new MapGIS.Geometry(this.geomDIV,{width:this.options.width,height:this.options.height});this.lineRoot=this.geometry.creatGroup();this.graphicsRoot=this.geometry.creatGroup();this.loader=true;this.parent(b)},hexUnescape:function(a){if(typeof a!="undefined"&&(a!=null)){a=a.replace(/\\/g,"%");return unescape(a)}else{return""}},dragingLayer:function(d){if(this.parent(d)){if(this.options.simpleDisplay){this.geomDIV.setStyle("display","none")}var b=d.isMoving();if(!b){this.drawGeom();this.drawLine();var c=this.mapoptions.getPos();var a={left:-c[0],top:-c[1]};this.geomDIV.setStyles(a)}}},reloadLayer:function(c){this.drawGeom();this.drawLine();var b=this.mapoptions.getPos();var a={left:-b[0],top:-b[1]};this.geomDIV.setStyles(a)},zoomLayer:function(c){if(this.parent(c)){this.transformPointCoord();this.drawGeom();this.drawLine();var b=this.mapoptions.getPos();var a={left:-b[0],top:-b[1]};this.geomDIV.setStyles(a)}},eventFn_click:function(h,f,o){h.stopPropagation();if(this.options.visibleWindow){var c=this.getCardWindowID(o);if($(c)){$(c).fade("in");$(c).setStyle("z-index",++this.cardIndex);this.setCardData(o,f)}else{var g=this.cardWindow(o,f);if(g!=null){g.inject(this.pointObjLayer)}}}var c=this.id+"_p_"+(o);var i={srcElement:$(c),row:o,data:f,layer:this};this.fireEvent("click",i);this.fireEvent("pointclick",i);if(this.options.effects&&this.options.selectedPointID!=null){if(this.options.selectedPointID!=c){var m=$(this.options.selectedPointID);var j=m.getStyle("background-position");var b=m.getStyle("width");var d=j.split(" ");var a=d[0];var n=d[1];var k=a.toInt();var l=b.toInt();m.setStyle("background-position",(k+l)+"px "+n);m.removeClass("focusMapPoint")}}this.options.selectedPointID=c},eventFn_mouseOver:function(d,c,f){d.stopPropagation();var g=this.id+"_p_"+(f);var a=$(g);var b={srcElement:a,row:f,data:c,layer:this};this.fireEvent("pointmouseover",b);this.fireEvent("mouseover",b);a.addClass("focusMapPoint");this.effectsStart(f)},eventFn_mouseOut:function(d,c,f){d.stopPropagation();var g=this.id+"_p_"+(f);var a=$(g);var b={srcElement:a,row:f,data:c,layer:this};this.fireEvent("pointmouseout",b);this.fireEvent("mouseout",b);a.removeClass("focusMapPoint");this.effectsEnd(f)},effectsStart:function(i){if(this.options.effects){var b=this.id+"_p_"+(i);var h=$(b);if(this.options.selectedPointID!=b){var e=h.getStyle("background-position");var c=h.getStyle("width");var d=e.split(" ");var a=d[0];var j=d[1];var f=a.toInt();var g=c.toInt();h.setStyle("background-position",(f-g)+"px "+j)}}},effectsEnd:function(i){if(this.options.effects){var b=this.id+"_p_"+(i);var h=$(b);if(this.options.selectedPointID!=b){var e=h.getStyle("background-position");var c=h.getStyle("width");var d=e.split(" ");var a=d[0];var j=d[1];var f=a.toInt();var g=c.toInt();h.setStyle("background-position",(f+g)+"px "+j)}else{h.addClass("focusMapPoint")}}},getElementByID:function(a){return this.pointObjLayer.getElementById(this.id+"_p_"+a)},toScreen:function(c){var b=this.mapoptions.toLayerScreen(c[0],c[1]);var a={x:(b[0]),y:(b[1])};return a},setData:function(a){this.selectedItem.index=-1;this.options.selectedPointID=null;this.pointList=a;this.drawPoint();this.drawLine()},setGraphicsData:function(a){this.options.graphicsData=a;if(this.loader&&this.isContinue()){this.drawGeom()}},getLatLngValue:function(d){if(d!=null){var a=d.x||d.X||d.xpos;var e=d.y||d.Y||d.ypos;var b=typeof(a)=="string"?a.toFloat():a;var c=typeof(e)=="string"?e.toFloat():e;return[b,c]}else{return null}},setDefaultMarker:function(a){this.options.defaultMarker=a},setMarkerImage:function(b){this.options.imgSrc=this.options.source+"images/transparent.gif";this.options.imgDeflectY=34;this.options.imgDeflectX=10;this.options.imgWidth=20;this.options.imgHeight=34;this.options.imgClass="marker";if(b!=null){for(var a in b){this.options[a]=b[a]}}},selectedPoint:function(r,l){this.selectedItem.index=r;if(l){this.selectedItem.marker=l}var n=this.pointList;if(n!=null&&n.length>0){var g=this.id+"_p_";this.cardIndex++;var a=this.cardIndex;var o=(this.selectedItem.marker!=null?true:false);var d=null;if(o){this.setMarkerImage(this.selectedItem.marker);d=this.options.imgClass}for(var j=0,h=n.length;j<h;j++){var c=g+j;if($(c)){var e=$(c);var l=n[j].marker;if(o){e.removeClass(d)}if(l){this.setMarkerImage(l)}else{this.setMarkerImage(this.options.defaultMarker)}e.removeClass(this.options.imgClass);if(this.selectedItem.index==j){this.setMarkerImage(this.selectedItem.marker);e.setStyle("zIndex",a)}var q=this.getLatLngValue(n[j]);var b=null;if(q!=null){b=this.toScreen(q)}else{break}var f=parseInt(b.x)-this.options.imgDeflectX;var m=parseInt(b.y)-this.options.imgDeflectY;e.setStyles({left:f,top:m});if(!e.hasClass(this.options.imgClass)){e.addClass(this.options.imgClass)}}}}},drawPoint:function(){var r=this.pointList;this.pointObjLayer.empty();if(r!=null){var d=this.id;for(var g=0,e=r.length;g<e;g++){var s=this.getLatLngValue(r[g]);var b=null;if(s!=null){b=this.toScreen(s)}else{continue}var n=this.hexUnescape(r[g].content);var h=r[g].marker;if(h){this.setMarkerImage(h)}else{this.setMarkerImage(this.options.defaultMarker)}if(this.selectedItem.index==g){this.setMarkerImage(this.selectedItem.marker)}var c=parseInt(b.x)-this.options.imgDeflectX;var q=parseInt(b.y)-this.options.imgDeflectY;var j=this.hexUnescape(r[g].html);var l=this.hexUnescape(r[g].title);var o=r[g].show;var a=d+"_p_"+g;var f=new Element("div",{id:a,unselectable:"on","class":"pointImages",styles:{left:c,top:q,position:"absolute",cursor:"pointer",display:"block",fontSize:"12px"},events:{click:this.eventFn_click.bindWithEvent(this,[r[g],g]),mouseover:this.eventFn_mouseOver.bindWithEvent(this,[r[g],g]),mouseout:this.eventFn_mouseOut.bindWithEvent(this,[r[g],g])}});f.addClass(this.options.imgClass);f.addClass(d+"_pointimg");if(j!=null){f.set("html",j)}if(l!=null){f.set("title",l)}f.inject(this.pointObjLayer);if(this.options.visibleWindow){if(o){var m=this.cardWindow(g,r[g]);if(m!=null){m.inject(this.pointObjLayer)}}}}}},drawLine:function(){this.clearLines();if(this.showLines){var f=this.pointList;if(f!=null){var g=this.id;var c=[];for(var b=0,a=f.length;b<a;b++){var e=this.getLatLngValue(f[b]);var d=null;if(e!=null){d=this.mapoptions.toScreen(e[0],e[1]);c.push(d)}else{continue}}this.lineFN(c)}}},dpos:[0,0],ds:[0,0],isRun:false,runIndex:1,mytimeout:null,lineFN:function(a){if(this.mytimeout!=null){window.clearInterval(this.mytimeout)}this.isRun=true;this.runIndex=1;if(a!=null&&a.length>0){this.dpos=a[0]}this.mytimeout=window.setInterval(this.gotoLine.bind(this,[a]),120)},gotoLine:function(c){if(!this.isRun){window.clearInterval(this.mytimeout)}else{if(c!=null&&c.length>this.runIndex){var l=[];for(var d=0,b=this.runIndex;d<b;d++){l.push(c[d])}var h=c[this.runIndex];var g=this.runIndex-1;var e=c[g];this.ds=[(h[0]-e[0])/4,(h[1]-e[1])/4];this.dpos=[this.dpos[0]+this.ds[0],this.dpos[1]+this.ds[1]];var s=Math.abs(this.dpos[0]-e[0]);var r=Math.abs(this.dpos[1]-e[1]);var p=Math.abs(h[0]-e[0]);var o=Math.abs(h[1]-e[1]);var m=[e];if(s>=p||r>=o){this.runIndex++;l.push(h)}else{m.push(this.dpos)}this.clearLines();var j={stroke:{color:"#4A2C48",width:3}};this.geomDIV.setStyle("display","block");if(l.length>1){var a=this.geometry.nodeFactory("shape");this.geometry.drawLineString(a,l,false,j);a.inject(this.lineRoot)}if(m.length>1){var n={stroke:{color:"#BB261F",width:3}};var q=this.geometry.nodeFactory("shape");this.geometry.drawLineString(q,m,false,n);q.inject(this.lineRoot)}}else{this.isRun=false}}},drawGeom:function(){var a=this.options.graphicsData;this.clearGraphics();if(a!=null&&a.length>0){this.geomDIV.setStyle("display","block");var d=[];for(var h=0,f=a.length;h<f;h++){var l=a[h].data;var g=null;var n=a[h].gtype;var m=a[h].gstyle;if(n=="CIRCLE"){var p=this.mapoptions.toScreen(l.x,l.y);var b=l.r/this.mapoptions.resolution(this.mapoptions.getLevel()).x;g={x:parseInt(p[0]),y:parseInt(p[1]),r:b}}else{g=[];for(var e=0,j=l.length;e<j;e++){var o=l[e];var p=this.mapoptions.toScreen(o[0],o[1]);g.push(p)}}var c=null;switch(n){case"RECTANGLE":c=this.geometry.nodeFactory("shape");this.geometry.drawRectangle(c,g,m);break;case"CIRCLE":c=this.geometry.nodeFactory("circle");this.geometry.drawCircle(c,g,m,true);break;case"LINE":c=this.geometry.nodeFactory("shape");this.geometry.drawLineString(c,g,false,m);break;case"LINEARRING":c=this.geometry.nodeFactory("shape");this.geometry.drawLineString(c,g,true,m);break;default:c=this.geometry.nodeFactory("shape");this.geometry.drawPolygon(c,g,m);break}c.inject(this.graphicsRoot)}}},clearPoint:function(){this.pointObjLayer.empty()},clearLines:function(){var b=this.lineRoot.children;if(b&&b.length>0){var a=((b&&b.length>0)?b.length:0);while(b&&b.length>0&&a>0){if(b[0].ignore){b[0].ignore("click",null);b[0].ignore("mouseover",null);b[0].ignore("mouseout",null);b[0].ignore("mouseup",null);b[0].ignore("mousedown",null);b[0].ignore("dblclick",null)}if(b[0].data){b[0].data=null}if(b[0].resetResolution){b[0].resetResolution=null}if(b[0]._geotype){b[0]._geotype=null}if(b[0]._style){b[0]._style=null}if(b[0]._options){b[0]._options=null}b[0].eject();a--}}},clearGraphics:function(){var b=this.graphicsRoot.children;if(b&&b.length>0){var a=((b&&b.length>0)?b.length:0);while(b&&b.length>0&&a>0){if(b[0].ignore){b[0].ignore("click",null);b[0].ignore("mouseover",null);b[0].ignore("mouseout",null);b[0].ignore("mouseup",null);b[0].ignore("mousedown",null);b[0].ignore("dblclick",null)}if(b[0].data){b[0].data=null}if(b[0].resetResolution){b[0].resetResolution=null}if(b[0]._geotype){b[0]._geotype=null}if(b[0]._style){b[0]._style=null}if(b[0]._options){b[0]._options=null}b[0].eject();a--}}},clear:function(){this.pointList=null;this.pointList=[];this.options.graphicsData=null;this.options.graphicsData=[];this.clearPoint();this.clearGraphics();this.clearLines()},destory:function(){this.clear();this.removeEvents("pointclick");this.removeEvents("pointmouseover");this.removeEvents("click");this.removeEvents("mouseover");this.removeEvents("dblclick")},transformPointCoord:function(){var r=this.pointList;if(r!=null){var f=this.id+"_p_";for(var j=0,g=r.length;j<g;j++){var b=f+j;if($(b)){var d=$(b);var s=this.getLatLngValue(r[j]);var c=null;if(s!=null){c=this.toScreen(s)}else{break}var n=r[j].content;var h=r[j].marker;if(h){this.setMarkerImage(h)}else{this.setMarkerImage(this.options.defaultMarker)}d.removeClass(this.options.imgClass);if(this.selectedItem.index==j){this.setMarkerImage(this.selectedItem.marker)}var e=parseInt(c.x)-this.options.imgDeflectX;var q=parseInt(c.y)-this.options.imgDeflectY;var l=r[j].html;var m=r[j].title;var o=r[j].show;d.setStyles({left:e,top:q});if(!d.hasClass(this.options.imgClass)){d.addClass(this.options.imgClass)}}}var a=this.pointObjLayer.getElements("div.pointImages_card");a.each(function(i){var u=i.retrieve("pdata");var t=this.getLatLngValue(u);var k=null;if(t==null){return}else{k=this.toScreen(t)}i.setStyles({left:k.x,top:k.y})}.bind(this))}},cardIndex:1,getCardWindowID:function(b){if(this.options.combosWindow){var a=this.id;return a+"_tbl"}else{var a=this.id;return a+"_p_"+b+"_tbl"}},combosWindowData:null,setCardData:function(e,b){var a=this.getCardWindowID(e);if($(a+"_con")){$(a+"_con").set("html",b.content);if($(a)){var d=this.getLatLngValue(b);var c=null;if(d==null){return}else{c=this.toScreen(d)}$(a).store("pdata",b);$(a).setStyles({left:c.x,top:c.y})}}if(this.options.combosWindow){this.combosWindowData=b}},cardWindow:function(b,e){this.cardIndex++;var f=e.content;var k=this.getCardWindowID(b);var j=this.getLatLngValue(e);var c=null;if(j==null){return}else{c=this.toScreen(j)}var d=c.x;var i=c.y;if($(k)){$(this.getCardWindowID(b)).store("pdata",e);$(this.getCardWindowID(b)).setStyles({left:d,top:i});return null}var g=this.source+"images/window/";var a='<div style="z-index:1;position:absolute; bottom:68px; left:-38px; min-width:200px;box-shadow: #666 0px 0px 10px; -moz-box-shadow: #666 0px 0px 10px;-webkit-box-shadow: #666 0px 0px 10px; background:#ffffff; border:1px solid #ababab;">';a+="<br>";a+='<img src="'+g+'IMCloseButton_Normal.png"   onclick=\'MapGIS.closeTabWindow("'+k+'",event)\'  style="position:absolute;top:5px; cursor:pointer; right:5px;"/>';a+='<div id="'+k+'_con" style="min-width:240px;min-height:100px; margin:10px;" onclick="MapGIS.stopPropagation(event)">';a+=(typeof(f)=="undefined"?"":f);a+="</div>";a+='<div style="width:200px;height:1px; "></div><div style="position:absolute; bottom:-70px; BACKGROUND: url('+g+'w.png) no-repeat -5px -715px; width:92px; height:70px; margin-top:-64px; margin-left:38px;"></div>';a+="</div>";var h=new Element("div",{id:k,"class":"pointImages_card",styles:{left:(d)+"px",top:i+"px",position:"absolute",cursor:"pointer",display:"block",fontSize:"12px",border:"0px solid black","z-index":this.cardIndex}});h.set("html",a);h.store("pdata",e);return h}})})})();
(function(){MapGIS.Layers.extend({PaletteLayer:new Class({Extends:MapGIS.Layers.BaseLayer,Implements:[Events,Options],options:{stopEvent:null,map:null},graphics:null,initLayer:function(){},pdiv:null,geomDIV:null,lineRoot:null,geomRoot:null,geometry:null,isPaint:false,loadLayer:function(D){this.parent(D);var B=D.getViewSize();var A=B[0];var C=B[1];this.div.id="mappalettediv";this.pdiv=new Element("div",{id:"mapalettegeomdiv",styles:{display:"block",width:A,height:C,pointerEvents:"none",border:"0px",position:"absolute",top:0,left:0,zIndex:1}});this.pdiv.inject(this.div);this.geometry=new MapGIS.Geometry(this.pdiv,{width:A,height:C});this.geomRoot=this.geometry.creatGroup();this.lineRoot=this.geometry.creatGroup();this.loader=true;if(!$chk(window.MAP_FN_PALETTEKEYDOWNFUN)){window.MAP_FN_PALETTEKEYDOWNFUN=this.keydownFun.bind(this);window.document.addEvent("keydown",window.MAP_FN_PALETTEKEYDOWNFUN)}},data:[],tmpdata:[],drawingType:"polygon",movingPoint:[],paintingSTYLE:{stroke:{color:"#22a1c5",width:2},fillColor:[32,202,172,0.4]},paintingPosSTYLE:{stroke:{color:"#ff6600",width:2},fillColor:[255,102,0,0.4]},paintedSTYLE:{stroke:{color:"#ff9700",width:2},fillColor:[255,173,50,0.5]},paintingStyle:function(A){if(A!=null){this.paintingSTYLE=new Hash(this.paintingSTYLE);this.paintingSTYLE.extend(A);this.paintingSTYLE=this.paintingSTYLE.getClean()}},paintedStyle:function(A){if(A!=null){this.paintedSTYLE=new Hash(this.paintedSTYLE);this.paintedSTYLE.extend(A);this.paintedSTYLE=this.paintedSTYLE.getClean()}},keydownFun:function(A){A=A||window.event;A=new Event(A);if(this.isPaint){switch(A.key){case"delete":if(this.tmpdata.length>0){this.tmpdata.pop()}break;case"esc":this.tmpdata=[];this.clearLines();break;default:break}}},getData:function(){return this.data},getTmpData:function(){var D=this.tmpdata;if(D.length>0){var C=null;switch(this.drawingType){case"circle":C={x:0,y:0,r:0};if(D.length>0&&this.isPaint){var E=D[0];C.x=E[0];C.y=E[1];var B=D[(D.length-1)];var A=Math.pow(Math.abs(B[0]-E[0]),2)+Math.pow(Math.abs(B[1]-E[1]),2);C.r=Math.sqrt(A)}break;case"rectangle":C=[];if(D.length>1){C=[D[0],D[(D.length-1)]]}break;default:C=D;break}return{gtype:this.drawingType,data:C}}return{gtype:this.drawingType,data:[]}},getLayerPos:function(){var C=this.mapoptions.getPos();var B=this.pdiv.style.left.toInt()+C[0];var A=this.pdiv.style.top.toInt()+C[1];return[B,A]},tmpDrawing:function(G){var F=this.tmpdata;this.clearLines();if(F.length>0){var O=null;var H=this.getLayerPos();var B=this.movingPoint;var A=[B[0]-H[0],B[1]-H[1]];switch(this.drawingType){case"circle":O={x:0,y:0,r:0};if(F.length>0&&this.isPaint){var L=F[0];var P=G.toScreen(L[0],L[1]);O.x=P[0]-H[0];O.y=P[1]-H[1];var N=Math.pow(Math.abs(A[0]-O.x),2)+Math.pow(Math.abs(A[1]-O.y),2);O.r=Math.sqrt(N)}break;case"rectangle":O=[];if(F.length>0){var L=F[0];var P=G.toScreen(L[0],L[1]);O=[[(P[0]-H[0]),(P[1]-H[1])],A]}break;default:O=[];for(var E=0,D=F.length;E<D;E++){var L=F[E];var P=G.toScreen(L[0],L[1]);O.push([(P[0]-H[0]),(P[1]-H[1])])}if(this.isPaint){O.push(A)}break}var C=this.geometry.nodeFactory("shape");var K=this.paintingSTYLE;switch(this.drawingType){case"circle":this.geometry.drawCircle(C,O,K,true);var J=this.geometry.nodeFactory("shape");this.geometry.drawCircle(J,{x:O.x,y:O.y,r:2},this.paintingSTYLE,true);J.inject(this.lineRoot);var M=this.geometry.nodeFactory("shape");this.geometry.drawLineString(M,[[O.x,O.y],A],false,this.paintingSTYLE);M.inject(this.lineRoot);break;case"linestring":this.geometry.drawLineString(C,O,false,K);break;case"linearring":this.geometry.drawLineString(C,O,true,K);break;case"rectangle":this.geometry.drawRectangle(C,O,K);break;default:this.geometry.drawPolygon(C,O,K);break}C.inject(this.lineRoot);var I=this.geometry.nodeFactory("shape");this.geometry.drawCircle(I,{x:A[0],y:A[1],r:7},this.paintingSTYLE,true);I.inject(this.lineRoot)}},loadDataToGeom:function(E){var F=this.data;this.clearGeoms();if(F!=null&&F.length>0){for(var A=0,L=F.length;A<L;A++){var K=null;if(F[A].gtype.toLowerCase()=="circle"){K={x:0,y:0,r:0};var J=F[A].data.x;var I=F[A].data.y;var M=E.toScreen(J,I);K.x=M[0];K.y=M[1];K.r=F[A].data.r/(E.getRes().x)}else{K=[];for(var D=0,C=F[A].data.length;D<C;D++){var H=F[A].data[D];var M=E.toScreen(H[0],H[1]);K.push(M)}}var B=this.geometry.nodeFactory("shape");var G=F[A].gstyle||this.paintedSTYLE;switch(F[A].gtype.toLowerCase()){case"circle":this.geometry.drawCircle(B,K,G,true);break;case"linestring":this.geometry.drawLineString(B,K,false,G);break;case"linearring":this.geometry.drawLineString(B,K,true,G);break;case"rectangle":this.geometry.drawRectangle(B,K,G);break;default:this.geometry.drawPolygon(B,K,G);break}B.inject(this.geomRoot)}}},clearGeoms:function(){if(this.geomRoot!=null){var B=this.geomRoot.children;if(B&&B.length>0){var A=((B&&B.length>0)?B.length:0);while(B&&B.length>0&&A>0){if(B[0].ignore){B[0].ignore("click",null);B[0].ignore("mouseover",null);B[0].ignore("mouseout",null);B[0].ignore("mouseup",null);B[0].ignore("mousedown",null);B[0].ignore("dblclick",null)}if(B[0].data){B[0].data=null}if(B[0].resetResolution){B[0].resetResolution=null}if(B[0]._geotype){B[0]._geotype=null}if(B[0]._style){B[0]._style=null}if(B[0]._options){B[0]._options=null}B[0].eject();A--}}}},clearLines:function(){if(this.lineRoot!=null){var B=this.lineRoot.children;if(B&&B.length>0){var A=((B&&B.length>0)?B.length:0);while(B&&B.length>0&&A>0){if(B[0].ignore){B[0].ignore("click",null);B[0].ignore("mouseover",null);B[0].ignore("mouseout",null);B[0].ignore("mouseup",null);B[0].ignore("mousedown",null);B[0].ignore("dblclick",null)}if(B[0].data){B[0].data=null}if(B[0].resetResolution){B[0].resetResolution=null}if(B[0]._geotype){B[0]._geotype=null}if(B[0]._style){B[0]._style=null}if(B[0]._options){B[0]._options=null}B[0].eject();A--}}}},dragingLayer:function(E,A){if(this.parent(E)){var C=E.isMoving();if(!C){var D=this.mapoptions.getPos();var B={left:-D[0],top:-D[1]};this.pdiv.setStyles(B);this.loadDataToGeom(E);this.tmpDrawing(E)}}},zoomLayer:function(C){if(this.parent(C)){this.loadDataToGeom(C);var B=this.mapoptions.getPos();var A={left:-B[0],top:-B[1]};this.pdiv.setStyles(A)}},eventByMouseOver:function(A,C){if(this.isPaint){var B=C.getMousePos();this.movingPoint=B;this.tmpDrawing(C)}},eventByClick:function(A,D){if(this.isPaint){var C=D.getMousePos();var B=D.toMap(C[0],C[1]);this.tmpdata.push(B)}},eventByDblclick:function(A,D){if(this.isPaint){var C=D.getMousePos();var B=D.toMap(C[0],C[1]);this.tmpdata.push(B);this.data.push(this.getTmpData());this.loadDataToGeom(D);this.tmpdata=[];this.clearLines();this.fireEvent("change",{options:this.options,data:this.getData()})}},pop:function(){if(this.data!=null&&this.data.length>0){this.data.pop();this.loadDataToGeom(this.mapoptions);this.fireEvent("change",{options:this.options,data:this.getData()})}},shift:function(){if(this.data!=null&&this.data.length>0){this.data.shift();this.loadDataToGeom(this.mapoptions);this.fireEvent("change",{options:this.options,data:this.getData()})}},loadData:function(A){this.data=A;if(this.data!=null&&this.mapoptions!=null){this.loadDataToGeom(this.mapoptions);this.fireEvent("change",{options:this.options,data:this.getData()})}},paintTools:function(A){this.start();switch(A){case 1:this.drawingType="linestring";break;case 2:this.drawingType="linearring";break;case 3:this.drawingType="rectangle";break;case 4:this.drawingType="circle";break;case 5:this.drawingType="polygon";break;default:this.drawingType="polygon";break}},initPaint:function(){if(this.options.map!=null){var A=this.options.map;if(typeof(A.setActiveTool)!="undefined"){A.setActiveTool("$")}}},stop:function(){this.isPaint=false},start:function(){this.initPaint();this.isPaint=true},paintLine:function(A){this.paintTools(A?2:1)},paintCircle:function(A){this.paintTools(4)},paintPolygon:function(){this.paintTools(5)},paintRectangle:function(){this.paintTools(3)},startEvent:function(){},stopEvent:function(){},clear:function(){this.data=[];this.tmpdata=[];this.clearGeoms();this.clearLines()},backup:function(){this.pop()}})})})();
(function(){MapGIS.Layers.extend({OMapLayer:new Class({Extends:MapGIS.Layers.TileLayer,Implements:[Events,Options],options:{url:"http://d{s}.map.baidu.com/resource/mappic/sz/14/3/lv{z}/{x},{y}.jpg"},servernum:["1","2","0"],serverindex:0,loadImage:function(i,h,k,o,c,j,l,p,b,g){var m=this.serverindex++;var f=3;var n=this.servernum[m%f];var e={z:6-h,y:o,x:k,s:n};var a=i.substitute(e);var d=this.div.getElementById(b);if(d){d.src=a}else{d=new Element("img",{src:a,id:b,"class":p,loaded:"false",styles:{position:"absolute",left:c,top:j,width:l,height:l,border:"0px",margin:"0px",padding:"0px","z-index":2}});d.inject(this.div);d.onload=function(){this.set("loaded","true")}}}})})})();
(function(){MapGIS.extend({OMap:new Class({Extends:MapGIS.Map,Implements:[Events,Options],options:{fullMode:false,maptype:0,level:0,levelMax:5},paletteLayer:null,imageLayer:null,markerLayer:null,baseLayer:null,winTimeout:null,setActiveTool:function(a){switch(a){case"*1":if(this.paletteActiveFunHand!=null){this.paletteLayer.removeEvent("change",this.paletteActiveFunHand);this.paletteActiveFunHand=null}this.paletteActiveFunHand=this.paletteActiveFun.bind(this);this.paletteLayer.addEvent("change",this.paletteActiveFunHand);this.paletteLayer.clear();this.paletteLayer.paintPolygon(true);break;case"*2":if(this.paletteActiveFunHand!=null){this.paletteLayer.removeEvent("change",this.paletteActiveFunHand);this.paletteActiveFunHand=null}this.paletteActiveFunHand=this.paletteActiveFun.bind(this);this.paletteLayer.addEvent("change",this.paletteActiveFunHand);this.paletteLayer.clear();this.paletteLayer.paintCircle(true);break;default:break}this.parent(a);if(this.paletteLayer){this.paletteLayer.stop()}},transformOmapCoor:function(a){return{x:a.x,y:-a.y}},initialize:function(b,c){this.options.contentMenu.obj=[];var a=new MapGIS.OMapModel();if(typeof(USEREXTENT)!="undefined"){this.setOptions(USEREXTENT)}this.parent(b,c,a);var d=[{title:"放大",fn:function(){this.setActiveTool("+")}.bind(this)},{title:"缩小",fn:function(){this.setActiveTool("-")}.bind(this)},{title:"拖拽",fn:function(){this.setActiveTool("$")}.bind(this)},{title:"复原",fn:function(){this.reposition()}.bind(this)}];this.options.contentMenu.obj=new MapGIS.MapContentMenu(this,{baseMenuList:d});this.options.contentMenu.obj.div.inject(this.toolsdiv);this.customLoading();this.fireEvent("load",true)},customLoading:function(){this.baseLayer=new MapGIS.Layers.OMapLayer({id:"LB01",zIndex:1});this.addLayer(this.baseLayer);this.imageLayer=new MapGIS.Layers.MarkerLayer({id:"imageLayer01",zIndex:25});this.markerLayer=new MapGIS.Layers.MarkerLayer({id:"markerLayer01",zIndex:26,effects:true});var a=this.stopEvent.bind(this);this.paletteLayer=new MapGIS.Layers.PaletteLayer({id:"mappalettelayer",zIndex:20});this.addLayers([this.markerLayer,this.imageLayer,this.paletteLayer]);if(this._maploading){this._maploading()}}})})})();