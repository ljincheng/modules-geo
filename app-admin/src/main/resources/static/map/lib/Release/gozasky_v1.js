var MapGISConfig={source:((typeof MapGISConfig=="object"&&MapGISConfig.registerSourcePath)?MapGISConfig.registerSourcePath:"lib/source/")};(function(){window.MapGIS=new Hash({version:"3.0.0",path:{source:MapGISConfig.source,themes:"themes/",plugins:"plugins/"},files:new Hash(),lastSeqID:0,createUniqueID:function(A){if(A==null){A="id_"}MapGIS.lastSeqID+=1;return A+MapGIS.lastSeqID},getElement:function(){var D=[];for(var C=0,A=arguments.length;C<A;C++){var B=arguments[C];if(typeof B=="string"){B=document.getElementById(B)}if(arguments.length==1){return B}D.push(B)}return D},False:function(){return false},True:function(){return true},Tween:function(A){return(A/=1)*A},correctPNG:function(){if(Browser.Engine.trident4){var H=document.getElementsByName("PngImgs");for(var F=0;F<H.length;){var D=H[F];var B;var A=(D.id)?"id='"+D.id+"' ":"";var E=(D.className)?"class='"+D.className+"' ":"";var G=(D.title)?"title='"+D.title+"' ":"title='"+D.alt+"' ";var C="display:inline-block;"+D.style.cssText;if(D.align=="left"){C="float:left;"+C}if(D.align=="right"){C="float:right;"+C}if(D.parentElement.href){C="cursor:hand;"+C}B="<span unselectable ='on' "+A+E+G+' style="width:'+D.width+"px; height:"+D.height+"px;"+C+";text-decoration:none;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+D.src+"', sizingMethod='scale');\"></span>";if(item.morph){item.morph=null}D.outerHTML=B;if(D.destroy){D.destroy()}D=null}}},getSize:function(C){var D=(typeof(C)=="object")?C:document.getElementById(C);var B=[D.offsetWidth,D.offsetHeight];if(D==document.body&&!document.all){B[1]=D.clientHeight}if(!B[0]){B[0]=D.clientWidth}if(!B[0]){B[0]=parseInt(D.style.width)}if(!B[1]){B[1]=D.clientHeight}if(!B[1]){B[1]=parseInt(D.style.height)}if(!B[0]||!B[1]){var A=D.parentElement;while(A){if(!B[0]&&A.offsetWidth){B[0]=A.offsetWidth}if(!B[1]&&A.offsetHeight){B[1]=A.offsetHeight}if(B[0]&&B[1]){break}A=A.parentElement}}return B},getClientXY:function(A,E){if(typeof(A.client)!="undefined"){var B=$(E.id).getPosition();return[A.client.x-B.x,A.client.y-B.y]}else{if(typeof A.offsetX!="undefined"){var C=A.target||A.srcElement;var D=[A.offsetX,A.offsetY];while(C&&C!=E){if(C.tagName=="AREA"){C=C.offsetParent||C.parentElement;continue}D[0]+=C.offsetLeft;D[1]+=C.offsetTop;C=C.offsetParent||C.parentElement}return[D[0],D[1]]}else{if(typeof A.pageX!="undefined"){var D=MapGIS.getAbsolutePos(E);return[A.clientX-D[0],A.clientY-D[1]]}else{return[0,0]}}}},getAbsolutePos:function(C){var A=[0,0];var B=C;while(B&&B.offsetParent){A[0]+=B.offsetLeft;A[1]+=B.offsetTop;B=B.offsetParent}return A},getExtentCenter:function(B){var A=(B[2]+[0])/2;var C=(B[3]+[1])/2;return[A,C]},closeTabWindow:function(C,A){var B=(A)?A:window.event;if(window.event){B.cancelBubble=true}else{B.stopPropagation()}if($(C)){$(C).fade("out")}},stopPropagation:function(A){var A=(event)?event:window.event;if(window.event){A.cancelBubble=true}else{A.stopPropagation()}}})})();
(function(){MapGIS.extend({Model:new Class({Implements:[Events,Options],options:{xmin:0,ymin:0,xmax:0,ymax:0,level:0,preLevel:0,maxLevel:0,minLevel:0,size:[0,0],clientPos:[0,0],wheelPos:[0,0],mousePos:[0,0],speed:[0,0],canOver:true,origin:{x:0,y:0},fullExtent:[0,0,0,0],tileSize:256,ismoving:true},resolution:$empty,originPoint:null,restoration:{level:0,preLevel:0,clientPos:[0,0],wheelPos:[0,0],opoint:null},initialize:function(A){this.setOptions(A)},getMousePos:function(){return this.options.mousePos},setMousePos:function(A){this.options.mousePos=A},getMousePoint:function(){var B=this.getMousePos();var A=this.toMap(B[0],B[1]);return A},setRestore:function(){var D=this.getLevel();var C=this.getPreLevel();var E=this.getPos();var B=this.getWheelPos();var A=this.getOriginPoint();this.restoration={level:D,preLevel:C,clientPos:E,wheelPos:B,opoint:A}},restore:function(){this.setOptions(this.restoration);this.originPoint=this.restoration.opoint;this.lastpos=this.getPos()},getMapOptions:function(){return this},setZoom:function(A){var B=this.getLevel();if(A){if(B<this.options.maxLevel){this.options.preLevel=this.options.level;this.options.level++;this.lastTile=null;return true}}else{if(B>this.options.minLevel){this.options.preLevel=this.options.level;this.options.level--;this.lastTile=null;return true}}return false},setWheelPos:function(J,I){this.options.wheelPos=[J,I];if(this.getLevel()!=this.getPreLevel()){var G=this.getPreLevel();var F=this.resolution(G);var E=this.getPos();var L=this.originPoint;var B=(E[0]-J);var H=(E[1]-I);var M=L[0]-B*F.x;var K=L[1]+H*F.y;var A=this.resolution(this.getLevel());var D=M+B*A.x;var C=K-H*A.y;this.originPoint=[D,C]}},getWheelPos:function(){return this.options.wheelPos},getPreLevel:function(){return this.options.preLevel},getLevel:function(){return this.options.level},setLevel:function(B){if(B==this.getLevel()){return}this.options.preLevel=this.options.level;var A=this.getViewSize();if(B>this.options.maxLevel){this.options.level=this.options.maxLevel}else{if(B<this.options.minLevel){this.options.level=this.options.minLevel}else{this.options.level=B}}if(B!=this.options.preLevel){this.setWheelPos(A[0]/2,A[1]/2)}this.lastTile=null},getSpeed:function(){return this.options.speed},getViewSize:function(){return this.options.size},setViewSize:function(A){this.options.size=A},setMapOptions:function(A){if(this.options.canOver){if(A.options){this.setOptions(A.options)}if(A.resolution){this.resolution=A.resolution}if(A.toMap){this.toMap=A.toMap}if(A.toScreen){this.toScreen=A.toScreen}}},setPos:function(A){this.options.clientPos=A},getPos:function(){return this.options.clientPos},setSpeed:function(A){this.options.speed=A},getRes:function(){return this.resolution(this.getLevel())},getOrigin:function(){return this.options.origin},getExtent:function(){var C=this.getOriginPoint();var H=this.getPos();var F=this.getRes();var E=this.getViewSize();var G=C[0]-H[0]*F.x;var A=C[1]+H[1]*F.y;var B=G+E[0]*F.x;var D=A-E[1]*F.y;return{xmin:G,ymin:D,xmax:B,ymax:A}},getOriginPoint:function(){if(this.originPoint==null){var B=this.options.fullExtent;var D=[(B[0]+B[2])/2,(B[1]+B[3])/2];var E=this.getLevel();var A=this.getRes();var C=this.getViewSize();var F=[(D[0]-A.x*(C[0]/2)),(D[1]+A.y*(C[1]/2))];this.originPoint=F;return F}else{return this.originPoint}},getLeftTopPoint:function(){var B=this.getOriginPoint();var E=this.getPos();var C=this.getRes();var D=B[0]-E[0]*C.x;var A=B[1]+E[1]*C.y;return[D,A]},getCenterPoint:function(){var G=this.getLeftTopPoint();var C=this.getRes();var B=this.getViewSize();var A=B[0];var F=B[1];var E=G[0]+A*C.x;var D=G[1]-F*C.y;return[E,D]},getCenterPos:function(){var A=this.getViewSize();return[A[0]/2,A[1]/2]},toMap:function(A,F){var E=this.getLeftTopPoint();var B=this.getRes();var D=E[0]+A*B.x;var C=E[1]-F*B.y;return[D,C]},toScreen:function(A,F){var E=this.getLeftTopPoint();var B=this.getRes();var D=Math.floor((A-E[0])/B.x);var C=Math.floor((E[1]-F)/B.y);return[D,C]},toLayerScreen:function(A,F){var E=this.getOriginPoint();var B=this.getRes();var D=Math.floor((A-E[0])/B.x);var C=Math.floor((E[1]-F)/B.y);return[D,C]},lastpos:[0,0],moveNo:1,setRunStatus:function(A){this.options.ismoving=A},isMoving:function(){var A=this.options.ismoving;if(A){var B=this.getPos();if(B[0]==this.lastpos[0]&&B[1]==this.lastpos[1]){if(this.moveNo>0){return(this.options.ismoving||false)}else{this.moveNo++}}else{this.moveNo=0;this.lastpos=[B[0],B[1]]}}return A},movDistance:function(){var E=this.getPos();var B=this.lastpos;var A=E[0]-B[0];var D=E[1]-B[1];var C=Math.pow(A,2)+Math.pow(D,2);return Math.sqrt(C)},posTag:function(){var A=this.lastpos;var B=this.getLevel();return(B+"a"+A[0]+"a"+A[1])},getTileSize:function(){return this.options.tileSize},lastTile:null,lastTiles:[],layers:{noNewTilelayer:[],newtiles:[],deltiles:[],alltiles:[]},currentTileNo:function(){var A=this.getTileNo(this.getRes(),this.getLeftTopPoint());return A},getTiles:function(){var b=this.getTileNo(this.getRes(),this.getLeftTopPoint());if(this.lastTile==null||Math.abs(this.lastTile.row-b.row)>0||Math.abs(this.lastTile.cell-b.cell)>0){try{var N=b.left;var V=b.top;var Y=b.row;var R=b.cell;var G=this.getPos();var P=this.getViewSize();var D=this.getTileSize();var J=Math.ceil(P[1]/D)+1;var E=Math.ceil(P[0]/D)+1;var I=this.getLevel();var W=this.lastTiles;var F=W.length;var C=[];var a=[];for(var O=0;O<J;O++){var M=V+D*O-G[1];var H=Y+O;for(var Z=0;Z<E;Z++){var S=N+D*Z-G[0];var B=R+Z;var Q=I+"-"+H+"-"+B;var L=false;for(var U=0;U<F;U++){var K=W[U];if(K.id==Q){W[U].v=1;L=true;break}}if(!L){a.push({z:I,r:H,c:B,l:S,t:M,id:Q,v:0})}C.push({z:I,r:H,c:B,l:S,t:M,id:Q,v:0})}}this.lastTile=b;this.layers.newtiles=a;var A=[];for(var U=0,T=W.length;U<T;U++){if(W[U].v==0){A.push(W[U])}}this.layers.deltiles=A;this.layers.hasNewTile=true;this.layers.noNewTilelayer.empty();this.layers.alltiles=C;this.lastTiles=C}catch(X){}}return this.layers},hasNewTile:function(D){var A=this.layers.noNewTilelayer;for(var C=0,B=A.length;C<B;C++){if(A[C]==D){return false}}this.layers.noNewTilelayer.push(D);return true},getTileNo:function(B,D){var H=this.options.tileSize;var G=this.options.origin;var F=D[0];var E=D[1];var J=Math.floor((F-G.x)/B.x/H);var I=Math.floor((G.y-E)/B.y/H);var A=-(F-G.x)/B.x+H*J;var C=-(G.y-E)/B.y+H*I;return{cell:J,row:I,left:A,top:C}}})})})();
(function(){MapGIS.extend({ChinaModel:new Class({Extends:MapGIS.Model,Implements:[Events,Options],options:{maxLevel:13,minLevel:0,origin:{x:-20037508.342787,y:20037508.342787},fullExtent:[8022830.488809966,2175914.6142894914,15849982.185209934,7067884.424539471],tileSize:256},resolution:function(C){var A=[{level:4,resolution:9783.93962049996,scale:36978595.474472},{level:5,resolution:4891.96981024998,scale:18489297.737236},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705}];var B=A[C].resolution;return{x:B,y:B}}})})})();
(function(){MapGIS.extend({Geometry:new Class({Implements:[Events,Options],options:{width:3000,height:3000,resolution:1,extent:{xmin:0,ymin:0,xmax:0,ymax:0}},container:null,root:null,vectorRoot:null,toMap:function(B){var E=this.options.extent.xmin;var A=this.options.extent.ymax;var D=this.options.resolution;var C=B[0]*D+E;var F=A-B[1]*D;return[C,F]},toScreen:function(B){var D=this.options.extent.xmin;var A=this.options.extent.ymax;var C=this.options.resolution;return[Math.round((B[0]-D)/C),Math.round((A-B[1])/C)]},initialize:function(A,B){this.setOptions(B);if(A!=null){this.container=MapGIS.getElement(A);this.root=new ART(this.options.width,this.options.height);this.setStyle(this.root,null,{hasStyle:true});this.root.inject(this.container)}},setResolution:function(A,B){this.options.extent=B;this.options.resolution=A},creatGroup:function(){var A=this.groupFactory();A.inject(this.root);return A},getGroup:function(B){var C=this.root.children;var A=C.length;if(A>B){return C[B]}return null},groupFactory:function(){var A=new ART.Group();this.setStyle(A,null,{hasStyle:true});return A},nodeFactory:function(A){if(A==null){return new ART.Shape()}else{switch(A.toLowerCase()){case"wedge":return new ART.Wedge();break;default:return new ART.Shape();break}}},clear:function(){var D=this.root.children;var A=D.length;if(A>0){for(var C=0,B=A;C<B;C++){if(D[C].data){D[C].data=null}if(D[C].resetResolution){D[C].resetResolution=null}if(D[C]._geotype){D[C]._geotype=null}if(D[C]._style){D[C]._style=null}if(D[C]._options){D[C]._options=null}this.eject(D[C])}}},eject:function(C){var E;var B=C.children;if(B&&B.length>0){E=B[0];if(B[0].data){B[0].data=null}if(B[0].resetResolution){B[0].resetResolution=null}if(B[0]._geotype){B[0]._geotype=null}if(B[0]._style){B[0]._style=null}if(B[0]._options){B[0]._options=null}this.eject(E)}if(C){if(C.data){C.data=null}if(C.resetResolution){C.resetResolution=null}if(C._geotype){C._geotype=null}if(C._style){C._style=null}if(C._options){C._options=null}if(C.eject){C.eject()}else{var A=C.toElement?C.toElement():C.element?C.element:C;var D=A.parentNode;if(D){D.removeChild(A)}}C=null}},destroy:function(){this.eject(this.root)},addEvents:function(B,A){if(A!=null){for(var C in A){B.listen(C,A[C].bind(B))}}},drawLineString:function(D,H,J,B){var G=[];var A=this.options.extent.xmin;var C=this.options.extent.ymax;var I=this.options.resolution;for(var F=0,E=H.length;F<E;F++){G.push(this.toMap(H[F]))}D.data=G;if(!D.resetResolution){D.resetResolution=function(R,U){var N=this.data;var P=[];var K=U.xmin;var L=U.ymax;for(var O=0,M=N.length;O<M;O++){P.push([Math.round((N[O][0]-K)/R),Math.round((L-N[O][1])/R)])}var V=new ART.Path();var Q=P.length;if(Q>0){var T=P[0][0];var S=P[0][1];if(!isNaN(T)&&!isNaN(S)){V.moveTo(T,S)}}for(var O=1,M=P.length;O<M;O++){var T=P[O][0];var S=P[O][1];if(!isNaN(T)&&!isNaN(S)){V.lineTo(T,S)}}if(this._geotype=="linearring"||this._geotype=="polygon"){V.close()}this.draw(V)}.bind(D)}if(J){D._geotype="linearring"}else{D._geotype="linestring"}D.resetResolution(this.options.resolution,this.options.extent);this.setStyle(D,B,{hasStroke:true});return D},drawCircle:function(F,E,D,B){var H=this.options.extent.xmin;var A=this.options.extent.ymax;var C=this.options.resolution;var G={x:E.x*C+H,y:A-E.y*C,r:E.r*C};F.data=G;if(!F.resetResolution){F.resetResolution=function(N,Q){var L=this.data;var J=Q.xmin;var K=Q.ymax;var M={x:Math.round((L.x-J)/N),y:Math.round((K-L.y)/N),r:Math.round(L.r/N)};var P=M.x;var O=M.y;var I=M.r;if(!isNaN(P)&&!isNaN(O)&&!isNaN(I)){var R=new ART.Path();R.moveTo(P-I,O).arc(2*I,0,I,I).arc(-2*I,0,I,I);this.draw(R)}}.bind(F)}F.resetResolution(this.options.resolution,this.options.extent);F._geotype="circle";this.setStyle(F,D,{hasStroke:true,hasFill:B});return F},drawPolygon:function(C,B,A){this.drawLineString(C,B,true);this.setStyle(C,A,{hasStroke:true,hasFill:true});C._geotype="polygon";return C},drawRectangle:function(D,H,B){var F=[];var A=this.options.extent.xmin;var C=this.options.extent.ymax;var I=this.options.resolution;for(var G=0,E=H.length;G<E;G++){F.push(this.toMap(H[G]))}D.data=F;if(!D.resetResolution){D.resetResolution=function(R,U){var M=this.data;var O=[];var J=U.xmin;var K=U.ymax;for(var N=0,L=M.length;N<L;N++){O.push([Math.round((M[N][0]-J)/R),Math.round((K-M[N][1])/R)])}var T=O[0][0];var S=O[0][1];var Q=O[1][0];var P=O[1][1];if(!isNaN(T)&&!isNaN(S)&&!isNaN(Q)&&!isNaN(P)){var V=new ART.Path();V.moveTo(T,S).lineTo(T,P).lineTo(Q,P).lineTo(Q,S).close();this.draw(V)}}.bind(D)}D._geotype="rectangle";D.resetResolution(this.options.resolution,this.options.extent);this.setStyle(D,B,{hasStroke:true,hasFill:true});return D},setStyle:function(E,D,B){var A=null;D=D||E._style;B=B||E._options;if(D){A=new Hash(D);A.combine(this.defaultStyle);A=A.getClean()}else{A=this.defaultStyle}E._style=A;if(B){if(B.hasStyle){var C=E.toElement?E.toElement():E.element?E.element:E;var G=A.styles;for(var F in G){C.style[F]=G[F]}}if(B.hasFill){if($type(A.fillColor)=="array"){if($type(A.fillColor)=="array"){if(A.fillColor.length>1&&$type(A.fillColor[0])=="array"){E.fill.run(A.fillColor,E)}else{E.fill(A.fillColor,A.fillColor)}}}else{E.fill(A.fillColor)}}if(B.hasStroke){E.stroke(A.stroke.color,A.stroke.width,A.stroke.cap,A.stroke.join)}}E._options=B;return E},defaultStyle:{styles:{left:"0px",top:"0px",position:"absolute"},stroke:{color:"#47bfe1",width:1,cap:"round",join:"miter"},fillColor:[32,202,172,0.4],opacity:0.7}})})})();
(function(){MapGIS.extend({Palette:new Class({Implements:[Events,Options],options:{width:1,height:1,resolution:1,extent:{xmin:0,ymin:0,xmax:0,ymax:0}},container:null,paintContainer:null,root:null,paintRoot:null,storeRoot:null,geometry:null,editGeometry:null,canPaint:false,canEditNode:false,showLeadNode:true,eventNode:null,paintStatus:0,paintType:0,winTimeout:null,keydownfn:null,paintevent:{movepoint:[0,0],pointlist:[],clear:function(){this.pointlist=null;this.pointlist=[];this.movepoint=[0,0]},clickpoint:function(A){this.pointlist.push(A)},paint:{id:null,node:null,leadnode:null,leadnode2:null}},setResolution:function(A,B){this.options.extent=B;this.options.resolution=A;this.geometry.setResolution(A,B)},resetResolution:function(D,E){this.setResolution(D,E);if(this.editGeometry!=null){this.editGeometry.resetResolution(D,E)}var C=this.storeRoot.children;if(C&&C.length>0){for(var B=0,A=C.length;B<A;B++){C[B].resetResolution(D,E)}}},initialize:function(B,C){this.setOptions(C);var A={width:this.options.width,height:this.options.height,extent:this.options.extent,resolution:this.options.resolution};this.geometry=new MapGIS.Geometry(B,A);this.container=this.geometry.container;this.root=this.geometry.root;this.initStoreRoot();this.initPaintRoot();if(!this.eventNode){this.eventNode=this.container}this.keydownfn=this.keydownFun.bind(this);document.addEvent("keydown",this.keydownfn)},keydownFun:function(A){A=A||window.event;A=new Event(A);if(this.canPaint){if(A.key=="delete"&&this.paintStatus==1){if(this.paintevent.pointlist.length>0){if(this.paintevent.pointlist.length==1){this.paintevent.pointlist.splice(0,1);this.paintevent.clear();if(this.paintevent.paint.leadnode){this.paintevent.paint.leadnode.eject();this.paintevent.paint.leadnode=null}if(this.paintevent.paint.node){this.paintevent.paint.node.eject();this.paintevent.paint.node=null;this.paintevent.paint.id=-1}this.paintStatus=0}else{this.paintevent.pointlist.splice(this.paintevent.pointlist.length-1,1);this.paintDraw()}}}}},initPaintRoot:function(){this.paintRoot=this.geometry.groupFactory();this.paintRoot.inject(this.root)},initStoreRoot:function(){if(this.storeRoot!=null){this.storeRoot.eject()}this.storeRoot=this.geometry.groupFactory();this.storeRoot.inject(this.root)},paintLine:function(A){this.paintType=0;if(A){this.paintType=1}},paintCircle:function(A){this.paintType=2;if(A){this.paintType=3}},paintPolygon:function(){this.paintType=4},paintRectangle:function(){this.paintType=5},storeNode:function(A){if(A!=null){A.inject(this.storeRoot);this.fireEvent("change",{options:this.options,data:this.getData()})}},clickEditNode:function(B,A){if(B.editGeometry==null){var C=$(B.container.id).getCoordinates();B.editGeometry=new MapGIS.EditGeometry(B.paintRoot,{width:B.options.width,height:B.options.height,offsetLeft:C.left,offsetTop:C.top,resolution:B.options.resolution,extent:B.options.extent});B.editGeometry.addEvent("change",function(){this.fireEvent("change",{options:this.options,data:this.getData()})}.bind(B))}B.editGeometry.editNode(A);B.editGeometry.start()},getData:function(){var F=[];var D=this.storeRoot.children;if(D&&D.length>0){for(var C=0,A=D.length;C<A;C++){var E="POLYGON";switch(D[C]._geotype){case"polygon":E="POLYGON";break;case"circle":E="CIRCLE";break;case"linestring":E="LINE";break;case"linearring":E="LINEARRING";break;case"rectangle":E="RECTANGLE";break;default:E="UNKNOWN";break}var B={stroke:{color:D[C]._style.stroke.color,width:D[C]._style.stroke.width,cap:D[C]._style.stroke.cap,join:D[C]._style.stroke.join},fillColor:D[C]._style.fillColor};F.push({gtype:E,data:D[C].data,gstyle:B})}}return F},loadData:function(F){if(F!=null){for(var C=0,A=F.length;C<A;C++){var E=F[C].gtype;var H=F[C].data;var B=F[C].gstyle;var G=null;var D=null;switch(E){case"POLYGON":D=this.geometry.nodeFactory("shape");this.geometry.drawPolygon(D,[[0,0]],B);break;case"CIRCLE":D=this.geometry.nodeFactory("circle");this.geometry.drawCircle(D,{x:0,y:0,r:0},B,true);break;case"LINE":D=this.geometry.nodeFactory("shape");this.geometry.drawLineString(D,[[0,0]],false,B);break;case"LINEARRING":D=this.geometry.nodeFactory("shape");this.geometry.drawLineString(D,[[0,0]],true,B);break;case"RECTANGLE":D=this.geometry.nodeFactory("shape");this.geometry.drawRectangle(D,[[0,0],[0,0]],B);break;default:D=this.geometry.nodeFactory("shape");this.geometry.drawPolygon(D,[[0,0]],B);break}D.data=H;D.inject(this.storeRoot)}this.resetResolution(this.options.resolution,this.options.extent)}},drawingGeometry:function(B){if(!this.showLeadNode){return}var A=this.paintevent.paint.leadnode;if(A==null){A=this.geometry.nodeFactory("circle");this.paintevent.paint.leadnode=A;A.inject(this.paintRoot)}A.show();this.geometry.drawCircle(A,{x:B[0],y:B[1],r:7},this.paintingSTYLE,true)},checkNode:function(A,B){var C=this.paintType;var D=this.paintevent.paint;if(D.id!=C){D.id=C;if(D.node!=null){D.node.eject();D.node=null}D.node=this.geometry.nodeFactory(A);D.node.inject(this.paintRoot);D.leadnode2=this.geometry.nodeFactory("LINE");D.leadnode2.inject(this.paintRoot)}if(B){D.node.hide();if(D.leadnode){D.leadnode.hide()}if(D.leadnode2){D.leadnode2.hide()}}else{this.drawingGeometry(this.paintevent.movepoint);D.node.show();if(D.leadnode){D.leadnode.show()}if(D.leadnode2){D.leadnode2.show()}}},paintDraw:function(){var C=this.paintType;var D=this.paintevent.paint;switch(C){case 0:case 1:if(this.paintStatus){this.checkNode("shape",false);var G=$A(this.paintevent.pointlist);G.push(this.paintevent.movepoint);this.geometry.drawLineString(D.node,G,C,this.paintingSTYLE)}else{this.checkNode("shape",true);var E=this.geometry.nodeFactory("shape");this.geometry.drawLineString(E,this.paintevent.pointlist,C,this.paintedSTYLE);this.storeNode(E)}break;case 2:case 3:var F=this.paintevent.pointlist;if(F<1){return}if(this.paintStatus){this.checkNode("circle",false);var G=this.paintevent.pointlist;var B=this.paintevent.movepoint;var I=G[0][0];var H=G[0][1];var J=Math.pow(Math.abs(B[0]-I),2)+Math.pow(Math.abs(B[1]-H),2);var A=Math.sqrt(J);this.geometry.drawCircle(D.node,{x:I,y:H,r:A},this.paintingSTYLE,(C==2?0:1));this.geometry.drawLineString(D.leadnode2,[[I,H],B],(C==2?0:1),"LINE")}else{this.checkNode("circle",true);var G=this.paintevent.pointlist;var B=G.getLast();var I=G[0][0];var H=G[0][1];var J=Math.pow(Math.abs(B[0]-I),2)+Math.pow(Math.abs(B[1]-H),2);var A=Math.sqrt(J);var E=this.geometry.nodeFactory("circle");this.geometry.drawCircle(E,{x:I,y:H,r:A},this.paintedSTYLE,(C==2?0:1));this.storeNode(E)}break;case 4:var F=this.paintevent.pointlist;if(F<1){return}if(this.paintStatus){this.checkNode("shape",false);var G=$A(this.paintevent.pointlist);G.push(this.paintevent.movepoint);this.geometry.drawPolygon(D.node,G,this.paintingSTYLE)}else{this.checkNode("shape",true);var E=this.geometry.nodeFactory("shape");this.geometry.drawPolygon(E,this.paintevent.pointlist,this.paintedSTYLE);this.storeNode(E)}break;case 5:var F=this.paintevent.pointlist;if(F<1){return}if(this.paintStatus){this.checkNode("shape",false);var G=[];G.push(this.paintevent.pointlist[0]);G.push(this.paintevent.movepoint);this.geometry.drawRectangle(D.node,G,this.paintingSTYLE)}else{this.checkNode("shape",true);var G=[];G.push(this.paintevent.pointlist[0]);G.push(this.paintevent.pointlist.getLast());var E=this.geometry.nodeFactory("shape");this.geometry.drawRectangle(E,G,this.paintedSTYLE);this.storeNode(E)}break;default:break}},startPaint:function(){this.stopPaint();this.canPaint=true;this.paintStatus=0;if(this.canEditNode&&this.editGeometry){this.editGeometry.start()}this.eventNode.onmousedown=null;this.eventNode.onmousedown=this._paintMouseDown.bindWithEvent(this);this.fireEvent("start",{options:this.options,data:this.getData()})},stopPaint:function(){this.canPaint=false;this.eventNode.onmousedown=null;if(this.canEditNode&&this.editGeometry){this.editGeometry.stop()}var C=this.storeRoot.children;if(C&&C.length>0){for(var B=0,A=C.length;B<A;B++){C[B].ignore("click",null);C[B].ignore("mousedown",null);C[B].ignore("dblclick",null)}}this.fireEvent("stop",{options:this.options,data:this.getData()})},repaint:function(){var A=this.storeRoot.children;if(A&&A.length>0){var B=A[A.length-1];if(B.ignore){B.ignore("click",null)}B.eject();if(this.editGeometry!=null&&this.editGeometry.fromNode==B){this.editGeometry.clear()}this.fireEvent("change",{options:this.options,data:this.getData()})}},edit:function(D){this.canEditNode=D;if(this.canEditNode){var C=this.storeRoot.children;if(C&&C.length>0){for(var B=0,A=C.length;B<A;B++){C[B].ignore("dblclick",null);C[B].listen("dblclick",this.clickEditNode.pass([this,C[B]]))}}}else{var C=this.storeRoot.children;if(C&&C.length>0){for(var B=0,A=C.length;B<A;B++){C[B].ignore("dblclick",null)}}}},paintingStyle:function(A){if(A!=null){this.paintingSTYLE=new Hash(this.paintingSTYLE);this.paintingSTYLE.extend(A);this.paintingSTYLE=this.paintingSTYLE.getClean()}},paintedStyle:function(A){if(A!=null){this.paintedSTYLE=new Hash(this.paintedSTYLE);this.paintedSTYLE.extend(A);this.paintedSTYLE=this.paintedSTYLE.getClean()}},edittingStyle:function(){},paintingSTYLE:{stroke:{color:"#22a1c5",width:2},fillColor:[32,202,172,0.4]},paintedSTYLE:{stroke:{color:"#ff9700",width:2},fillColor:[255,173,50,0.5]},show:function(){},hide:function(){},clear:function(){var B=this.storeRoot.children;if(B&&B.length>0){var A=((B&&B.length>0)?B.length:0);while(B&&B.length>0&&A>0){if(B[0].ignore){B[0].ignore("click",null);B[0].ignore("mousedown",null);B[0].ignore("dblclick",null)}if(B[0].data){B[0].data=null}if(B[0]._geotype){B[0]._geotype=null}B[0].eject();A--}this.fireEvent("change",{options:this.options,data:this.getData()})}B=null;var B=this.paintRoot.children;if(B&&B.length>0){var A=((B&&B.length>0)?B.length:0);while(B&&B.length>0&&A>0){if(B[0].ignore){B[0].ignore("click",null);B[0].ignore("mousedown",null);B[0].ignore("dblclick",null)}B[0].eject();A--}}if(this.paintevent.paint.leadnode){this.paintevent.paint.leadnode.eject();this.paintevent.paint.leadnode=null}if(this.paintevent.paint.node){this.paintevent.paint.node.eject();this.paintevent.paint.node=null}this.paintevent.paint.id=null},destroy:function(){if(this.editGeometry){this.editGeometry.removeEvents("change")}document.removeEvent("keydown",this.keydownfn);this.clear();this.paintRoot.eject();this.storeRoot.eject();this.root.eject()},_mousePoint:function(C){var B=$(this.container.id).getCoordinates();var A=0,D=0;if(C.client){A=C.client.x-B.left;D=C.client.y-B.top}else{A=C.clientX-B.left;D=C.clientY-B.top}return[A,D]},_paintMouseDown:function(A){A=A||window.event;if(!this.canPaint){return}if(this.paintStatus==0){this.paintStatus=1;this.paintevent.clear();this.eventNode.onmousemove=this._paintMouseMove.bindWithEvent(this);this.eventNode.onclick=this._paintClick.bindWithEvent(this);this.eventNode.ondblclick=this._paintDblclick.bindWithEvent(this)}return false},_paintMouseMove:function(A){A=A||window.event;if(!this.canPaint){return false}if(this.paintStatus==1){var B=this._mousePoint(A);this.paintevent.movepoint=B;this.paintDraw()}return false},_paintClick:function(A){A=A||window.event;if(!this.canPaint){return}if(this.paintStatus==1){var B=this._mousePoint(A);if(this.winTimeout){window.clearTimeout(this.winTimeout);this.winTimeout=null}this.winTimeout=window.setTimeout(function(C){this.paintevent.movepoint=C;this.paintevent.clickpoint(C)}.bind(this,[B]),20)}return false},_paintDblclick:function(A){A=A||window.event;if(!this.canPaint){return false}if(this.paintStatus==1){this.paintStatus=0;if(this.winTimeout){window.clearTimeout(this.winTimeout);this.winTimeout=null;if(this.paintevent.pointlist.length<2){this.paintevent.clear()}else{this.paintDraw()}}this.eventNode.onmousemove=this.eventNode.onclick=this.eventNode.ondblclick=null}return false}})})})();
(function(){MapGIS.extend({MapContentMenu:new Class({Implements:[Events,Options],options:{left:0,top:0,width:300,height:80,zIndex:10,showline:true,contentMenuList:[],baseMenuList:[{title:"放大",fn:function(){this.map.setActiveTool("+")}.bind(this)},{title:"缩小",fn:function(){this.map.setActiveTool("-")}.bind(this)},{title:"拖曳",fn:function(){this.map.setActiveTool("$")}.bind(this)},{title:"还原",fn:function(){this.map.reposition()}.bind(this)}]},div:null,map:null,objList:null,latLng:null,initialize:function(B,A){this.setOptions(A);this.map=B;this.div=new Element("div",{styles:{width:"150px",height:"98px",display:"none",left:0,top:0,position:"absolute",margin:"0px",padding:"0px",zIndex:9999,visibility:"visible"}});this.div.addEvent("mousedown",function(C){C.stopPropagation()});this.div.addEvent("mouseup",function(C){C.stopPropagation()});this.div.addEvent("click",this.hide.bindWithEvent(this));this.draw()},setData:function(A,B){this.options.contentMenuList=A;if(B){this.options.baseMenuList=null;this.options.baseMenuList=[]}this.draw()},draw:function(){this.clear();if((this.options.contentMenuList==null||this.options.contentMenuList.length==0)&&(this.options.baseMenuList==null||this.options.baseMenuList.length==0)){return}var H={listStyle:"none",margin:"0px",marginTop:"4px",marginLeft:"0px",border:"1px solid  #999999",background:"white",padding:"0px",fontSize:"13px"};var B={listStyle:"none",marginTop:"4px",marginLeft:"0px",padding:"0px",textAlign:"center"};var J={listStyle:"none",marginTop:"1px",marginLeft:"0px",padding:"0px",textAlign:"center"};var A={listStyle:"none",marginTop:"0px",marginLeft:"0px",padding:"0px",textAlign:"center",borderCollapse:"collapse",lineHeight:"1px",height:"1px"};var N={listStyle:"none",margin:"2px",lineHeight:"20px",padding:"0px",cursor:"pointer"};var G=new Element("ul",{styles:H});var K=new Element("li");G.appendChild(K);var D=new Element("ul",{styles:B});K.appendChild(D);if(this.objList==null){this.objList=[]}var M=this.options.baseMenuList;for(var F=0,E=M.length;F<E;F++){var I=new Element("li",{styles:N,events:{mouseover:function(){this.style.backgroundColor="#e8ecf9"},mouseout:function(){this.style.backgroundColor="white"}}});I.set("html",M[F].title);if(M[F].fn!=null){I.addEvent("click",M[F].fn.pass({latlng:this.latLng}))}D.appendChild(I);this.objList[this.objList.length]=I}var L=this.options.contentMenuList;if(L.length>0){if(this.options.showline){var C=new Element("li",{styles:A});C.set("html","<hr/>");D.appendChild(C)}for(var F=0,E=L.length;F<E;F++){var I=new Element("li",{styles:N,events:{mouseover:function(){this.style.backgroundColor="#e8ecf9"},mouseout:function(){this.style.backgroundColor="white"}}});I.set("html",L[F].title);if(L[F].fn!=null){I.addEvent("click",L[F].fn.pass({latlng:this.latLng}))}D.appendChild(I);this.objList[this.objList.length]=I}}this.div.appendChild(G)},toggle:function(A){this.draw();this.div.setStyles({left:A.x,top:A.y});this.show()},show:function(){this.div.setStyle("display","block")},hide:function(){this.div.setStyle("display","none")},clear:function(){if(this.objList!=null){for(var B=0,A=this.objList.length;B<A;B++){this.objList[B].removeEvents("click");this.objList[B].removeEvents("mouseover");this.objList[B].removeEvents("mouseout");this.objList[B].destroy();this.objList[B]=null}this.objList=null}this.div.empty()},dispose:function(){this.clear();this.div.removeEvents("click");this.div.removeEvents("mouseup");this.div.removeEvents("mousedown")}})})})();
(function(){MapGIS.extend({MapNavigation:new Class({Implements:[Events,Options],options:{isInitStep:false,slideObj:null,scrollbar:null,left:0,top:0,width:300,height:80,levelFormMap:false,source:MapGIS.path.source,zIndex:10},map:null,div:null,initialize:function(C,B){this.setOptions(B);this.map=C;var A=new Element("div",{styles:{zIndex:this.options.zIndex,backgourndColor:"red"}});A.setStyles({position:"absolute",left:this.options.left,top:this.options.top,width:this.options.width,height:this.options.height});this.div=A;A.addEvent("mousedown",function(D){D.stopPropagation()});this.map.addEvent("zoom",this.mapZoom.bind(this));window.mapnavigationinterval=window.setInterval(function(){if(this.div.getParent()==null){return}else{window.clearInterval(window.mapnavigationinterval);this.init()}}.bind(this),1000)},show:function(){this.div.setStyle("display","block")},hide:function(){this.div.setStyle("display","none")},init:function(){var F=this.map.options.levelMin;var W=this.map.options.levelMax-F;var A=this.map.getLevel()-F;var D=this.map.width/8;var S=(W)*10;var P=this.options.source;this.div.setStyle("width","60px");if(!Browser.Engine.trident){this.div.setStyle("-webkit-user-select","none")}var O=new Element("div",{unselectable:"on",styles:{width:"60px",height:(S+120)+"px",position:"absolute",left:"20px",top:"40px"}});var U=new Element("img",{name:"PngImgs",src:P+"images/tool/mapcontrols.png",styles:{left:"0px",top:"0px",position:"absolute",width:"59px",height:"492px"}});var I=new Element("div",{styles:{width:"60px",height:"60px",position:"absolute",left:"0px",top:"0px",overflow:"hidden"}});var M=new Element("div",{title:"向上平移",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"20px",top:"0px"}});var K=new Element("div",{title:"向左平移",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"0px",top:"20px"}});var G=new Element("div",{title:"还原初始状态",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"20px",top:"20px"}});var L=new Element("div",{title:"向右平移",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"40px",top:"20px"}});var T=new Element("div",{title:"向下平移",styles:{width:"20px",height:"20px",cursor:"pointer",position:"absolute",left:"20px",top:"40px"}});if(Browser.Engine.trident){M.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1});K.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1});G.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1});L.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1});T.setStyles({backgroundColor:"white",filter:"alpha(opacity=0.1)",opacity:0.1})}var B=new Element("div",{styles:{width:"20px",height:(S+44)+"px",position:"absolute",left:"20px",top:"60px",overflow:"hidden"}});var X=new Element("div",{title:"放大["+W+"]",styles:{width:"20px",height:"22px",position:"absolute",left:"0px",top:"0px",overflow:"hidden"}});var V=new Element("div",{title:"缩小",styles:{width:"20px",height:"22px",position:"absolute",left:"0px",top:(S+21)+"px",overflow:"hidden"}});var C=new Element("div",{styles:{width:"20px",height:(S)+"px",position:"absolute",left:"0px",top:"22px",overflow:"hidden"}});var N=new Element("div",{title:"拖动缩放",styles:{width:"20px",height:"10px",overflow:"hidden"}});this.options.scrollbar=N;var J=U.clone();J.setStyles({left:"-19px",top:"-65px"});X.appendChild(J);var E=U.clone();E.setStyles({left:"-19px",top:"-360px"});V.appendChild(E);var H=U.clone();H.setStyles({left:"-19px",top:"-87px"});C.appendChild(H);var Q=U.clone();Q.setStyles({left:"0px",top:"-384px"});N.appendChild(Q);B.appendChild(X);B.appendChild(V);B.appendChild(C);I.appendChild(U);I.appendChild(M);I.appendChild(K);I.appendChild(L);I.appendChild(T);I.appendChild(G);C.appendChild(N);O.appendChild(I);O.appendChild(B);this.div.appendChild(O);MapGIS.correctPNG();O.addEvent("contextmenu",function(){return false});X.addEvent("click",this.setNavSeries.bindWithEvent(this,true));V.addEvent("click",this.setNavSeries.bindWithEvent(this,false));M.addEvent("click",this.setNavDirection.bindWithEvent(this,[0,D]));K.addEvent("click",this.setNavDirection.bindWithEvent(this,[D,0]));L.addEvent("click",this.setNavDirection.bindWithEvent(this,[-D,0]));T.addEvent("click",this.setNavDirection.bindWithEvent(this,[0,-D]));G.addEvent("click",this.setNavDirection.bindWithEvent(this,[0,0]));this.options.slideObj=new Slider(C,N,{steps:W,snap:true,offset:0,mode:"vertical",initialStep:(W-A),onComplete:this.navigationChange.bindWithEvent(this)})},noFristLoad:false,navigationChange:function(C){var B=this.map.options.levelMax;var A=B-C;if(this.noFristLoad){this.map.setLevel(A,!this.options.levelFormMap)}this.noFristLoad=true;this.options.levelFormMap=false;this.options.scrollbar.set("title","拖动缩放["+A+"]")},setNavDirection:function(C,B,A){if(B==0&&A==0){this.map.reposition()}else{if(B>0){this.map.panMove(256,0)}else{if(B<0){this.map.panMove(-256,0)}else{if(A>0){this.map.panMove(0,256)}else{if(A<0){this.map.panMove(0,-256)}}}}}},setNavSeries:function(C,B){if(this.options.slideObj==null){return}if(B){this.map.upLevel();var A=this.map.getLevel();if(A>this.map.options.levelMax){return}else{this.options.isInitStep=true;var D=(this.map.options.levelMax-A);this.options.slideObj.set(D)}}else{this.map.downLevel();var A=this.map.getLevel();if(A<0){return}else{this.options.isInitStep=true;var D=(this.map.options.levelMax-A);this.options.slideObj.set(D)}}},mapZoom:function(A){if(this.options.slideObj!=null){this.options.scrollbar.set("title","拖动缩放["+A.level+"]");this.options.levelFormMap=true;this.options.slideObj.set(this.map.options.levelMax-A.level)}}})})})();
(function(){MapGIS.extend({Map:new Class({Implements:[Events,Options],extent:null,loader:false,options:{level:0,levelMax:9,levelMin:0,size:[0,0],zIndex:1,xmin:null,ymin:null,xmax:null,ymax:null,activeTool:"$",contentMenu:{visible:true,obj:null},navigation:{show:true,obj:null},queryHandler:null,center:null},container:null,root:null,toolsdiv:null,layersdiv:null,defaultPos:[0,0],bgPos:[0,0],speed:[0,0],isBacking:false,isDragging:false,mousePosLast:[0,0],mousePosNow:[0,0],mouseSpeed:[0,0],smooth:[[0,0],[0,0],[0,0],[0,0]],handles:{timeout:null,interval:null},checkLoadTimer:null,layers:[],baseLayer:null,model:null,width:0,height:0,fxtype:0,setModel:function(A){this.model=A;var C=this.options.level;if(this.options.xmin!=null){var B=[this.options.xmin,this.options.ymin,this.options.xmax,this.options.ymax];this.model.setOptions({fullExtent:B})}this.model.setOptions({canOver:false,size:this.options.size,level:C,preLevel:C,minLevel:this.options.levelMin,maxLevel:this.options.levelMax});this.model.setRestore()},setReposition:function(){this.model.setRestore()},initialize:function(A,C,B){this.container=((typeof(A)==="object")?A:$(A));this.setOptions(C);this.initMap();if(this.options.center!=null){var D=this.options.center;this.options.xmin=D[0]-1;this.options.xmax=D[0]+1;this.options.ymin=D[1]-1;this.options.ymax=D[1]+1}this.setModel(B==null?new MapGIS.Model():B);if(window.map_opinterval!=null){window.clearInterval(window.map_opinterval);window.map_opinterval=null}this.loader=true;window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10);this.checkLoadTimer=this.checkLoadMap.periodical(1000,this)},checkLoadMap:function(){if(this.loader){this.fireEvent("load",true);if(this.checkLoadTimer){$clear(this.checkLoadTimer)}}},addLayer:function(A){this.layers.push(A);A.loadLayer(this.model);this.layersdiv.appendChild(A.div);if(!A.div.hasClass("layerContainer")){A.div.addClass("layerContainer")}},addLayers:function(C){if(C!=null&&C.length>0){for(var B=0,A=C.length;B<A;B++){this.addLayer(C[B])}}},addTools:function(A){this.toolsdiv.appendChild(A)},dragingLayer:function(){var C=this.layers;if(C!=null){for(var B=0,A=C.length;B<A;B++){C[B].dragingLayer(this.model)}}},layerEventByMouseOver:function(C){var D=this.layers;var E=this.getPos(C);this.model.setMousePos(E);if(D!=null){for(var B=0,A=D.length;B<A;B++){D[B].eventByMouseOver(C,this.model)}}},layerEventByClick:function(C){var D=this.layers;var E=this.getPos(C);this.model.setMousePos(E);if(D!=null){for(var B=0,A=D.length;B<A;B++){D[B].eventByClick(C,this.model)}}},layerEventByDblclick:function(C){var D=this.layers;var E=this.getPos(C);this.model.setMousePos(E);if(D!=null){for(var B=0,A=D.length;B<A;B++){D[B].eventByDblclick(C,this.model)}}},FireExtentchangeEvent:function(){var B=this.model.getLevel();var A=this.model.getExtent();var C=this.model.getCenterPoint();this.fireEvent("extentchange",{level:B,point:C,extent:A})},moveno:2,lastpos:[0,0],setPos:function(){var B=this.bgPos[0];var A=this.bgPos[1];var C=this.speed;if(C[0]==0&&C[1]==0){if(this.moveno>0||this.isDragging){return}else{this.moveno++;this.model.setPos([B.toInt(),A.toInt()]);this.model.setSpeed([C[0],C[1]]);this.layersdiv.setStyles({left:B,top:A});this.model.setRunStatus(false);this.dragingLayer();this.FireExtentchangeEvent()}}else{this.moveno=0;this.model.setPos([B.toInt(),A.toInt()]);this.model.setSpeed([C[0],C[1]]);this.layersdiv.setStyles({left:B,top:A});this.model.setRunStatus(true);this.dragingLayer();this.lastpos=[B,A]}},getPos:function(C){var B=this.container.getScroll();var E=this.root.getPosition();var A=C.page.x-E.x;var D=C.page.y-E.y;return[A,D]},dragAndDragFn:function(){if(this.isBacking){var D=this.bgPos;var H=this.defaultPos;if(Math.abs(D[0]-H[0])<5&&Math.abs(D[1]-H[1])<5){this.isBacking=false;this.speed[0]=0;this.speed[1]=0;this.FXFn(H);return}var I=this.speed;I[0]=(H[0]-D[0])*0.0485;I[1]=(H[1]-D[1])*0.0485;this.bgPos[0]+=I[0];this.bgPos[1]+=I[1];this.setPos();return}if(this.isDragging){var A=this.mousePosNow;var G=this.mousePosLast;var B=[A[0]-G[0],A[1]-G[1]];this.smooth.push(B);this.smooth.shift();var C=[0,0];var I=this.smooth;var E=I.length;for(var F=0;F<E;F++){C[0]+=I[F][0];C[1]+=I[F][1]}C[0]=C[0]/E;C[1]=C[1]/E;this.speed[0]=C[0]*1;this.speed[1]=C[1]*1;this.bgPos[0]+=this.speed[0];this.bgPos[1]+=this.speed[1];this.setPos();this.mousePosLast[0]=A[0];this.mousePosLast[1]=A[1];return}var I=this.speed;if(Math.abs(I[0])<0.004){this.speed[0]=0}if(Math.abs(I[1])<0.004){this.speed[1]=0}this.speed[0]=I[0]*0.97;this.speed[1]=I[1]*0.97;this.bgPos[0]+=this.speed[0];this.bgPos[1]+=this.speed[1];this.setPos()},initMap:function(){var H=this.options;this.container.setStyles({position:"absolute",zIndex:H.zIndex});var B=H.size[0];var E=H.size[1];if(B==0||E==0){var C=this.container.getSize();var F=Element.getComputedStyle(this.container,"border-left-width").toInt()||0;var A=Element.getComputedStyle(this.container,"border-right-width").toInt()||0;var G=Element.getComputedStyle(this.container,"border-top-width").toInt()||0;var D=Element.getComputedStyle(this.container,"border-bottom-width").toInt()||0;B=C.x-F-A;E=C.y-G-D;this.options.size=[B,E]}this.width=B;this.height=E;this.root=new Element("div",{unselectable:"on",styles:{width:B,height:E,left:0,top:0,position:"absolute",margin:"0px",padding:"0px",zIndex:3,visibility:"visible",overflow:"hidden",border:"0px solid blue"}});this.root.inject(this.container);this.toolsdiv=new Element("div",{unselectable:"on",styles:{left:0,top:0,position:"absolute",margin:"0px",padding:"0px",zIndex:2,visibility:"visible",border:"0px"}});this.toolsdiv.inject(this.root);this.container.addEvent("contextmenu",function(){return false});this.layersdiv=new Element("div",{unselectable:"on",styles:{left:0,top:0,position:"absolute",margin:"0px",padding:"0px",zIndex:1,visibility:"visible",border:"0px"}});this.layersdiv.inject(this.root);this.root.addEvent("mousedown",this.mouseDownEvent.bindWithEvent(this));this.root.addEvent("mousemove",this.mouseMoveEvent.bindWithEvent(this));this.root.addEvent("mouseup",this.mouseUpEvent.bindWithEvent(this));this.root.addEvent("mouseleave",this.mouseLeaveEvent.bindWithEvent(this));this.root.addEvent("mousewheel",this.mapEventWheel.bindWithEvent(this));this.root.addEvent("dblclick",this.mouseEventDblclick.bindWithEvent(this));this.root.addEvent("click",this.mouseEventClick.bindWithEvent(this));this.root.addEvent("touchend",this.touchendEvent.bindWithEvent(this));this.root.addEvent("touchmove",this.touchmoveEvent.bindWithEvent(this));this.root.addEvent("touchstart",this.touchstartEvent.bindWithEvent(this));this.root.addEvent("gesturechange",this.ongesturechangeEvent.bindWithEvent(this));this.root.addEvent("gestureend",this.ongestureendEvent.bindWithEvent(this));if(this.options.contentMenu.obj==null){this.options.contentMenu.obj=new MapGIS.MapContentMenu(this);this.options.contentMenu.obj.div.inject(this.toolsdiv)}if(this.options.navigation.obj==null){this.options.navigation.obj=new MapGIS.MapNavigation(this);this.options.navigation.obj.div.inject(this.toolsdiv);this.options.navigation.show?this.options.navigation.obj.show():this.options.navigation.obj.hide()}},resize:function(){var C=this.container.getSize();var F=Element.getComputedStyle(this.container,"border-left-width").toInt()||0;var A=Element.getComputedStyle(this.container,"border-right-width").toInt()||0;var G=Element.getComputedStyle(this.container,"border-top-width").toInt()||0;var E=Element.getComputedStyle(this.container,"border-bottom-width").toInt()||0;var B=C.x-F-A;var D=C.y-G-E;this.options.size=[B,D];this.model.setViewSize([B,D]);this.width=B;this.height=D;this.root.setStyles({width:B,height:D})},zoomEffect:function(I,C){window.clearInterval(window.zoomflashtimeout);var J=this.model.getViewSize();this.geometryObj.init(this.toolsdiv,J);var B=this;var H=I[0];var G=I[1];var A=(C==1?15:26);var E=5,D=7;function F(U,Q,K,N,M,L){var T={x:U-K,y:Q-K};var R={x:U+K,y:Q-K};var P={x:U-K,y:Q+K};var O={x:U+K,y:Q+K};var X=[],W=[],V=[],S=[];if(L){X=[[T.x,(T.y+N)],[T.x,T.y],[(T.x+M),T.y]];W=[[(R.x-M),R.y],[R.x,R.y],[R.x,(R.y+N)]];V=[[P.x,(P.y-N)],[P.x,P.y],[(P.x+M),P.y]];S=[[(O.x-M),O.y],[O.x,O.y],[O.x,(O.y-N)]]}else{X=[[(T.x-N),T.y],[T.x,T.y],[T.x,(T.y-M)]];W=[[(R.x+N),R.y],[R.x,R.y],[R.x,(R.y-M)]];V=[[P.x,(P.y+M)],[P.x,P.y],[(P.x-N),P.y]];S=[[(O.x+N),O.y],[O.x,O.y],[O.x,(O.y+M)]]}B.geometryObj.obj.drawLineString(B.geometryObj.node0,X,false,{stroke:{color:"#ff0000",width:2}});B.geometryObj.obj.drawLineString(B.geometryObj.node1,W,false,{stroke:{color:"#ff0000",width:2}});B.geometryObj.obj.drawLineString(B.geometryObj.node2,V,false,{stroke:{color:"#ff0000",width:2}});B.geometryObj.obj.drawLineString(B.geometryObj.node3,S,false,{stroke:{color:"#ff0000",width:2}})}window.zoomflashtimeout=window.setInterval(function(){if(A<31&&C==1){F(H,G,A,E,D,C);A+=15}else{if(A>0&&C==0){F(H,G,A,E,D,C);A-=15}else{window.clearInterval(window.zoomflashtimeout);B.geometryObj.clear()}}},220)},geometryObj:{obj:null,node:null,node0:null,node1:null,node2:null,node3:null,node4:null,node5:null,clear:function(){this.node0.draw("M0,0");this.node1.draw("M0,0");this.node2.draw("M0,0");this.node3.draw("M0,0");this.node4.draw("M0,0");this.node5.draw("M0,0");this.node.draw("M0,0");this.obj.root.resize(1,1)},init:function(B,A){if(this.obj==null){this.obj=new MapGIS.Geometry(B,{width:A[0],height:A[1]})}this.obj.root.resize(A[0],A[1]);if(this.node==null){this.node=this.obj.nodeFactory("shape");this.node.inject(this.obj.root)}if(this.node0==null){this.node0=this.obj.nodeFactory("shape");this.node0.inject(this.obj.root)}if(this.node1==null){this.node1=this.obj.nodeFactory("shape");this.node1.inject(this.obj.root)}if(this.node2==null){this.node2=this.obj.nodeFactory("shape");this.node2.inject(this.obj.root)}if(this.node3==null){this.node3=this.obj.nodeFactory("shape");this.node3.inject(this.obj.root)}if(this.node4==null){this.node4=this.obj.nodeFactory("shape");this.node4.inject(this.obj.root)}if(this.node5==null){this.node5=this.obj.nodeFactory("shape");this.node5.inject(this.obj.root)}}},referenceLine:function(F){var B=F.options.size;var A=B[0];var D=B[1];var C=new Element("div",{unselectable:"on",styles:{position:"absolute",left:0,top:D/2,zIndex:999,borderTop:"1px solid blue",width:A,height:1}});var E=new Element("div",{unselectable:"on",styles:{position:"absolute",left:A/2,top:0,zIndex:999,borderLeft:"1px solid blue",width:1,height:D}});C.inject(this.root);E.inject(this.root)},zoomLayer:function(){if(window.map_opinterval!=null){window.clearInterval(window.map_opinterval);window.map_opinterval=null}var G=this.layers;if(G!=null){for(var D=0,C=G.length;D<C;D++){G[D].zoomLayer(this.model)}}var F=this.model.getWheelPos();var B={x:F[0],y:F[1]};var E=this.getExtent();var A={event:window.event,level:this.getLevel(),point:B,extent:E};this.fireEvent("zoom",A);this.fireEvent("mousewheel",A);this.fireEvent("zoomend",A);this.FireExtentchangeEvent()},wheelTimer_:null,mapEventWheel:function(D){if(this.loader!==true){return false}if(this.wheelTimer_===null){this.wheelTimer_=window.setTimeout(function(){window.clearTimeout(this.wheelTimer_);$clear(this.wheelTimer_);this.wheelTimer_=null}.bind(this),450)}else{return false}D=D||window.event;var C=D.wheel||0;var A=D.wheelDelta||0;var G=D.detail||0;d=C?C:(!A?(!G?0:-G):A);var F=(d>0?true:false);var B=this.model.setZoom(F);if(B){var E=this.getPos(D);this.zoomEffect(E,F);this.model.setWheelPos(E[0],E[1]);this.zoomLayer()}},mouseEvent:{eventtype:0,startpoint:[0,0],endpoint:[0,0],getPointList:function(){return[this.startpoint,this.endpoint]},getdx:function(){return this.endpoint[0]-this.startpoint[0]},getdy:function(){return this.endpoint[1]-this.startpoint[1]},getCenter:function(){return[(this.endpoint[0]+this.startpoint[0])/2,(this.endpoint[1]+this.startpoint[1])/2]}},mouseDownEvent:function(B){B=B||window.event;B.stop();var C=this.getPos(B);this.mouseEvent.startpoint=C;if(this.loader){switch(this.mouseEvent.eventtype){case 0:if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}this.isDragging=true;this.mousePosLast[0]=this.mousePosNow[0];this.mousePosLast[1]=this.mousePosNow[1];this.speed=[0,0];var E=[0,0];this.smooth=[E,E,E,E];this.mouseEvent.eventtype=1;break;case 2:var D=this.model;var A=D.getViewSize();this.geometryObj.init(this.toolsdiv,A);this.mouseEvent.eventtype=3;this.mouseEvent.endpoint=C;this.geometryObj.obj.drawRectangle(this.geometryObj.node,this.mouseEvent.getPointList());break;case 4:var D=this.model;var A=D.getViewSize();this.geometryObj.init(this.toolsdiv,A);this.mouseEvent.eventtype=5;this.mouseEvent.endpoint=C;this.geometryObj.obj.drawRectangle(this.geometryObj.node,this.mouseEvent.getPointList());break;default:break}if(this.options.contentMenu.obj!=null&&this.options.contentMenu.visible){this.options.contentMenu.obj.hide()}}this.fireEvent("mousedown",{event:B});B.stopPropagation()},mouseMoveEvent:function(A){A=A||window.event;A.stop();this.mousePosNow[0]=A.client.x;this.mousePosNow[1]=A.client.y;var B=this.getPos(A);var C=this.mouseEvent.endpoint;if(Math.abs(B[0]-C[0])<1&&Math.abs(B[1]-C[1])<1){return}this.mouseEvent.endpoint=B;if(this.loader){switch(this.mouseEvent.eventtype){case 1:this.root.setStyle("cursor","move");break;case 3:case 5:this.geometryObj.obj.drawRectangle(this.geometryObj.node,this.mouseEvent.getPointList());break;default:break}}this.layerEventByMouseOver(A);this.fireEvent("mousemove",{event:A});A.stopPropagation()},mouseUpEvent:function(B){B=B||window.event;B.stop();if(this.loader){switch(this.mouseEvent.eventtype){case 1:this.root.setStyle("cursor","");this.isDragging=false;this.mouseEvent.eventtype=0;break;case 3:if(this.mouseEvent.getdx()>5||this.mouseEvent.getdy()>5){var F=this.model.setZoom((this.options.activeTool=="+")?true:false);if(F){var C=this.mouseEvent.getCenter();this.model.setWheelPos(C[0],C[1]);this.zoomLayer()}}this.geometryObj.clear();this.mouseEvent.eventtype=2;break;case 5:if(this.mouseEvent.getdx()>5||this.mouseEvent.getdy()>5){var I=this.mouseEvent.startpoint;var E=this.mouseEvent.endpoint;var N=this.model.toMap(I[0],I[1]);var L=this.model.toMap(E[0],E[1]);var A=Math.min(N[0],L[0]);var H=Math.max(N[0],L[0]);var K=Math.min(N[1],L[1]);var D=Math.max(N[1],L[1]);var G={event:B,min:[A,K],max:[H,D]};if(this.options.queryHandler!=null){this.options.queryHandler(G)}this.fireEvent("areaselect",G)}this.geometryObj.clear();this.mouseEvent.eventtype=4;break;default:this.root.setStyle("cursor","");this.isDragging=false;break}if(this.mouseEvent.getdx()<5&&this.mouseEvent.getdy()<5){if(((B.event.which)&&(B.event.which==3))||((B.event.button)&&(B.event.button==2))){if(this.options.contentMenu.obj!=null&&this.options.contentMenu.visible){var C=this.getPos(B);var J={x:C[0],y:C[1]};var M=this.model.toMap(C[0],C[1]);this.options.contentMenu.obj.latLng={x:M[0],y:M[1]};this.options.contentMenu.obj.toggle(J)}}this.fireEvent("mouseup",{event:B})}}this.fireEvent("mouseup",{event:B});B.stopPropagation()},mouseLeaveEvent:function(B){B=B||window.event;B.stop();if(this.loader){switch(this.mouseEvent.eventtype){case 1:this.root.setStyle("cursor","");this.isDragging=false;this.mouseEvent.eventtype=0;break;case 3:var A=this.model.setZoom((this.options.activeTool=="+")?true:false);if(A){var C=this.mouseEvent.getCenter();this.model.setWheelPos(C[0],C[1]);this.zoomLayer()}this.geometryObj.clear();this.mouseEvent.eventtype=2;break;default:this.root.setStyle("cursor","");this.isDragging=false;break}}},touchmoveEvent:function(B){var D=B.touches[0];B.preventDefault();var A=D.pageX;var C=D.pageY;this.mousePosNow[0]=A;this.mousePosNow[1]=C},touchPos:[],touchstartEvent:function(D){D.preventDefault();if(this.loader){if(D.touches.length<2){if(this.mouseEvent.eventtype==0){if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}this.isDragging=true;var G=D.touches[0];var A=G.pageX;var F=G.pageY;this.mousePosNow[0]=A;this.mousePosNow[1]=F;this.mousePosLast[0]=this.mousePosNow[0];this.mousePosLast[1]=this.mousePosNow[1];this.speed=[0,0];var E=[0,0];this.smooth=[E,E,E,E];this.mouseEvent.eventtype=1}}else{if(D.touches.length>1){if(this.mouseEvent.eventtype==1){this.isDragging=false;this.mouseEvent.eventtype=0}this.touchPos=[];for(var C=0,B=D.touches.length;C<B;C++){this.touchPos.push([D.touches[C].pageX,D.touches[C].pageY])}}}}},touchendEvent:function(A){A.preventDefault();if(this.loader){if(this.mouseEvent.eventtype==1){this.isDragging=false;this.mouseEvent.eventtype=0}}},ongestureendEvent:function(A){A.preventDefault();if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}},ongesturechangeEvent:function(D){D.preventDefault();if(this.loader!=true){return false}if(this.wheelTimer_==null){this.wheelTimer_=window.setTimeout(function(){window.clearTimeout(this.wheelTimer_);$clear(this.wheelTimer_);this.wheelTimer_=null}.bind(this),450)}else{return false}var F=(D.scale>1?true:false);if(this.touchPos.length>1){var A=this.model.setZoom(F);if(A){var E=this.touchPos;var B=(E[0][0]+E[1][0])/2;var C=(E[0][1]+E[1][1])/2;this.model.setWheelPos(B,C);this.zoomLayer()}}},mouseEventDblclick:function(B){B=B||window.event;if(window.TIMERCLICK_){clearTimeout(window.TIMERCLICK_)}if(this.mouseEvent.getdx()==0||this.mouseEvent.getdy()==0){var C=this.getPos(B);var A=this.model.toMap(C[0],C[1]);this.fireEvent("dblclick",[B,{x:A[0],y:A[1]}]);this.layerEventByDblclick(B)}B.stopPropagation()},mouseEventClick:function(B){B=B||window.event;if(this.mouseEvent.getdx()==0||this.mouseEvent.getdy()==0){var C=this.getPos(B);var A=this.model.toMap(C[0],C[1]);if(window.TIMERCLICK_){clearTimeout(window.TIMERCLICK_)}window.TIMERCLICK_=setTimeout(this.FireMapClickEvent.bind({classObj:this,arg:[B,{x:A[0],y:A[1]}]}),220)}B.stopPropagation()},FireMapClickEvent:function(){this.classObj.fireEvent("click",this.arg);this.classObj.layerEventByClick(this.arg[0])},stopEvent:function(){this.root.removeEvents("mousewheel");this.root.removeEvents("mousedown");this.root.removeEvents("mousemove");this.root.removeEvents("mouseup");this.root.removeEvents("mouseleave");this.root.removeEvents("dblclick");this.root.removeEvents("click")},startEvent:function(){this.stopEvent();this.root.addEvent("mousedown",this.mouseDownEvent.bindWithEvent(this));this.root.addEvent("mousemove",this.mouseMoveEvent.bindWithEvent(this));this.root.addEvent("mouseup",this.mouseUpEvent.bindWithEvent(this));this.root.addEvent("mouseleave",this.mouseLeaveEvent.bindWithEvent(this));this.root.addEvent("mousewheel",this.mapEventWheel.bindWithEvent(this));this.root.addEvent("dblclick",this.mouseEventDblclick.bindWithEvent(this));this.root.addEvent("click",this.mouseEventClick.bindWithEvent(this))},refresh:function(){var C=this.layers;if(C!=null){for(var B=0,A=C.length;B<A;B++){C[B].refresh(this.model)}}},getCurrentExtent:function(){var D=this.model;var C=D.toMap(0,0);var A=D.getViewSize();var B=D.toMap(A[0],A[1]);return{xmin:C[0],ymin:B[1],xmax:B[0],ymax:C[1]}},setActiveTool:function(A){this.options.activeTool=A;if(this.options.activeTool=="$"){this.mouseEvent.eventtype=0}else{if(this.options.activeTool=="+"||this.options.activeTool=="-"){this.mouseEvent.eventtype=2}else{if(this.options.activeTool=="*"){this.mouseEvent.eventtype=4}}}},reposition:function(){this.model.restore();this.layersdiv.setStyles({left:0,top:0});this.mousePosLast=[0,0];this.mousePosNow=[0,0];this.bgPos=[0,0];this.zoomLayer()},getLevel:function(){return this.model.getLevel()},getExtent:function(){return this.model.getExtent()},getResolution:function(){return this.model.getRes()},setLevel:function(F,C){this.model.setLevel(F);if(C){this.zoomLayer()}else{var E=this.model.getWheelPos();var B={x:E[0],y:E[1]};var D=this.getExtent();var A={event:window.event,level:this.getLevel(),point:B,extent:D};this.fireEvent("zoom",A);this.fireEvent("mousewheel",A);this.fireEvent("zoomend",A)}},upLevel:function(){var A=this.model.setZoom(true);if(A){var B=this.model.getCenterPos();this.model.setWheelPos(B[0],B[1]);this.zoomLayer()}},downLevel:function(){var A=this.model.setZoom(false);if(A){var B=this.model.getCenterPos();this.model.setWheelPos(B[0],B[1]);this.zoomLayer()}},setCenter:function(M,A){var J=0,I=0;if(M==null){return}else{var H=$type(M);if(H=="object"){J=M.x.toFloat();I=M.y.toFloat()}else{J=M[0].toFloat();I=M[1].toFloat()}if(isNaN(J)||isNaN(I)){return}}if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}if(A!=null){this.setLevel(A)}var K=this.model.getViewSize();var L=this.model.toScreen(J,I);var F=L[0]-K[0]/2;var E=L[1]-K[1]/2;var D=this.model.getPos();var R=D[0]-F;var C=D[1]-E;this.defaultPos=[R,C];var B=this.bgPos;var G=this.width;var P=this.height;var O=this.bgPos[0];var N=this.bgPos[1];if(Math.abs(B[0]-R)>G){var Q=(B[0]-R)>0?1:-1;O=R+Q*G}if(Math.abs(B[1]-C)>P){var Q=(B[1]-C)>0?1:-1;N=C+Q*P}this.bgPos=[O,N];this.isBacking=true;this.fxtype=1;this.locatePos=[J,I]},getCenter:function(){var A=this.model.getCenterPoint();return{x:A[0],y:A[1]}},panMove:function(A,C){if(window.map_opinterval==null){window.map_opinterval=setInterval(this.dragAndDragFn.bind(this),10)}var B=this.model.getPos();this.defaultPos=[B[0]+A,B[1]+C];this.isBacking=true},locatePos:[0,0],FXFn:function(B){if(this.fxtype==1){var E=this.model;var A=E.getViewSize();var D=this.locatePos;var C=E.toScreen(D[0],D[1]);this.zoomEffect2(C,0)}this.fxtype=0},zoomEffect2:function(I,C){window.clearInterval(window.zoomflashtimeout);var J=this.model.getViewSize();this.geometryObj.init(this.toolsdiv,J);var B=this;var H=I[0];var G=I[1];var A=(C==1?15:56);var E=5,D=7;function F(V,R,K,O,N,M){var U={x:V-K,y:R-K};var S={x:V+K,y:R-K};var Q={x:V-K,y:R+K};var P={x:V+K,y:R+K};var Z=[],X=[],W=[],T=[];if(!M){Z=[[U.x,(U.y+O)],[U.x,U.y],[(U.x+N),U.y]];X=[[(S.x-N),S.y],[S.x,S.y],[S.x,(S.y+O)]];W=[[Q.x,(Q.y-O)],[Q.x,Q.y],[(Q.x+N),Q.y]];T=[[(P.x-N),P.y],[P.x,P.y],[P.x,(P.y-O)]]}else{Z=[[(U.x-O),U.y],[U.x,U.y],[U.x,(U.y-N)]];X=[[(S.x+O),S.y],[S.x,S.y],[S.x,(S.y-N)]];W=[[Q.x,(Q.y+N)],[Q.x,Q.y],[(Q.x-O),Q.y]];T=[[(P.x+O),P.y],[P.x,P.y],[P.x,(P.y+N)]]}var L=2*K;var a=[[V,R-L],[V,R+L]];var Y=[[V-L,R],[V+L,R]];B.geometryObj.obj.drawLineString(B.geometryObj.node4,a,false,{stroke:{color:"#511E03",width:2}});B.geometryObj.obj.drawLineString(B.geometryObj.node5,Y,false,{stroke:{color:"#511E03",width:2}});B.geometryObj.obj.drawLineString(B.geometryObj.node0,Z,false,{stroke:{color:"#62211E",width:2}});B.geometryObj.obj.drawLineString(B.geometryObj.node1,X,false,{stroke:{color:"#62211E",width:2}});B.geometryObj.obj.drawLineString(B.geometryObj.node2,W,false,{stroke:{color:"#62211E",width:2}});B.geometryObj.obj.drawLineString(B.geometryObj.node3,T,false,{stroke:{color:"#62211E",width:2}})}window.zoomflashtimeout=window.setInterval(function(){if(A<31&&C==1){F(H,G,A,E,D,C);A+=15}else{if(A>0&&C==0){F(H,G,A,E,D,C);A-=15}else{window.clearInterval(window.zoomflashtimeout);B.geometryObj.clear()}}},220)}})})})();
(function(){MapGIS.extend({Layers:new Hash({BaseLayer:new Class({Implements:[Events,Options],div:null,isIe6:false,source:MapGIS.path.source,divLatLng:[0,0],id:null,options:{id:MapGIS.createUniqueID("layer"),allowRefresh:false,zIndex:1,startShowLevel:0},mapoptions:null,visible:true,isvisible:true,initialize:function(A){this.isIe6=Browser.Engine.trident4;this.setOptions(A);this.id=this.options.id;this.initDiv();this.initLayer()},initDiv:function(){this.div=new Element("div",{unselectable:"on",styles:{position:"absolute",left:0,top:0,zIndex:this.options.zIndex}});this.div.setStyle("-webkit-user-select","none")},dragingLayer:function(D,A){this.mapoptions=D;var C=D.getLevel();var B=this.options.startShowLevel;if(C<B){return false}return this.visible},zoomLayer:function(C){this.mapoptions=C;var B=C.getLevel();var A=this.options.startShowLevel;if(B<A){return false}return this.visible},reloadLayer:function(A){},initLayer:function(){},loadLayer:function(C){this.mapoptions=C;var B=C.getLevel();var A=this.options.startShowLevel;if(B<A){return false}this.dragingLayer(C,true);return this.visible},eventByMouseOver:function(A,B){},eventByClick:function(A,B){},eventByDblclick:function(A){},clear:function(){this.div.empty()},destory:function(){this.clear()},refresh:function(){if(!this.options.allowRefresh){return false}return true},show:function(){this.visible=true;this.div.setStyle("display","block");this.reloadLayer(this.mapoptions)},hide:function(){this.visible=false;this.div.setStyle("display","none")},isContinue:function(){if(this.mapoptions==null){return false}var B=this.mapoptions.getLevel();var A=this.options.startShowLevel;if(B<A){return false}return(this.visible&&this.isvisible)},setVisibility:function(A){this.isvisible=A}})})})})();
(function(){MapGIS.Layers.extend({TileLayer:new Class({Extends:MapGIS.Layers.BaseLayer,Implements:[Events,Options],options:{initialExtent:null,startShowLevel:0,level:0,tileSize:256,url:null},initLayer:function(){this.zoomObj.div=this.div},posLast:[0,0,0,0,0,0],Point0:{cell:0,row:0,left:0,top:0},isFullDraw:true,dragingLayer:function(A){if(this.parent(A)){this.drawTile(A)}else{this.div.empty()}},reloadLayer:function(A){this.reloadTile()},getTileNo:function(B,D){var H=this.options.tileSize;var G=this.mapoptions.options.origin;var F=D[0];var E=D[1];var J=Math.floor((F-G.x)/B.x/H);var I=Math.floor((G.y-E)/B.y/H);var A=-(F-G.x)/B.x+H*J;var C=-(G.y-E)/B.y+H*I;return{cell:J,row:I,left:A,top:C}},getTagName:function(B){var A=this.options.id+"_";return A+"z_"+B},drawTile:function(H){if(!H.isMoving()){return}var F=H.getTiles();if(!H.hasNewTile(this.id)){return}var N=this.options.id+"_";var K=H.getLevel();var L=this.options.url;var B=this.getTagName(K);var M=H.getTileSize();var J=F.newtiles;for(var E=0,C=J.length;E<C;E++){var I=J[E];var A=N+I.id;this.loadImage(L,K,I.c,I.r,I.l,I.t,M,B,A,false)}var G=F.deltiles;this.zoomObj.clear();for(var E=0,C=G.length;E<C;E++){var I=G[E];var D=this.div.getElementById(N+I.id);if(D){D.destroy()}}},redrawTile:function(H){var F=H.getTiles();var N=this.options.id+"_";var K=H.getLevel();var L=this.options.url;var B=this.getTagName(K);var M=H.getTileSize();var J=F.alltiles;for(var E=0,C=J.length;E<C;E++){var I=J[E];var A=N+I.id;this.loadImage(L,K,I.c,I.r,I.l,I.t,M,B,A,false)}var G=F.deltiles;this.zoomObj.clear();for(var E=0,C=G.length;E<C;E++){var I=G[E];var D=this.div.getElementById(N+I.id);if(D){D.destroy()}}},zoomLayer:function(E){if(this.parent(E)){this.zoomImgsToLayer(E);var A=E.getPreLevel();var D=E.getLevel();var C=this.getTagName(A);this.zoomObj.clclass=this.getTagName(D);if(this.loadZoomImgsHandle!=null){window.clearTimeout(this.loadZoomImgsHandle)}if(this.clearImgsHandle!=null){window.clearInterval(this.clearImgsHandle)}this.loadZoomImgsHandle=window.setTimeout(function(){this.reloadTile();this.clearImgsHandle=window.setInterval(this.loadedImgsEvent.bind(this),10,this.getTagName(D))}.bind(this),200);if(C!=this.zoomObj.imgclass){var B=this.div.getElements("img."+C);if(B.length>0){B.each(function(F){F.destroy()})}}}else{this.div.empty()}},clearImgsHandle:null,loadZoomImgsHandle:null,loadImage:function(H,G,J,L,C,I,K,M,B,F){var E={z:G,y:J,x:L};var A=H.substitute(E);var D=this.div.getElementById(B);if(D){D.src=A}else{D=new Element("img",{src:A,id:B,"class":M,loaded:"false",styles:{position:"absolute",left:C,top:I,width:K,height:K,border:"0px",margin:"0px",padding:"0px","z-index":2}});D.inject(this.div);D.onload=function(){this.set("loaded","true")}}},loadedImgsEvent:function(D){var E=this.div.getElements("img."+D);var C=true;if(E.length>0){for(var B=0,A=E.length;B<A;B++){if(E[B].get("loaded")!="true"){C=false;break}}}if(C){this.zoomObj.clear();window.clearInterval(this.clearImgsHandle)}return C},zoomObj:{imgclass:null,clclass:null,res:null,imgSize:null,div:null,clear:function(){if(this.clclass!=this.imgclass){var A=this.div.getElements("img."+this.imgclass);if(A.length>0){A.each(function(B){B.destroy()})}this.imgclass=null;this.res=null;this.imgSize=null}}},effects:[],zoomImgsToLayer:function(H){if(this.effects!=null&&this.effects.length>0){var G=this.effects;for(var F=0,E=G.length;F<E;F++){G[F].cancel()}this.effects=[]}var I=H.getPreLevel();if(this.zoomObj.imgclass==null){var D=this.getTagName(I);this.zoomObj.imgclass=D}if(this.zoomObj.res==null){this.zoomObj.res=H.resolution(I)}if(this.zoomObj.imgSize==null){this.zoomObj.imgSize=H.getTileSize()}var K=this.div.getElements("img."+this.zoomObj.imgclass);var J=H.getPos();var L=H.getWheelPos();var O=[-J[0]+L[0],-J[1]+L[1]];var C=H.getRes();var B=this.zoomObj.res;var M=this.zoomObj.imgSize;var A=B.x/C.x;var N=M*B.x/C.x;if(K!=null&&K.length>0){K.each(function(R){var V=R.getStyle("left").toInt();var U=R.getStyle("top").toInt();var Q=R.getStyle("width").toInt();var T=R.getStyle("height").toInt();var P=(O[0]-(O[0]-V)*A);var S=(O[1]-(O[1]-U)*A);R.setStyles({left:P,top:S,width:N,height:N,"z-index":1})}.bind(this))}else{}this.zoomObj.imgSize=N;this.zoomObj.res=C},reloadTile:function(){var E=this.mapoptions;var K=this.options.id+"_";var G=E.getLevel();var I=E.getTiles().alltiles;var B=this.getTagName(G);var J=E.getTileSize();var H=this.options.url;var G=E.getLevel();for(var D=0,C=I.length;D<C;D++){var F=I[D];var A=K+F.id;this.loadImage(H,G,F.c,F.r,F.l,F.t,J,B,A,true)}},refresh:function(){var D=this.parent();if(D){var B=this.options.url;var A=new Date().getTime();var C=B.match(/\?[^\?]*/);if(C!=null){if(C!="?"){if(B.match(/(DT=T)\d{13}(T)/g)!=null){B=B.replace(/(DT=T)\d{13}(T)/g,"DT=T"+A+"T")}else{B=B+"&DT=T"+A+"T"}}else{B=B+"DT=T"+A+"T"}}else{B=B+"?DT=T"+A+"T"}this.options.url=B;this.reloadTile()}}})})})();
(function(){MapGIS.Layers.extend({MapImageLayer:new Class({Extends:MapGIS.Layers.BaseLayer,Implements:[Events,Options],options:{isLigature:false,rebuildPoint:true,combosWindow:true,paletteObj:null,mapLayer:null,tabWindow:null,imgDeflectX:10,imgDeflectY:34,imgWidth:20,imgHeight:34,imgClass:"marker",strokecolor:"#0c68c5",strokeweight:2,imgSrc:"",visibleWindow:false,defaultMarker:null,pointClickFn:null,simpleDisplay:false,graphicsData:[]},geometry:null,lineRoot:null,graphicsRoot:null,geomDIV:null,pointList:[],showLines:false,pointObjLayer:null,selectedItem:{index:-1,marker:null},loadZoomImgsHandle:null,loadLayer:function(B){var A=B.getViewSize();this.options.width=A[0];this.options.height=A[1];this.pointObjLayer=new Element("div",{unselectable:"off",styles:{position:"absolute",left:0,top:0,zIndex:2}});this.div.appendChild(this.pointObjLayer);this.geomDIV=new Element("div",{styles:{display:"none",pointerEvents:"none",position:"absolute",left:0,top:0,zIndex:1}});this.geomDIV.inject(this.div);this.geometry=new MapGIS.Geometry(this.geomDIV,{width:this.options.width,height:this.options.height});this.lineRoot=this.geometry.creatGroup();this.graphicsRoot=this.geometry.creatGroup();this.loader=true;this.parent(B)},dragingLayer:function(D){if(this.parent(D)){if(this.options.simpleDisplay){this.geomDIV.setStyle("display","none")}var B=D.isMoving();if(!B){this.drawGeom();this.drawLine();var C=this.mapoptions.getPos();var A={left:-C[0],top:-C[1]};this.geomDIV.setStyles(A)}}},reloadLayer:function(C){this.drawGeom();this.drawLine();var B=this.mapoptions.getPos();var A={left:-B[0],top:-B[1]};this.geomDIV.setStyles(A)},zoomLayer:function(C){if(this.parent(C)){this.transformPointCoord();this.drawGeom();this.drawLine();var B=this.mapoptions.getPos();var A={left:-B[0],top:-B[1]};this.geomDIV.setStyles(A)}},eventFn_click:function(D,B,E){D.stopPropagation();if(this.options.visibleWindow){var F=this.getCardWindowID(E);if($(F)){$(F).fade("in");$(F).setStyle("z-index",++this.cardIndex);this.setCardData(E,B)}else{var C=this.cardWindow(E,B);if(C!=null){C.inject(this.pointObjLayer)}}}var A={srcElement:$(this.id+"_p_"+(E)),row:E,data:B,layer:this};this.fireEvent("click",A);this.fireEvent("pointclick",A)},eventFn_mouseOver:function(B,C){var A={srcElement:$(this.id+"_p_"+(C)),row:C,data:B,layer:this};this.fireEvent("pointmouseover",A);this.fireEvent("mouseover",A)},getElementByID:function(A){return this.pointObjLayer.getElementById(this.id+"_p_"+A)},toScreen:function(C){var B=this.mapoptions.toLayerScreen(C[0],C[1]);var A={x:(B[0]),y:(B[1])};return A},setData:function(A){this.selectedItem.index=-1;this.pointList=A;this.drawPoint();this.drawLine()},setGraphicsData:function(A){this.options.graphicsData=A;if(this.loader&&this.isContinue()){this.drawGeom()}},getLatLngValue:function(D){if(D!=null){var A=D.x||D.X||D.xpos;var E=D.y||D.Y||D.ypos;var B=typeof(A)=="string"?A.toFloat():A;var C=typeof(E)=="string"?E.toFloat():E;return[B,C]}else{return null}},setDefaultMarker:function(A){this.options.defaultMarker=A},setMarkerImage:function(B){this.options.imgSrc=this.options.source+"images/transparent.gif";this.options.imgDeflectY=34;this.options.imgDeflectX=10;this.options.imgWidth=20;this.options.imgHeight=34;this.options.imgClass="marker";if(B!=null){for(var A in B){this.options[A]=B[A]}}},selectedPoint:function(O,J){this.selectedItem.index=O;if(J){this.selectedItem.marker=J}var L=this.pointList;if(L!=null&&L.length>0){var G=this.id+"_p_";this.cardIndex++;var A=this.cardIndex;var M=(this.selectedItem.marker!=null?true:false);var D=null;if(M){this.setMarkerImage(this.selectedItem.marker);D=this.options.imgClass}for(var I=0,H=L.length;I<H;I++){var C=G+I;if($(C)){var E=$(C);var J=L[I].marker;if(M){E.removeClass(D)}if(J){this.setMarkerImage(J)}else{this.setMarkerImage(this.options.defaultMarker)}E.removeClass(this.options.imgClass);if(this.selectedItem.index==I){this.setMarkerImage(this.selectedItem.marker);E.setStyle("zIndex",A)}var N=this.getLatLngValue(L[I]);var B=null;if(N!=null){B=this.toScreen(N)}else{break}var F=parseInt(B.x)-this.options.imgDeflectX;var K=parseInt(B.y)-this.options.imgDeflectY;E.setStyles({left:F,top:K});if(!E.hasClass(this.options.imgClass)){E.addClass(this.options.imgClass)}}}}},drawPoint:function(){var O=this.pointList;this.pointObjLayer.empty();if(O!=null){var D=this.id;for(var G=0,E=O.length;G<E;G++){var P=this.getLatLngValue(O[G]);var B=null;if(P!=null){B=this.toScreen(P)}else{continue}var L=O[G].content;var H=O[G].marker;if(H){this.setMarkerImage(H)}else{this.setMarkerImage(this.options.defaultMarker)}if(this.selectedItem.index==G){this.setMarkerImage(this.selectedItem.marker)}var C=parseInt(B.x)-this.options.imgDeflectX;var N=parseInt(B.y)-this.options.imgDeflectY;var I=O[G].html;var J=O[G].title;var M=O[G].show;var A=D+"_p_"+G;var F=new Element("div",{id:A,unselectable:"on","class":"pointImages",styles:{left:C,top:N,position:"absolute",cursor:"pointer",display:"block",fontSize:"12px"},events:{click:this.eventFn_click.bindWithEvent(this,[O[G],G]),mouseover:this.eventFn_mouseOver.bind(this,[O[G],G])}});F.addClass(this.options.imgClass);F.addClass(D+"_pointimg");if(I!=null){F.set("html",I)}if(J!=null){F.set("title",J)}F.inject(this.pointObjLayer);if(this.options.visibleWindow){if(M){var K=this.cardWindow(G,O[G]);if(K!=null){K.inject(this.pointObjLayer)}}}}}},drawLine:function(){this.clearLines();if(this.showLines){var F=this.pointList;if(F!=null){var G=this.id;var C=[];for(var B=0,A=F.length;B<A;B++){var E=this.getLatLngValue(F[B]);var D=null;if(E!=null){D=this.mapoptions.toScreen(E[0],E[1]);C.push(D)}else{continue}}this.lineFN(C)}}},dpos:[0,0],ds:[0,0],isRun:false,runIndex:1,mytimeout:null,lineFN:function(A){if(this.mytimeout!=null){window.clearInterval(this.mytimeout)}this.isRun=true;this.runIndex=1;if(A!=null&&A.length>0){this.dpos=A[0]}this.mytimeout=window.setInterval(this.gotoLine.bind(this,[A]),120)},gotoLine:function(C){if(!this.isRun){window.clearInterval(this.mytimeout)}else{if(C!=null&&C.length>this.runIndex){var I=[];for(var D=0,B=this.runIndex;D<B;D++){I.push(C[D])}var G=C[this.runIndex];var F=this.runIndex-1;var E=C[F];this.ds=[(G[0]-E[0])/4,(G[1]-E[1])/4];this.dpos=[this.dpos[0]+this.ds[0],this.dpos[1]+this.ds[1]];var P=Math.abs(this.dpos[0]-E[0]);var O=Math.abs(this.dpos[1]-E[1]);var M=Math.abs(G[0]-E[0]);var L=Math.abs(G[1]-E[1]);var J=[E];if(P>=M||O>=L){this.runIndex++;I.push(G)}else{J.push(this.dpos)}this.clearLines();var H={stroke:{color:"#4A2C48",width:3}};this.geomDIV.setStyle("display","block");if(I.length>1){var A=this.geometry.nodeFactory("shape");this.geometry.drawLineString(A,I,false,H);A.inject(this.lineRoot)}if(J.length>1){var K={stroke:{color:"#BB261F",width:3}};var N=this.geometry.nodeFactory("shape");this.geometry.drawLineString(N,J,false,K);N.inject(this.lineRoot)}}else{this.isRun=false}}},drawGeom:function(){var A=this.options.graphicsData;this.clearGraphics();if(A!=null&&A.length>0){this.geomDIV.setStyle("display","block");var D=[];for(var H=0,F=A.length;H<F;H++){var J=A[H].data;var G=null;var L=A[H].gtype;var K=A[H].gstyle;if(L=="CIRCLE"){var N=this.mapoptions.toScreen(J.x,J.y);var B=J.r/this.mapoptions.resolution(this.mapoptions.getLevel()).x;G={x:parseInt(N[0]),y:parseInt(N[1]),r:B}}else{G=[];for(var E=0,I=J.length;E<I;E++){var M=J[E];var N=this.mapoptions.toScreen(M[0],M[1]);G.push(N)}}var C=null;switch(L){case"RECTANGLE":C=this.geometry.nodeFactory("shape");this.geometry.drawRectangle(C,G,K);break;case"CIRCLE":C=this.geometry.nodeFactory("circle");this.geometry.drawCircle(C,G,K,true);break;case"LINE":C=this.geometry.nodeFactory("shape");this.geometry.drawLineString(C,G,false,K);break;case"LINEARRING":C=this.geometry.nodeFactory("shape");this.geometry.drawLineString(C,G,true,K);break;default:C=this.geometry.nodeFactory("shape");this.geometry.drawPolygon(C,G,K);break}C.inject(this.graphicsRoot)}}},clearPoint:function(){this.pointObjLayer.empty()},clearLines:function(){var B=this.lineRoot.children;if(B&&B.length>0){var A=((B&&B.length>0)?B.length:0);while(B&&B.length>0&&A>0){if(B[0].ignore){B[0].ignore("click",null);B[0].ignore("mouseover",null);B[0].ignore("mouseout",null);B[0].ignore("mouseup",null);B[0].ignore("mousedown",null);B[0].ignore("dblclick",null)}if(B[0].data){B[0].data=null}if(B[0].resetResolution){B[0].resetResolution=null}if(B[0]._geotype){B[0]._geotype=null}if(B[0]._style){B[0]._style=null}if(B[0]._options){B[0]._options=null}B[0].eject();A--}}},clearGraphics:function(){var B=this.graphicsRoot.children;if(B&&B.length>0){var A=((B&&B.length>0)?B.length:0);while(B&&B.length>0&&A>0){if(B[0].ignore){B[0].ignore("click",null);B[0].ignore("mouseover",null);B[0].ignore("mouseout",null);B[0].ignore("mouseup",null);B[0].ignore("mousedown",null);B[0].ignore("dblclick",null)}if(B[0].data){B[0].data=null}if(B[0].resetResolution){B[0].resetResolution=null}if(B[0]._geotype){B[0]._geotype=null}if(B[0]._style){B[0]._style=null}if(B[0]._options){B[0]._options=null}B[0].eject();A--}}},clear:function(){this.pointList=null;this.pointList=[];this.options.graphicsData=null;this.options.graphicsData=[];this.clearPoint();this.clearGraphics();this.clearLines()},destory:function(){this.clear();this.removeEvents("pointclick");this.removeEvents("pointmouseover");this.removeEvents("click");this.removeEvents("mouseover");this.removeEvents("dblclick")},transformPointCoord:function(){var O=this.pointList;if(O!=null){var F=this.id+"_p_";for(var I=0,G=O.length;I<G;I++){var B=F+I;if($(B)){var D=$(B);var P=this.getLatLngValue(O[I]);var C=null;if(P!=null){C=this.toScreen(P)}else{break}var L=O[I].content;var H=O[I].marker;if(H){this.setMarkerImage(H)}else{this.setMarkerImage(this.options.defaultMarker)}D.removeClass(this.options.imgClass);if(this.selectedItem.index==I){this.setMarkerImage(this.selectedItem.marker)}var E=parseInt(C.x)-this.options.imgDeflectX;var N=parseInt(C.y)-this.options.imgDeflectY;var J=O[I].html;var K=O[I].title;var M=O[I].show;D.setStyles({left:E,top:N});if(!D.hasClass(this.options.imgClass)){D.addClass(this.options.imgClass)}}}var A=this.pointObjLayer.getElements("div.pointImages_card");A.each(function(Q){var T=Q.retrieve("pdata");var S=this.getLatLngValue(T);var R=null;if(S==null){return}else{R=this.toScreen(S)}Q.setStyles({left:R.x,top:R.y})}.bind(this))}},cardIndex:1,getCardWindowID:function(B){if(this.options.combosWindow){var A=this.id;return A+"_tbl"}else{var A=this.id;return A+"_p_"+B+"_tbl"}},combosWindowData:null,setCardData:function(E,B){var A=this.getCardWindowID(E);if($(A+"_con")){$(A+"_con").set("html",B.content);if($(A)){var D=this.getLatLngValue(B);var C=null;if(D==null){return}else{C=this.toScreen(D)}$(A).store("pdata",B);$(A).setStyles({left:C.x,top:C.y})}}if(this.options.combosWindow){this.combosWindowData=B}},cardWindow:function(B,E){this.cardIndex++;var F=E.content;var K=this.getCardWindowID(B);var J=this.getLatLngValue(E);var C=null;if(J==null){return}else{C=this.toScreen(J)}var D=C.x;var I=C.y;if($(K)){$(this.getCardWindowID(B)).store("pdata",E);$(this.getCardWindowID(B)).setStyles({left:D,top:I});return null}var G=this.source+"images/window/";var A='<div style="z-index:1;position:absolute; bottom:68px; left:-38px; min-width:200px; background:#ffffff; border:1px solid #ababab;">';A+="<br>";A+='<img src="'+G+'IMCloseButton_Normal.png"   onclick=\'MapGIS.closeTabWindow("'+K+'",event)\'  style="position:absolute;top:5px; cursor:pointer; right:5px;"/>';A+='<div id="'+K+'_con" style="min-width:240px;min-height:100px; margin:10px;" onclick="MapGIS.stopPropagation(event)">';A+=(typeof(F)=="undefined"?"":F);A+="</div>";A+='<div style="width:200px;height:1px; "></div><div style="position:absolute; bottom:-70px; BACKGROUND: url('+G+'w.png) no-repeat -5px -715px; width:92px; height:70px; margin-top:-64px; margin-left:38px;"></div>';A+="</div>";var H=new Element("div",{id:K,"class":"pointImages_card",styles:{left:(D)+"px",top:I+"px",position:"absolute",cursor:"pointer",display:"block",fontSize:"12px",border:"0px solid black","z-index":this.cardIndex}});H.set("html",A);H.store("pdata",E);return H}})})})();
(function(){MapGIS.Layers.extend({ChinaLayer:new Class({Extends:MapGIS.Layers.TileLayer,Implements:[Events,Options],options:{url:"http://cache1.arcgisonline.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{x}/{y}.png"},loadImage:function(H,G,J,L,C,I,K,M,B,F){var E={z:G+4,y:J,x:L};var A=H.substitute(E);var D=this.div.getElementById(B);if(D){D.src=A}else{D=new Element("img",{src:A,id:B,"class":M,loaded:"false",styles:{position:"absolute",left:C,top:I,width:K,height:K,border:"0px",margin:"0px",padding:"0px","z-index":2}});D.inject(this.div);D.onload=function(){this.set("loaded","true")}}}})})})();
(function(){MapGIS.Layers.extend({PaletteLayer:new Class({Extends:MapGIS.Layers.BaseLayer,Implements:[Events,Options],options:{stopEvent:null,map:null},graphics:null,initLayer:function(){},pdiv:null,geomDIV:null,lineRoot:null,geomRoot:null,geometry:null,isPaint:false,loadLayer:function(D){this.parent(D);var B=D.getViewSize();var A=B[0];var C=B[1];this.div.id="mappalettediv";this.pdiv=new Element("div",{id:"mapalettegeomdiv",styles:{display:"block",width:A,height:C,pointerEvents:"none",border:"0px",position:"absolute",top:0,left:0,zIndex:1}});this.pdiv.inject(this.div);this.geometry=new MapGIS.Geometry(this.pdiv,{width:A,height:C});this.geomRoot=this.geometry.creatGroup();this.lineRoot=this.geometry.creatGroup();this.loader=true;if(!$chk(window.MAP_FN_PALETTEKEYDOWNFUN)){window.MAP_FN_PALETTEKEYDOWNFUN=this.keydownFun.bind(this);window.document.addEvent("keydown",window.MAP_FN_PALETTEKEYDOWNFUN)}},data:[],tmpdata:[],drawingType:"polygon",movingPoint:[],paintingSTYLE:{stroke:{color:"#22a1c5",width:2},fillColor:[32,202,172,0.4]},paintingPosSTYLE:{stroke:{color:"#ff6600",width:2},fillColor:[255,102,0,0.4]},paintedSTYLE:{stroke:{color:"#ff9700",width:2},fillColor:[255,173,50,0.5]},paintingStyle:function(A){if(A!=null){this.paintingSTYLE=new Hash(this.paintingSTYLE);this.paintingSTYLE.extend(A);this.paintingSTYLE=this.paintingSTYLE.getClean()}},paintedStyle:function(A){if(A!=null){this.paintedSTYLE=new Hash(this.paintedSTYLE);this.paintedSTYLE.extend(A);this.paintedSTYLE=this.paintedSTYLE.getClean()}},keydownFun:function(A){A=A||window.event;A=new Event(A);if(this.isPaint){switch(A.key){case"delete":if(this.tmpdata.length>0){this.tmpdata.pop()}break;case"esc":this.tmpdata=[];this.clearLines();break;default:break}}},getData:function(){return this.data},getTmpData:function(){var D=this.tmpdata;if(D.length>0){var C=null;switch(this.drawingType){case"circle":C={x:0,y:0,r:0};if(D.length>0&&this.isPaint){var E=D[0];C.x=E[0];C.y=E[1];var B=D[(D.length-1)];var A=Math.pow(Math.abs(B[0]-E[0]),2)+Math.pow(Math.abs(B[1]-E[1]),2);C.r=Math.sqrt(A)}break;case"rectangle":C=[];if(D.length>1){C=[D[0],D[(D.length-1)]]}break;default:C=D;break}return{gtype:this.drawingType,data:C}}return{gtype:this.drawingType,data:[]}},getLayerPos:function(){var C=this.mapoptions.getPos();var B=this.pdiv.style.left.toInt()+C[0];var A=this.pdiv.style.top.toInt()+C[1];return[B,A]},tmpDrawing:function(G){var F=this.tmpdata;this.clearLines();if(F.length>0){var O=null;var H=this.getLayerPos();var B=this.movingPoint;var A=[B[0]-H[0],B[1]-H[1]];switch(this.drawingType){case"circle":O={x:0,y:0,r:0};if(F.length>0&&this.isPaint){var L=F[0];var P=G.toScreen(L[0],L[1]);O.x=P[0]-H[0];O.y=P[1]-H[1];var N=Math.pow(Math.abs(A[0]-O.x),2)+Math.pow(Math.abs(A[1]-O.y),2);O.r=Math.sqrt(N)}break;case"rectangle":O=[];if(F.length>0){var L=F[0];var P=G.toScreen(L[0],L[1]);O=[[(P[0]-H[0]),(P[1]-H[1])],A]}break;default:O=[];for(var E=0,D=F.length;E<D;E++){var L=F[E];var P=G.toScreen(L[0],L[1]);O.push([(P[0]-H[0]),(P[1]-H[1])])}if(this.isPaint){O.push(A)}break}var C=this.geometry.nodeFactory("shape");var K=this.paintingSTYLE;switch(this.drawingType){case"circle":this.geometry.drawCircle(C,O,K,true);var J=this.geometry.nodeFactory("shape");this.geometry.drawCircle(J,{x:O.x,y:O.y,r:2},this.paintingSTYLE,true);J.inject(this.lineRoot);var M=this.geometry.nodeFactory("shape");this.geometry.drawLineString(M,[[O.x,O.y],A],false,this.paintingSTYLE);M.inject(this.lineRoot);break;case"linestring":this.geometry.drawLineString(C,O,false,K);break;case"linearring":this.geometry.drawLineString(C,O,true,K);break;case"rectangle":this.geometry.drawRectangle(C,O,K);break;default:this.geometry.drawPolygon(C,O,K);break}C.inject(this.lineRoot);var I=this.geometry.nodeFactory("shape");this.geometry.drawCircle(I,{x:A[0],y:A[1],r:7},this.paintingSTYLE,true);I.inject(this.lineRoot)}},loadDataToGeom:function(E){var F=this.data;this.clearGeoms();if(F!=null&&F.length>0){for(var A=0,L=F.length;A<L;A++){var K=null;if(F[A].gtype.toLowerCase()=="circle"){K={x:0,y:0,r:0};var J=F[A].data.x;var I=F[A].data.y;var M=E.toScreen(J,I);K.x=M[0];K.y=M[1];K.r=F[A].data.r/(E.getRes().x)}else{K=[];for(var D=0,C=F[A].data.length;D<C;D++){var H=F[A].data[D];var M=E.toScreen(H[0],H[1]);K.push(M)}}var B=this.geometry.nodeFactory("shape");var G=F[A].gstyle||this.paintedSTYLE;switch(F[A].gtype.toLowerCase()){case"circle":this.geometry.drawCircle(B,K,G,true);break;case"linestring":this.geometry.drawLineString(B,K,false,G);break;case"linearring":this.geometry.drawLineString(B,K,true,G);break;case"rectangle":this.geometry.drawRectangle(B,K,G);break;default:this.geometry.drawPolygon(B,K,G);break}B.inject(this.geomRoot)}}},clearGeoms:function(){if(this.geomRoot!=null){var B=this.geomRoot.children;if(B&&B.length>0){var A=((B&&B.length>0)?B.length:0);while(B&&B.length>0&&A>0){if(B[0].ignore){B[0].ignore("click",null);B[0].ignore("mouseover",null);B[0].ignore("mouseout",null);B[0].ignore("mouseup",null);B[0].ignore("mousedown",null);B[0].ignore("dblclick",null)}if(B[0].data){B[0].data=null}if(B[0].resetResolution){B[0].resetResolution=null}if(B[0]._geotype){B[0]._geotype=null}if(B[0]._style){B[0]._style=null}if(B[0]._options){B[0]._options=null}B[0].eject();A--}}}},clearLines:function(){if(this.lineRoot!=null){var B=this.lineRoot.children;if(B&&B.length>0){var A=((B&&B.length>0)?B.length:0);while(B&&B.length>0&&A>0){if(B[0].ignore){B[0].ignore("click",null);B[0].ignore("mouseover",null);B[0].ignore("mouseout",null);B[0].ignore("mouseup",null);B[0].ignore("mousedown",null);B[0].ignore("dblclick",null)}if(B[0].data){B[0].data=null}if(B[0].resetResolution){B[0].resetResolution=null}if(B[0]._geotype){B[0]._geotype=null}if(B[0]._style){B[0]._style=null}if(B[0]._options){B[0]._options=null}B[0].eject();A--}}}},dragingLayer:function(E,A){if(this.parent(E)){var C=E.isMoving();if(!C){var D=this.mapoptions.getPos();var B={left:-D[0],top:-D[1]};this.pdiv.setStyles(B);this.loadDataToGeom(E);this.tmpDrawing(E)}}},zoomLayer:function(C){if(this.parent(C)){this.loadDataToGeom(C);var B=this.mapoptions.getPos();var A={left:-B[0],top:-B[1]};this.pdiv.setStyles(A)}},eventByMouseOver:function(A,C){if(this.isPaint){var B=C.getMousePos();this.movingPoint=B;this.tmpDrawing(C)}},eventByClick:function(A,D){if(this.isPaint){var C=D.getMousePos();var B=D.toMap(C[0],C[1]);this.tmpdata.push(B)}},eventByDblclick:function(A,D){if(this.isPaint){var C=D.getMousePos();var B=D.toMap(C[0],C[1]);this.tmpdata.push(B);this.data.push(this.getTmpData());this.loadDataToGeom(D);this.tmpdata=[];this.clearLines();this.fireEvent("change",{options:this.options,data:this.getData()})}},pop:function(){if(this.data!=null&&this.data.length>0){this.data.pop();this.loadDataToGeom(this.mapoptions);this.fireEvent("change",{options:this.options,data:this.getData()})}},shift:function(){if(this.data!=null&&this.data.length>0){this.data.shift();this.loadDataToGeom(this.mapoptions);this.fireEvent("change",{options:this.options,data:this.getData()})}},loadData:function(A){this.data=A;if(this.data!=null&&this.mapoptions!=null){this.loadDataToGeom(this.mapoptions);this.fireEvent("change",{options:this.options,data:this.getData()})}},paintTools:function(A){this.start();switch(A){case 1:this.drawingType="linestring";break;case 2:this.drawingType="linearring";break;case 3:this.drawingType="rectangle";break;case 4:this.drawingType="circle";break;case 5:this.drawingType="polygon";break;default:this.drawingType="polygon";break}},initPaint:function(){if(this.options.map!=null){var A=this.options.map;if(typeof(A.setActiveTool)!="undefined"){A.setActiveTool("$")}}},stop:function(){this.isPaint=false},start:function(){this.initPaint();this.isPaint=true},paintLine:function(A){this.paintTools(A?2:1)},paintCircle:function(A){this.paintTools(4)},paintPolygon:function(){this.paintTools(5)},paintRectangle:function(){this.paintTools(3)},startEvent:function(){},stopEvent:function(){},clear:function(){this.data=[];this.tmpdata=[];this.clearGeoms();this.clearLines()},backup:function(){this.pop()}})})})();
(function(){MapGIS.extend({GozaskyMap:new Class({Extends:MapGIS.Map,Implements:[Events,Options],options:{fullMode:false,maptype:0,level:0,levelMax:13},paletteLayer:null,imageLayer:null,baseLayer:null,winTimeout:null,setActiveTool:function(A){switch(A){case"*1":if(this.paletteActiveFunHand!=null){this.paletteLayer.removeEvent("change",this.paletteActiveFunHand);this.paletteActiveFunHand=null}this.paletteActiveFunHand=this.paletteActiveFun.bind(this);this.paletteLayer.addEvent("change",this.paletteActiveFunHand);this.paletteLayer.clear();this.paletteLayer.paintPolygon(true);break;case"*2":if(this.paletteActiveFunHand!=null){this.paletteLayer.removeEvent("change",this.paletteActiveFunHand);this.paletteActiveFunHand=null}this.paletteActiveFunHand=this.paletteActiveFun.bind(this);this.paletteLayer.addEvent("change",this.paletteActiveFunHand);this.paletteLayer.clear();this.paletteLayer.paintCircle(true);break;default:break}this.parent(A);if(this.paletteLayer){this.paletteLayer.stop()}},initialize:function(B,C){this.options.contentMenu.obj=[];var A=new MapGIS.ChinaModel();if(typeof(USEREXTENT)!="undefined"){this.setOptions(USEREXTENT)}this.parent(B,C,A);var D=[{title:"放大",fn:function(){this.setActiveTool("+")}.bind(this)},{title:"缩小",fn:function(){this.setActiveTool("-")}.bind(this)},{title:"拖拽",fn:function(){this.setActiveTool("$")}.bind(this)},{title:"复原",fn:function(){this.reposition()}.bind(this)}];this.options.contentMenu.obj=new MapGIS.MapContentMenu(this,{baseMenuList:D});this.options.contentMenu.obj.div.inject(this.toolsdiv);this.customLoading();this.fireEvent("load",true)},customLoading:function(){this.baseLayer=new MapGIS.Layers.ChinaLayer({id:"LB01",zIndex:1});this.addLayer(this.baseLayer);this.imageLayer=new MapGIS.Layers.MapImageLayer({id:"imageLayer01",zIndex:25});var A=this.stopEvent.bind(this);this.paletteLayer=new MapGIS.Layers.PaletteLayer({id:"mappalettelayer",zIndex:20});this.addLayers([this.imageLayer,this.paletteLayer]);if(this._maploading){this._maploading()}}})})})();






